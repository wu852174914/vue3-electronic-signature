(function(x,u){typeof exports=="object"&&typeof module<"u"?u(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],u):(x=typeof globalThis<"u"?globalThis:x||self,u(x.Vue3ElectronicSignature={},x.Vue))})(this,function(x,u){"use strict";var Ft=Object.defineProperty;var Nt=(x,u,V)=>u in x?Ft(x,u,{enumerable:!0,configurable:!0,writable:!0,value:V}):x[u]=V;var S=(x,u,V)=>(Nt(x,typeof u!="symbol"?u+"":u,V),V);function V(l,t){return Math.sqrt(Math.pow(t.x-l.x,2)+Math.pow(t.y-l.y,2))}function ne(l,t){return Math.atan2(t.y-l.y,t.x-l.x)}function ae(l,t,a,n){const s=t||l,i=a||l,h=.2,c=ne(s,i)*(n?1:-1),r=V(s,i)*h;return{x:l.x+Math.cos(c)*r,y:l.y+Math.sin(c)*r,time:l.time}}function oe(l,t,a){if(!a.pressure.enabled)return a.strokeWidth;const n=V(l,t),s=t.time-l.time,i=s>0?n/s:0,h=Math.max(.1,Math.min(1,1-i*.01)),{min:c,max:r}=a.pressure;return c+(r-c)*h}function Je(l,t,a){if(t.length<2)return;if(l.strokeStyle=a.strokeColor,l.lineCap="round",l.lineJoin="round",!a.smoothing||t.length<3){l.beginPath(),l.lineWidth=a.strokeWidth,l.moveTo(t[0].x,t[0].y);for(let s=1;s<t.length;s++)l.lineTo(t[s].x,t[s].y);l.stroke();return}l.beginPath(),l.moveTo(t[0].x,t[0].y);for(let s=1;s<t.length-1;s++){const i=t[s],h=t[s+1];a.pressure.enabled?l.lineWidth=oe(t[s-1],i,a):l.lineWidth=a.strokeWidth;const c=ae(i,t[s-1],h);l.quadraticCurveTo(c.x,c.y,i.x,i.y)}const n=t[t.length-1];l.lineTo(n.x,n.y),l.stroke()}function se(l){const{canvasSize:t,paths:a}=l;let n=`<svg width="${t.width}" height="${t.height}" xmlns="http://www.w3.org/2000/svg">`;return a.forEach(s=>{if(s.points.length<2)return;let i=`M ${s.points[0].x} ${s.points[0].y}`;for(let h=1;h<s.points.length;h++)i+=` L ${s.points[h].x} ${s.points[h].y}`;n+=`<path d="${i}" stroke="${s.strokeColor}" stroke-width="${s.strokeWidth}" fill="none" stroke-linecap="round" stroke-linejoin="round"/>`}),n+="</svg>",n}function ie(l,t,a={format:"png"}){const{format:n,quality:s=.9,size:i,backgroundColor:h}=a;if(n==="svg")return se(t);const c=document.createElement("canvas"),r=c.getContext("2d");if(i){c.width=i.width,c.height=i.height;const g=i.width/l.width,p=i.height/l.height;r.scale(g,p)}else c.width=l.width,c.height=l.height;switch(h&&h!=="transparent"&&(r.fillStyle=h,r.fillRect(0,0,c.width,c.height)),r.drawImage(l,0,0),n){case"jpeg":return c.toDataURL("image/jpeg",s);case"base64":return c.toDataURL("image/png").split(",")[1];case"png":default:return c.toDataURL("image/png")}}function le(l,t){return new Promise((a,n)=>{const s=new Image;s.onload=()=>{const i=l.getContext("2d");i.clearRect(0,0,l.width,l.height),i.drawImage(s,0,0,l.width,l.height),a()},s.onerror=n,s.src=t})}function J(l){return l.paths.length===0||l.paths.every(t=>t.points.length===0)}function q(l,t){return{paths:[],canvasSize:{width:l,height:t},timestamp:Date.now(),isEmpty:!0}}function F(l){return JSON.parse(JSON.stringify(l))}class re{constructor(t){S(this,"canvas");S(this,"ctx");S(this,"replayData",null);S(this,"state","idle");S(this,"currentTime",0);S(this,"speed",1);S(this,"animationId",null);S(this,"startTimestamp",0);S(this,"pausedTime",0);S(this,"options",{});S(this,"eventCallbacks",new Map);S(this,"offscreenCanvas",null);S(this,"offscreenCtx",null);S(this,"lastFrameImageBitmap",null);S(this,"renderThrottle",0);S(this,"isRendering",!1);S(this,"seededRandom");this.canvas=t,this.ctx=t.getContext("2d"),this.initializeOffscreenCanvas(),this.seededRandom=this.createSeededRandom()}createSeededRandom(){return t=>{const s=Math.pow(2,32);return(1664525*t+1013904223)%s/s}}initializeOffscreenCanvas(){try{if(typeof OffscreenCanvas<"u"?(this.offscreenCanvas=new OffscreenCanvas(this.canvas.width,this.canvas.height),this.offscreenCtx=this.offscreenCanvas.getContext("2d")):(this.offscreenCanvas=document.createElement("canvas"),this.offscreenCanvas.width=this.canvas.width,this.offscreenCanvas.height=this.canvas.height,this.offscreenCtx=this.offscreenCanvas.getContext("2d")),this.offscreenCtx){this.offscreenCtx.imageSmoothingEnabled=!0,this.offscreenCtx.imageSmoothingQuality="high";try{this.offscreenCtx.textRenderingOptimization="optimizeSpeed"}catch{}}}catch(t){console.warn("Failed to initialize optimized offscreen canvas:",t),this.offscreenCanvas=document.createElement("canvas"),this.offscreenCanvas.width=this.canvas.width,this.offscreenCanvas.height=this.canvas.height,this.offscreenCtx=this.offscreenCanvas.getContext("2d")}}setReplayData(t,a={}){console.log("设置回放数据:",t),console.log("回放选项:",a),this.replayData=t,this.options={...a},this.speed=a.speed||t.speed||1,this.currentTime=a.startTime||0,this.state="idle",this.resetOptimizationState(),console.log("回放数据设置完成，路径数量:",t.paths.length),console.log("总时长:",t.totalDuration)}resetOptimizationState(){this.offscreenCanvas&&(this.offscreenCanvas.width=this.canvas.width,this.offscreenCanvas.height=this.canvas.height)}play(){if(console.log("播放方法调用，回放数据:",this.replayData),console.log("当前状态:",this.state),!this.replayData){console.error("没有回放数据，无法播放");return}if(this.replayData.totalDuration<=0){console.error("回放数据总时长为0，无法播放");return}if(this.replayData.paths.length===0){console.error("回放数据没有路径，无法播放");return}if(this.state==="playing"){console.log("已在播放中，忽略");return}this.state==="paused"?(console.log("从暂停状态恢复播放"),this.state="playing",this.startTimestamp=performance.now()-this.pausedTime,this.emit("replay-resume")):(console.log("开始新的播放"),this.state="playing",this.startTimestamp=performance.now(),this.pausedTime=0,this.currentTime=this.options.startTime||0,this.clearCanvas(),this.emit("replay-start")),this.animate()}pause(){this.state==="playing"&&(this.state="paused",this.pausedTime=performance.now()-this.startTimestamp,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.emit("replay-pause"))}stop(){this.state="stopped",this.currentTime=0,this.pausedTime=0,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.clearCanvas(),this.emit("replay-stop")}seek(t){if(!this.replayData)return;const a=this.options.endTime||this.replayData.totalDuration;this.currentTime=Math.max(0,Math.min(t,a)),this.state==="playing"?this.startTimestamp=performance.now()-this.currentTime/this.speed:this.pausedTime=this.currentTime/this.speed,this.renderFrame(this.currentTime)}setSpeed(t){const a=this.state==="playing";a&&this.pause(),this.speed=Math.max(.1,Math.min(5,t)),this.emit("replay-speed-change",this.speed),a&&this.play()}getState(){return this.state}getCurrentTime(){return this.currentTime}getTotalDuration(){var t;return((t=this.replayData)==null?void 0:t.totalDuration)||0}getProgress(){const t=this.getTotalDuration();return t>0?this.currentTime/t:0}animate(){if(this.state!=="playing"||!this.replayData)return;const t=performance.now();this.currentTime=(t-this.startTimestamp)*this.speed;const a=this.options.endTime||this.replayData.totalDuration;if(this.currentTime>=a){this.currentTime=a,this.state="completed",this.renderFrame(this.currentTime),this.emit("replay-complete"),this.options.loop&&setTimeout(()=>{this.currentTime=this.options.startTime||0,this.play()},500);return}this.renderFrame(this.currentTime),this.emit("replay-progress",this.getProgress(),this.currentTime),this.animationId=requestAnimationFrame(()=>this.animate())}renderFrame(t){if(!this.replayData||!this.offscreenCanvas||!this.offscreenCtx)return;const a=performance.now();if(!(a-this.renderThrottle<16)&&(this.renderThrottle=a,!this.isRendering)){this.isRendering=!0;try{this.renderToOffscreenCanvas(t),this.transferToMainCanvasSync()}finally{this.isRendering=!1}}}transferToMainCanvasSync(){if(this.offscreenCanvas)try{this.ctx.imageSmoothingEnabled=!1,this.ctx.globalCompositeOperation="copy",this.ctx.drawImage(this.offscreenCanvas,0,0),this.ctx.globalCompositeOperation="source-over",this.ctx.imageSmoothingEnabled=!0}catch{this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.offscreenCanvas,0,0)}}renderToOffscreenCanvas(t){if(!this.replayData||!this.offscreenCtx)return;const a=this.offscreenCanvas,n=this.offscreenCtx;n.globalCompositeOperation="copy",n.fillStyle="transparent",n.fillRect(0,0,a.width,a.height),n.globalCompositeOperation="source-over";let s=!1;for(let i=0;i<this.replayData.paths.length;i++){const h=this.replayData.paths[i],c=h.startTime||0,r=h.endTime||c+(h.duration||0);if(t<c)break;if(t>=r){this.drawCompletePathToOffscreen(h),!s&&Math.abs(t-r)<32&&this.emit("replay-path-end",i,h);continue}s=!0;const g=Math.max(0,Math.min(1,(t-c)/Math.max(r-c,1)));g>0&&Math.abs(t-c)<32&&this.emit("replay-path-start",i,h),this.drawPartialPathToOffscreen(h,g);break}}getPointsUpToTime(t,a,n){const s=[];for(let i=0;i<t.length;i++){const h=t[i],c=a+(h.relativeTime||i*50);if(c<=n)s.push(h);else{if(i>0){const r=t[i-1],g=a+(r.relativeTime||(i-1)*50);if(g<=n){const p=(n-g)/(c-g),d={x:r.x+(h.x-r.x)*p,y:r.y+(h.y-r.y)*p,time:n,pressure:r.pressure?r.pressure+(h.pressure||r.pressure-r.pressure)*p:h.pressure};s.push(d)}}break}}return s}calculateDynamicStrokeWidth(t,a,n,s){switch(n){case"pen":return 1;case"brush":if(a){const b=Math.sqrt(Math.pow(t.x-a.x,2)+Math.pow(t.y-a.y,2)),C=Math.max(1,(t.time||0)-(a.time||0)),T=b/C,R=Math.max(.1,Math.min(3,100/Math.max(T,1))),D=t.pressure||.5,P=Math.floor(t.x*1e3+t.y*1e3+(t.time||0)),N=.8+this.seededRandom(P)*.4;return Math.max(1,Math.min(20,s*R*(.3+D*1.4)*N))}return s;case"marker":return 12;case"pencil":const i=t.pressure||.5,h=Math.floor(t.x*1e3+t.y*1e3+(t.time||0)),c=.9+this.seededRandom(h+1)*.2;return s*(.7+i*.6)*c;case"ballpoint":const r=t.pressure||.5;return s*(.8+r*.4);case"elegant":const g=t.pressure||.5;let p=1;if(a){const b=Math.sqrt(Math.pow(t.x-a.x,2)+Math.pow(t.y-a.y,2)),C=Math.max(1,(t.time||0)-(a.time||0)),T=b/C;p=Math.max(.3,Math.min(2,50/Math.max(T,1)))}const d=g*p;return s*(.4+d*1.6);default:return s}}drawStyledStrokeForReplay(t,a,n,s){if(!(t.length<2))switch(this.ctx.strokeStyle=n,a){case"pen":if(this.ctx.lineWidth=1,this.ctx.lineCap="butt",this.ctx.lineJoin="miter",this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y),t.length>=3){for(let i=1;i<t.length-1;i++){const h=this.getControlPoint(t[i],t[i-1],t[i+1]);this.ctx.quadraticCurveTo(h.x,h.y,t[i].x,t[i].y)}this.ctx.lineTo(t[t.length-1].x,t[t.length-1].y)}else for(let i=1;i<t.length;i++)this.ctx.lineTo(t[i].x,t[i].y);this.ctx.stroke();break;case"brush":this.ctx.lineCap="round",this.ctx.lineJoin="round";for(let i=1;i<t.length;i++){const h=t[i],c=t[i-1],r=this.calculateDynamicStrokeWidth(h,c,a,s);this.ctx.lineWidth=r,this.ctx.beginPath(),this.ctx.moveTo(c.x,c.y),this.ctx.lineTo(h.x,h.y),this.ctx.stroke();const g=Math.floor(h.x*100+h.y*100+i);r>8&&this.seededRandom(g)>.6&&(this.ctx.globalAlpha=.2,this.ctx.beginPath(),this.ctx.arc(h.x,h.y,r*.3,0,Math.PI*2),this.ctx.fill(),this.ctx.globalAlpha=1)}break;case"marker":this.ctx.globalAlpha=.7,this.ctx.lineWidth=12,this.ctx.lineCap="square",this.ctx.lineJoin="bevel",this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(let i=1;i<t.length;i++)this.ctx.lineTo(t[i].x,t[i].y);this.ctx.stroke(),this.ctx.globalAlpha=.3,this.ctx.lineWidth=16,this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(let i=1;i<t.length;i++)this.ctx.lineTo(t[i].x,t[i].y);this.ctx.stroke(),this.ctx.globalAlpha=1;break;case"pencil":this.ctx.lineCap="round",this.ctx.lineJoin="round";for(let i=1;i<t.length;i++){const h=t[i],c=t[i-1],r=this.calculateDynamicStrokeWidth(h,c,a,s);this.ctx.lineWidth=r,this.ctx.globalAlpha=.8,this.ctx.beginPath(),this.ctx.moveTo(c.x,c.y),this.ctx.lineTo(h.x,h.y),this.ctx.stroke();for(let p=0;p<3;p++){const d=Math.floor(h.x*10+h.y*10+i*10+p);if(this.seededRandom(d)>.5){this.ctx.globalAlpha=.2,this.ctx.lineWidth=r*.3;const b=(this.seededRandom(d+1)-.5)*2,C=(this.seededRandom(d+2)-.5)*2;this.ctx.beginPath(),this.ctx.moveTo(c.x+b,c.y+C),this.ctx.lineTo(h.x+b,h.y+C),this.ctx.stroke()}}const g=Math.floor(h.x*5+h.y*5+i*5);if(this.seededRandom(g)>.8){this.ctx.globalAlpha=.4;for(let p=0;p<5;p++){const d=g+p*10;this.ctx.beginPath(),this.ctx.arc(h.x+(this.seededRandom(d+1)-.5)*3,h.y+(this.seededRandom(d+2)-.5)*3,this.seededRandom(d+3)*.8,0,Math.PI*2),this.ctx.fill()}}}this.ctx.globalAlpha=1;break;case"ballpoint":this.ctx.lineCap="round",this.ctx.lineJoin="round";for(let i=1;i<t.length;i++){const h=t[i],c=t[i-1],r=this.calculateDynamicStrokeWidth(h,c,a,s),g=Math.floor(h.x*50+h.y*50+i);if(this.seededRandom(g)>.1){if(this.ctx.lineWidth=r,this.ctx.globalAlpha=this.seededRandom(g+1)>.2?1:.7,this.ctx.beginPath(),i<t.length-1){const d=t[i+1],b=this.getControlPoint(h,c,d);this.ctx.moveTo(c.x,c.y),this.ctx.quadraticCurveTo(b.x,b.y,h.x,h.y)}else this.ctx.moveTo(c.x,c.y),this.ctx.lineTo(h.x,h.y);this.ctx.stroke()}const p=Math.floor(h.x*20+h.y*20+i*3);this.seededRandom(p)>.95&&(this.ctx.globalAlpha=.8,this.ctx.beginPath(),this.ctx.arc(h.x,h.y,r*.8,0,Math.PI*2),this.ctx.fill())}this.ctx.globalAlpha=1;break;case"elegant":this.drawElegantStroke(t,n,s);break}}drawElegantStroke(t,a,n){if(t.length<2)return;this.ctx.strokeStyle=a,this.ctx.fillStyle=a,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.globalCompositeOperation="source-over";const s=this.preprocessPointsForVelocity(t,n);this.drawVelocityBasedPath(s),this.addVelocityBasedConnections(s)}preprocessPointsForVelocity(t,a){const n=[];for(let s=0;s<t.length;s++){const i=t[s];let h=0,c=a;if(s>0){const g=t[s-1],p=Math.sqrt(Math.pow(i.x-g.x,2)+Math.pow(i.y-g.y,2)),d=Math.max(1,(i.time||0)-(g.time||0));h=p/d;const b=i.pressure||.5,C=Math.max(.2,Math.min(3,100/Math.max(h,1)));c=a*(.3+b*C*1.4)}let r=c;if(s>0){const g=n[s-1].smoothedWidth;r=g+(c-g)*.3}n.push({...i,velocity:h,dynamicWidth:c,smoothedWidth:Math.max(.5,Math.min(a*3,r))})}return n}drawVelocityBasedPath(t){if(!(t.length<2))for(let a=1;a<t.length;a++){const n=t[a],s=t[a-1];this.drawVelocitySegment(s,n,s.smoothedWidth,n.smoothedWidth)}}drawVelocitySegment(t,a,n,s){const i=Math.sqrt(Math.pow(a.x-t.x,2)+Math.pow(a.y-t.y,2)),h=Math.max(2,Math.min(10,Math.floor(i/3)));this.ctx.beginPath();const c=[];for(let r=0;r<=h;r++){const g=r/h,p=this.smoothStep(g),d=t.x+(a.x-t.x)*p,b=t.y+(a.y-t.y)*p,C=n+(s-n)*p,T=a.x-t.x,R=a.y-t.y,D=Math.sqrt(T*T+R*R);if(D>0){const P=-R/D*C/2,N=T/D*C/2;r===0?this.ctx.moveTo(d+P,b+N):this.ctx.lineTo(d+P,b+N),c.push({x:d-P,y:b-N})}}for(let r=c.length-1;r>=0;r--)this.ctx.lineTo(c[r].x,c[r].y);this.ctx.closePath(),this.ctx.fill()}addVelocityBasedConnections(t){for(let a=1;a<t.length-1;a++){const n=t[a-1],s=t[a],i=t[a+1],h=Math.abs(s.velocity-n.velocity),c=(s.velocity+n.velocity)/2,r=Math.atan2(s.y-n.y,s.x-n.x),g=Math.atan2(i.y-s.y,i.x-s.x),p=Math.abs(g-r);if(h>c*.5||p>.2){const d=s.smoothedWidth*.4;this.ctx.beginPath(),this.ctx.arc(s.x,s.y,d,0,Math.PI*2),this.ctx.fill()}}}smoothStep(t){return t*t*(3-2*t)}getControlPoint(t,a,n){const i={length:Math.sqrt(Math.pow(n.x-a.x,2)+Math.pow(n.y-a.y,2)),angle:Math.atan2(n.y-a.y,n.x-a.x)},h=i.angle+Math.PI,c=i.length*.2;return{x:t.x+Math.cos(h)*c,y:t.y+Math.sin(h)*c,time:t.time||0}}clearCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}on(t,a){this.eventCallbacks.has(t)||this.eventCallbacks.set(t,[]),this.eventCallbacks.get(t).push(a)}off(t,a){if(this.eventCallbacks.has(t))if(a){const n=this.eventCallbacks.get(t),s=n.indexOf(a);s>-1&&n.splice(s,1)}else this.eventCallbacks.delete(t)}emit(t,...a){const n=this.eventCallbacks.get(t);n&&n.forEach(s=>s(...a))}drawCompletePathToOffscreen(t){if(!this.offscreenCtx||t.points.length<2)return;const a=this.ctx;this.ctx=this.offscreenCtx;const n=t.penStyle||this.options.penStyle||"pen";this.drawStyledStrokeForReplay(t.points,n,t.strokeColor,t.strokeWidth),this.ctx=a}drawPartialPathToOffscreen(t,a){if(!this.offscreenCtx||t.points.length<2)return;const n=t.startTime||0,s=t.duration||0,i=n+s*a,h=this.getPointsUpToTime(t.points,n,i);if(h.length<2)return;const c=this.ctx;this.ctx=this.offscreenCtx;const r=t.penStyle||this.options.penStyle||"pen";this.drawStyledStrokeForReplay(h,r,t.strokeColor,t.strokeWidth),this.ctx=c}destroy(){this.stop(),this.eventCallbacks.clear(),this.replayData=null,this.lastFrameImageBitmap&&(this.lastFrameImageBitmap.close(),this.lastFrameImageBitmap=null)}}function he(l){const t=l.paths.map(r=>{const g=r.points.map((d,b)=>{var T;let C;if(d.time&&r.points[0].time)C=d.time-r.points[0].time;else if(b===0)C=0;else{const R=r.points[b-1],P=Math.sqrt(Math.pow(d.x-R.x,2)+Math.pow(d.y-R.y,2))/100*1e3;C=(((T=g[b-1])==null?void 0:T.relativeTime)||0)+Math.max(P,16)}return{...d,relativeTime:C}}),p=g.length>0?g[g.length-1].relativeTime:0;return{...r,points:g,duration:p}}),a=[];for(let r=0;r<t.length;r++){const g=t[r];let p;if(r===0)p=0;else{const C=a[r-1],T=qe(l.paths[r-1].points,l.paths[r].points);p=C.endTime+T}const d=p+g.duration,b={...g,startTime:p,endTime:d};console.log(`路径 ${r}: 开始时间=${p}, 结束时间=${d}, 持续时间=${g.duration}`),a.push(b)}const n=a.length>0?a[a.length-1].endTime:0;console.log("回放数据生成完成:"),console.log("- 路径数量:",a.length),console.log("- 总时长:",n),console.log("- 路径详情:",a.map(r=>({startTime:r.startTime,endTime:r.endTime,duration:r.duration,pointCount:r.points.length})));const s=a.reduce((r,g)=>r+$e(g.points),0),i=n>0?s/(n/1e3):0,h=a.slice(1).map((r,g)=>{const p=a[g];return r.startTime-p.endTime}),c=h.length>0?h.reduce((r,g)=>r+g,0)/h.length:0;return{paths:a,totalDuration:n,speed:1,metadata:{deviceType:ze(l),averageSpeed:i,totalDistance:s,averagePauseTime:c}}}function qe(l,t){if(l.length===0||t.length===0)return 200;const a=l[l.length-1],n=t[0];if(a.time&&n.time)return Math.max(n.time-a.time,50);const s=Math.sqrt(Math.pow(n.x-a.x,2)+Math.pow(n.y-a.y,2));return Math.min(Math.max(s*2,100),1e3)}function ze(l){const t=l.paths.reduce((i,h)=>i+h.points.length,0),a=l.paths.length;if(t===0)return"touch";const n=t/a;return n>20?"touch":n<10?"mouse":l.paths.some(i=>i.points.some(h=>h.pressure!==void 0))?"pen":"touch"}function $e(l){let t=0;for(let a=1;a<l.length;a++){const n=l[a].x-l[a-1].x,s=l[a].y-l[a-1].y;t+=Math.sqrt(n*n+s*s)}return t}const U={pen:{name:"钢笔",description:"极细线条，锐利精准，商务签名",strokeWidth:1,smoothing:!0,pressure:{enabled:!1,min:1,max:1},lineCap:"butt",lineJoin:"miter",recommendedColor:"#000080"},brush:{name:"毛笔",description:"粗细变化极大，传统书法效果",strokeWidth:8,smoothing:!0,pressure:{enabled:!0,min:1,max:16},lineCap:"round",lineJoin:"round",recommendedColor:"#2c3e50"},marker:{name:"马克笔",description:"超粗线条，荧光笔效果",strokeWidth:12,smoothing:!1,pressure:{enabled:!1,min:10,max:14},lineCap:"square",lineJoin:"bevel",recommendedColor:"#ff6b35"},pencil:{name:"铅笔",description:"粗糙纹理，素描效果",strokeWidth:3,smoothing:!1,pressure:{enabled:!0,min:2,max:5},lineCap:"round",lineJoin:"round",recommendedColor:"#666666"},ballpoint:{name:"圆珠笔",description:"细线条，轻微断续效果",strokeWidth:1.2,smoothing:!0,pressure:{enabled:!0,min:.8,max:1.8},lineCap:"round",lineJoin:"round",recommendedColor:"#1e3a8a"},elegant:{name:"优雅笔",description:"适中线条，由粗到细的渐变之美，连笔流畅",strokeWidth:3,smoothing:!0,pressure:{enabled:!0,min:.4,max:2.5},lineCap:"round",lineJoin:"round",recommendedColor:"#374151"}};function ce(l){return U[l]}function Ye(){return Object.entries(U).map(([l,t])=>({key:l,config:t}))}function ue(l,t){const a=ce(l);return{strokeWidth:a.strokeWidth,smoothing:a.smoothing,pressure:a.pressure,lineCap:a.lineCap,lineJoin:a.lineJoin,strokeColor:t||a.recommendedColor||"#000000"}}const Xe=["width","height"],Le={key:1,class:"signature-toolbar"},He=["disabled"],Ue=["disabled"],je=["disabled"],Ge={key:2,class:"replay-controls"},Qe={class:"replay-buttons"},Ke=["disabled"],Ze={key:0},et={key:1},tt=["disabled"],nt={class:"replay-progress"},at=["max","value","disabled"],ot={class:"time-display"},st={class:"replay-speed"},it=u.defineComponent({__name:"ElectronicSignature",props:{showToolbar:{type:Boolean,default:!1},width:{default:"100%"},height:{default:300},penStyle:{default:"pen"},strokeColor:{default:"#000000"},strokeWidth:{default:2},backgroundColor:{default:"transparent"},disabled:{type:Boolean,default:!1},placeholder:{default:"请在此处签名"},smoothing:{type:Boolean,default:!0},pressureSensitive:{type:Boolean,default:!1},minStrokeWidth:{default:1},maxStrokeWidth:{default:4},borderStyle:{default:"1px solid #ddd"},borderRadius:{default:"4px"},replayMode:{type:Boolean},replayData:{},replayOptions:{}},emits:["signature-start","signature-drawing","signature-end","signature-clear","signature-undo","signature-redo","replay-start","replay-progress","replay-pause","replay-resume","replay-stop","replay-complete","replay-path-start","replay-path-end","replay-speed-change"],setup(l,{expose:t,emit:a}){const n=l,s=a,i=u.ref(),h=u.ref(!1),c=u.ref(null),r=u.ref(q(0,0)),g=u.ref([]),p=u.ref(-1),d=u.ref(null),b=u.ref(!1),C=u.ref("idle"),T=u.ref(0),R=u.ref(0),D=u.computed(()=>typeof n.width=="number"?n.width:800),P=u.computed(()=>typeof n.height=="number"?n.height:300),N=u.computed(()=>({position:"relative",display:"inline-block",width:typeof n.width=="string"?n.width:`${n.width}px`,height:typeof n.height=="string"?n.height:`${n.height}px`})),gt=u.computed(()=>({border:n.borderStyle,borderRadius:n.borderRadius,backgroundColor:n.backgroundColor,cursor:n.disabled?"not-allowed":"crosshair",display:"block",width:"100%",height:"100%"})),ft=u.computed(()=>({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"#999",fontSize:"14px",pointerEvents:"none",userSelect:"none"})),pt=u.computed(()=>b.value?!1:n.placeholder&&J(r.value)),ge=u.computed(()=>p.value>0),fe=u.computed(()=>p.value<g.value.length-1),pe=u.computed(()=>b.value&&d.value),O=u.computed(()=>!pe.value&&!n.disabled),yt=u.computed(()=>{var e;return pe.value&&((e=n.replayOptions)==null?void 0:e.showControls)!==!1}),I=u.computed(()=>{if(n.penStyle){const e=ue(n.penStyle,n.strokeColor);return{strokeColor:e.strokeColor,strokeWidth:n.strokeWidth||e.strokeWidth,smoothing:n.smoothing!==void 0?n.smoothing:e.smoothing,pressure:{enabled:n.pressureSensitive!==void 0?n.pressureSensitive:e.pressure.enabled,min:n.minStrokeWidth||e.pressure.min,max:n.maxStrokeWidth||e.pressure.max},lineCap:e.lineCap,lineJoin:e.lineJoin}}return{strokeColor:n.strokeColor||"#000000",strokeWidth:n.strokeWidth||2,smoothing:n.smoothing!==void 0?n.smoothing:!0,pressure:{enabled:n.pressureSensitive||!1,min:n.minStrokeWidth||1,max:n.maxStrokeWidth||4},lineCap:"round",lineJoin:"round"}}),ye=()=>{var e;return((e=i.value)==null?void 0:e.getContext("2d"))||null},Y=(e,o)=>{const f=i.value,y=f.getBoundingClientRect(),m=f.width/y.width,v=f.height/y.height;return{x:(e-y.left)*m,y:(o-y.top)*v,time:Date.now()}},ve=e=>{if(!O.value)return;h.value=!0;const o=performance.now(),f={...e,time:o};c.value={points:[f],strokeColor:n.strokeColor,strokeWidth:n.strokeWidth,penStyle:n.penStyle,startTime:o,endTime:o,duration:0},s("signature-start")},G=(e,o,f,y)=>{switch(f){case"pen":return 1;case"brush":if(o){const W=Math.sqrt(Math.pow(e.x-o.x,2)+Math.pow(e.y-o.y,2)),_=Math.max(1,(e.time||0)-(o.time||0)),A=W/_,H=Math.max(.1,Math.min(3,100/Math.max(A,1))),z=e.pressure||.5,$=.8+Math.random()*.4;return Math.max(1,Math.min(20,y*H*(.3+z*1.4)*$))}return y;case"marker":return 12;case"pencil":const m=e.pressure||.5,v=.9+Math.random()*.2;return y*(.7+m*.6)*v;case"ballpoint":const w=e.pressure||.5;return y*(.8+w*.4);case"elegant":const k=e.pressure||.5;let M=1;if(o){const W=Math.sqrt(Math.pow(e.x-o.x,2)+Math.pow(e.y-o.y,2)),_=Math.max(1,(e.time||0)-(o.time||0)),A=W/_;M=Math.max(.3,Math.min(2,50/Math.max(A,1)))}const E=k*M;return y*(.4+E*1.6);default:return y}},Q=(e,o,f)=>{var y;if(!(o.length<2))switch(e.strokeStyle=((y=c.value)==null?void 0:y.strokeColor)||I.value.strokeColor,e.lineCap=I.value.lineCap||"round",e.lineJoin=I.value.lineJoin||"round",f){case"pen":if(e.lineWidth=1,e.lineCap="butt",e.lineJoin="miter",e.beginPath(),e.moveTo(o[0].x,o[0].y),o.length>=3){for(let m=1;m<o.length-1;m++){const v=xe(o[m],o[m-1],o[m+1]);e.quadraticCurveTo(v.x,v.y,o[m].x,o[m].y)}e.lineTo(o[o.length-1].x,o[o.length-1].y)}else for(let m=1;m<o.length;m++)e.lineTo(o[m].x,o[m].y);e.stroke();break;case"brush":e.lineCap="round",e.lineJoin="round";for(let m=1;m<o.length;m++){const v=o[m],w=o[m-1],k=G(v,w,f,I.value.strokeWidth),M=e.createLinearGradient(w.x,w.y,v.x,v.y);M.addColorStop(0,e.strokeStyle),M.addColorStop(1,e.strokeStyle),e.lineWidth=k,e.beginPath(),e.moveTo(w.x,w.y),e.lineTo(v.x,v.y),e.stroke(),k>8&&Math.random()>.6&&(e.globalAlpha=.2,e.beginPath(),e.arc(v.x,v.y,k*.3,0,Math.PI*2),e.fill(),e.globalAlpha=1)}break;case"marker":e.globalAlpha=.7,e.lineWidth=12,e.lineCap="square",e.lineJoin="bevel",e.beginPath(),e.moveTo(o[0].x,o[0].y);for(let m=1;m<o.length;m++)e.lineTo(o[m].x,o[m].y);e.stroke(),e.globalAlpha=.3,e.lineWidth=16,e.beginPath(),e.moveTo(o[0].x,o[0].y);for(let m=1;m<o.length;m++)e.lineTo(o[m].x,o[m].y);e.stroke(),e.globalAlpha=1;break;case"pencil":e.lineCap="round",e.lineJoin="round";for(let m=1;m<o.length;m++){const v=o[m],w=o[m-1],k=G(v,w,f,I.value.strokeWidth);e.lineWidth=k,e.globalAlpha=.8,e.beginPath(),e.moveTo(w.x,w.y),e.lineTo(v.x,v.y),e.stroke();for(let M=0;M<3;M++)if(Math.random()>.5){e.globalAlpha=.2,e.lineWidth=k*.3;const E=(Math.random()-.5)*2,W=(Math.random()-.5)*2;e.beginPath(),e.moveTo(w.x+E,w.y+W),e.lineTo(v.x+E,v.y+W),e.stroke()}if(Math.random()>.8){e.globalAlpha=.4;for(let M=0;M<5;M++)e.beginPath(),e.arc(v.x+(Math.random()-.5)*3,v.y+(Math.random()-.5)*3,Math.random()*.8,0,Math.PI*2),e.fill()}}e.globalAlpha=1;break;case"ballpoint":e.lineCap="round",e.lineJoin="round";for(let m=1;m<o.length;m++){const v=o[m],w=o[m-1],k=G(v,w,f,I.value.strokeWidth);if(Math.random()>.1){if(e.lineWidth=k,e.globalAlpha=Math.random()>.2?1:.7,e.beginPath(),I.value.smoothing&&m<o.length-1){const M=o[m+1],E=xe(v,w,M);e.moveTo(w.x,w.y),e.quadraticCurveTo(E.x,E.y,v.x,v.y)}else e.moveTo(w.x,w.y),e.lineTo(v.x,v.y);e.stroke()}Math.random()>.95&&(e.globalAlpha=.8,e.beginPath(),e.arc(v.x,v.y,k*.8,0,Math.PI*2),e.fill())}e.globalAlpha=1;break;case"elegant":xt(e,o);break}},vt=()=>{if(!c.value||c.value.points.length<2)return;const e=ye();if(!e)return;const o=c.value.points,f=o.length,y=n.penStyle||"pen";if(f===2)Q(e,o,y);else if(f>=3){const m=o.slice(-3);Q(e,m,y)}},xt=(e,o)=>{var y,m;if(o.length<2)return;e.strokeStyle=((y=c.value)==null?void 0:y.strokeColor)||I.value.strokeColor,e.fillStyle=((m=c.value)==null?void 0:m.strokeColor)||I.value.strokeColor,e.lineCap="round",e.lineJoin="round",e.globalCompositeOperation="source-over";const f=Ct(o,I.value.strokeWidth);wt(e,f),bt(e,f)},Ct=(e,o)=>{const f=[];for(let y=0;y<e.length;y++){const m=e[y];let v=0,w=o;if(y>0){const M=e[y-1],E=Math.sqrt(Math.pow(m.x-M.x,2)+Math.pow(m.y-M.y,2)),W=Math.max(1,(m.time||0)-(M.time||0));v=E/W;const _=m.pressure||.5,A=Math.max(.2,Math.min(3,100/Math.max(v,1)));w=o*(.3+_*A*1.4)}let k=w;if(y>0){const M=f[y-1].smoothedWidth;k=M+(w-M)*.3}f.push({...m,velocity:v,dynamicWidth:w,smoothedWidth:Math.max(.5,Math.min(o*3,k))})}return f},wt=(e,o)=>{if(!(o.length<2))for(let f=1;f<o.length;f++){const y=o[f],m=o[f-1];Mt(e,m,y,m.smoothedWidth,y.smoothedWidth)}},Mt=(e,o,f,y,m)=>{const v=Math.sqrt(Math.pow(f.x-o.x,2)+Math.pow(f.y-o.y,2)),w=Math.max(2,Math.min(10,Math.floor(v/3)));e.beginPath();const k=[];for(let M=0;M<=w;M++){const E=M/w,W=Tt(E),_=o.x+(f.x-o.x)*W,A=o.y+(f.y-o.y)*W,H=y+(m-y)*W,z=f.x-o.x,$=f.y-o.y,Z=Math.sqrt(z*z+$*$);if(Z>0){const ee=-$/Z*H/2,te=z/Z*H/2;M===0?e.moveTo(_+ee,A+te):e.lineTo(_+ee,A+te),k.push({x:_-ee,y:A-te})}}for(let M=k.length-1;M>=0;M--)e.lineTo(k[M].x,k[M].y);e.closePath(),e.fill()},bt=(e,o)=>{for(let f=1;f<o.length-1;f++){const y=o[f-1],m=o[f],v=o[f+1],w=Math.abs(m.velocity-y.velocity),k=(m.velocity+y.velocity)/2,M=Math.atan2(m.y-y.y,m.x-y.x),E=Math.atan2(v.y-m.y,v.x-m.x),W=Math.abs(E-M);if(w>k*.5||W>.2){const _=m.smoothedWidth*.4;e.beginPath(),e.arc(m.x,m.y,_,0,Math.PI*2),e.fill()}}},Tt=e=>e*e*(3-2*e),xe=(e,o,f)=>{const m={length:Math.sqrt(Math.pow(f.x-o.x,2)+Math.pow(f.y-o.y,2)),angle:Math.atan2(f.y-o.y,f.x-o.x)},v=m.angle+Math.PI,w=m.length*.2;return{x:e.x+Math.cos(v)*w,y:e.y+Math.sin(v)*w,time:e.time||0}},kt=(e,o)=>{if(o.points.length<2)return;const f=o.penStyle||n.penStyle||"pen",y=c.value;c.value=o,Q(e,o.points,f),c.value=y},Ce=e=>{if(!h.value||!c.value||!O.value)return;const o=performance.now(),f={...e,time:o};c.value.points.push(f),c.value.startTime&&(c.value.endTime=o,c.value.duration=o-c.value.startTime),vt(),Te(),s("signature-drawing",r.value)},we=()=>{if(!(!h.value||!c.value)){if(h.value=!1,c.value.points.length>0){const e=c.value.points[c.value.points.length-1];e.time&&c.value.startTime&&(c.value.endTime=e.time,c.value.duration=e.time-c.value.startTime)}r.value.paths.push(c.value),r.value.isEmpty=!1,r.value.timestamp=Date.now(),X(),B(),c.value=null,s("signature-end",r.value)}},St=e=>{e.preventDefault();const o=Y(e.clientX,e.clientY);ve(o)},Pt=e=>{if(e.preventDefault(),!h.value)return;const o=Y(e.clientX,e.clientY);Ce(o)},Me=e=>{e.preventDefault(),we()},Dt=e=>{if(e.preventDefault(),e.touches.length!==1)return;const o=e.touches[0],f=Y(o.clientX,o.clientY);ve(f)},Wt=e=>{if(e.preventDefault(),e.touches.length!==1||!h.value)return;const o=e.touches[0],f=Y(o.clientX,o.clientY);Ce(f)},be=e=>{e.preventDefault(),we()},Te=()=>{r.value.canvasSize={width:D.value,height:P.value},r.value.isEmpty=J(r.value)},X=()=>{g.value=g.value.slice(0,p.value+1),g.value.push(F(r.value)),p.value=g.value.length-1;const e=50;g.value.length>e&&(g.value=g.value.slice(-e),p.value=g.value.length-1)},B=()=>{const e=ye();e&&(e.clearRect(0,0,D.value,P.value),n.backgroundColor&&n.backgroundColor!=="transparent"&&(e.fillStyle=n.backgroundColor,e.fillRect(0,0,D.value,P.value)),r.value.paths.forEach(o=>{o.points.length>0&&kt(e,o)}))},L=()=>{if(console.log("初始化回放控制器"),console.log("canvas引用是否存在:",!!i.value),!i.value){console.error("canvas引用不存在，无法初始化回放控制器");return}d.value&&(console.log("销毁现有回放控制器"),d.value.destroy()),console.log("创建新的回放控制器"),d.value=new re(i.value),console.log("回放控制器创建成功:",!!d.value),d.value.on("replay-start",()=>{C.value="playing",s("replay-start")}),d.value.on("replay-progress",(e,o)=>{T.value=e,R.value=o,s("replay-progress",e,o)}),d.value.on("replay-pause",()=>{C.value="paused",s("replay-pause")}),d.value.on("replay-resume",()=>{C.value="playing",s("replay-resume")}),d.value.on("replay-stop",()=>{C.value="stopped",s("replay-stop")}),d.value.on("replay-complete",()=>{C.value="completed",s("replay-complete")}),d.value.on("replay-path-start",(e,o)=>{s("replay-path-start",e,o)}),d.value.on("replay-path-end",(e,o)=>{s("replay-path-end",e,o)}),d.value.on("replay-speed-change",e=>{s("replay-speed-change",e)})},ke=(e,o)=>{if(d.value||L(),d.value){b.value=!0;const f={...o,drawOptions:I.value,penStyle:n.penStyle};d.value.setReplayData(e,f),console.log("startReplay调用，自动播放:",o==null?void 0:o.autoPlay),(o==null?void 0:o.autoPlay)===!0&&d.value.play()}},Se=e=>{b.value=e,!e&&d.value&&(d.value.stop(),B())},Et=()=>J(r.value)?null:he(r.value),Pe=()=>{console.log("play方法被调用"),console.log("回放控制器是否存在:",!!d.value),d.value||(console.log("回放控制器不存在，尝试初始化"),L()),d.value?(console.log("调用回放控制器的play方法"),d.value.play()):console.error("回放控制器初始化失败，无法播放")},De=()=>{var e;(e=d.value)==null||e.pause()},We=()=>{var e;(e=d.value)==null||e.stop()},Ee=e=>{var o;(o=d.value)==null||o.seek(e)},Re=e=>{var o;(o=d.value)==null||o.setSpeed(e)},Rt=()=>{var e;return((e=d.value)==null?void 0:e.getState())||"idle"},It=()=>{var e;return((e=d.value)==null?void 0:e.getCurrentTime())||0},K=()=>{var e;return((e=d.value)==null?void 0:e.getTotalDuration())||0},_t=()=>{var e;return((e=d.value)==null?void 0:e.getProgress())||0},Ie=e=>{const o=Math.floor(e/1e3),f=Math.floor(o/60),y=o%60;return`${f}:${y.toString().padStart(2,"0")}`},_e=()=>{O.value&&(r.value=q(D.value,P.value),B(),X(),s("signature-clear"))},Oe=()=>{!ge.value||!O.value||(p.value--,r.value=F(g.value[p.value]),B(),s("signature-undo",r.value))},Ve=()=>{!fe.value||!O.value||(p.value++,r.value=F(g.value[p.value]),B(),s("signature-redo",r.value))},Ae=e=>{const o=i.value;return ie(o,r.value,e)},Fe=()=>J(r.value),Ne=async e=>{if(!O.value)return;const o=i.value;await le(o,e),r.value=q(D.value,P.value),r.value.isEmpty=!1,X()},Ot=()=>F(r.value),Vt=e=>{O.value&&(r.value=F(e),B(),X())},Be=(e,o)=>{const f=e||D.value,y=o||P.value,m=Ae({format:"png"});u.nextTick(()=>{const v=i.value;v.width=f,v.height=y,Fe()||Ne(m),Te()})},At=()=>{const e=i.value;e.width=D.value,e.height=P.value,r.value=q(D.value,P.value),g.value=[F(r.value)],p.value=0,B()};return u.watch([()=>n.width,()=>n.height],()=>{u.nextTick(()=>{i.value&&Be()})}),u.watch(()=>n.replayMode,e=>{e!==void 0&&Se(e)}),u.watch(()=>n.replayData,e=>{if(console.log("watch监听到回放数据变化:",e),console.log("当前回放模式:",n.replayMode),console.log("回放控制器是否存在:",!!d.value),e&&n.replayMode)if(d.value||(console.log("回放控制器未初始化，先初始化"),L()),d.value){console.log("开始设置回放数据到控制器");const o={...n.replayOptions,drawOptions:I.value,penStyle:n.penStyle};d.value.setReplayData(e,o),console.log("回放数据已更新:",e)}else console.error("回放控制器初始化失败");else e||console.log("回放数据为空，跳过设置"),n.replayMode||console.log("不在回放模式，跳过设置")},{immediate:!0}),u.onMounted(()=>{u.nextTick(()=>{At(),L(),n.replayMode&&n.replayData&&ke(n.replayData,n.replayOptions)})}),u.onUnmounted(()=>{d.value&&(d.value.destroy(),d.value=null)}),t({clear:_e,undo:Oe,redo:Ve,save:Ae,isEmpty:Fe,fromDataURL:Ne,getSignatureData:Ot,setSignatureData:Vt,resize:Be,startReplay:ke,getReplayData:Et,setReplayMode:Se,play:Pe,pause:De,stop:We,seek:Ee,setSpeed:Re,getState:Rt,getCurrentTime:It,getTotalDuration:K,getProgress:_t}),(e,o)=>(u.openBlock(),u.createElementBlock("div",{class:"electronic-signature",style:u.normalizeStyle(N.value)},[u.createElementVNode("canvas",{ref_key:"canvasRef",ref:i,width:D.value,height:P.value,style:u.normalizeStyle(gt.value),onMousedown:St,onMousemove:Pt,onMouseup:Me,onMouseleave:Me,onTouchstart:Dt,onTouchmove:Wt,onTouchend:be,onTouchcancel:be},null,44,Xe),pt.value?(u.openBlock(),u.createElementBlock("div",{key:0,class:"signature-placeholder",style:u.normalizeStyle(ft.value)},u.toDisplayString(e.placeholder),5)):u.createCommentVNode("",!0),e.showToolbar?(u.openBlock(),u.createElementBlock("div",Le,[u.createElementVNode("button",{onClick:_e,disabled:!O.value},"清除",8,He),u.createElementVNode("button",{onClick:Oe,disabled:!O.value||!ge.value},"撤销",8,Ue),u.createElementVNode("button",{onClick:Ve,disabled:!O.value||!fe.value},"重做",8,je)])):u.createCommentVNode("",!0),yt.value?(u.openBlock(),u.createElementBlock("div",Ge,[u.createElementVNode("div",Qe,[u.createElementVNode("button",{onClick:o[0]||(o[0]=f=>C.value==="playing"?De():Pe()),disabled:C.value==="idle",class:"replay-btn play-pause-btn"},[C.value==="playing"?(u.openBlock(),u.createElementBlock("span",Ze,"⏸️")):(u.openBlock(),u.createElementBlock("span",et,"▶️"))],8,Ke),u.createElementVNode("button",{onClick:o[1]||(o[1]=f=>We()),disabled:C.value==="idle",class:"replay-btn stop-btn"}," ⏹️ ",8,tt)]),u.createElementVNode("div",nt,[u.createElementVNode("input",{type:"range",min:"0",max:K(),value:R.value,onInput:o[2]||(o[2]=f=>Ee(Number(f.target.value))),class:"progress-slider",disabled:C.value==="idle"},null,40,at),u.createElementVNode("div",ot,[u.createElementVNode("span",null,u.toDisplayString(Ie(R.value)),1),o[4]||(o[4]=u.createElementVNode("span",null,"/",-1)),u.createElementVNode("span",null,u.toDisplayString(Ie(K())),1)])]),u.createElementVNode("div",st,[o[6]||(o[6]=u.createElementVNode("label",null,"速度:",-1)),u.createElementVNode("select",{onChange:o[3]||(o[3]=f=>Re(Number(f.target.value))),class:"speed-select"},o[5]||(o[5]=[u.createElementVNode("option",{value:"0.5"},"0.5x",-1),u.createElementVNode("option",{value:"1",selected:""},"1x",-1),u.createElementVNode("option",{value:"1.5"},"1.5x",-1),u.createElementVNode("option",{value:"2"},"2x",-1)]),32)])])):u.createCommentVNode("",!0)],4))}}),Bt="",j=((l,t)=>{const a=l.__vccOpts||l;for(const[n,s]of t)a[n]=s;return a})(it,[["__scopeId","data-v-20a8ec18"]]);function de(){return window.devicePixelRatio||1}function lt(l){const t=l.getContext("2d"),a=de(),n=l.clientWidth,s=l.clientHeight;return l.width=n*a,l.height=s*a,t.scale(a,a),l.style.width=n+"px",l.style.height=s+"px",t}function me(l){if(l.paths.length===0)return{minX:0,minY:0,maxX:0,maxY:0,width:0,height:0};let t=1/0,a=1/0,n=-1/0,s=-1/0;return l.paths.forEach(i=>{i.points.forEach(h=>{t=Math.min(t,h.x),a=Math.min(a,h.y),n=Math.max(n,h.x),s=Math.max(s,h.y)})}),{minX:t,minY:a,maxX:n,maxY:s,width:n-t,height:s-a}}function rt(l,t,a=10){const n=me(t);if(n.width===0||n.height===0){const r=document.createElement("canvas");return r.width=1,r.height=1,r}const s=document.createElement("canvas"),i=s.getContext("2d"),h=n.width+a*2,c=n.height+a*2;return s.width=h,s.height=c,i.drawImage(l,n.minX-a,n.minY-a,h,c,0,0,h,c),s}function ht(l,t,a,n=!0){const s=document.createElement("canvas"),i=s.getContext("2d");let h=t,c=a;if(n){const r=l.width/l.height,g=t/a;r>g?c=t/r:h=a*r}return s.width=h,s.height=c,i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(l,0,0,h,c),s}function ct(l,t,a={}){const{fontSize:n=12,fontFamily:s="Arial",color:i="#999",opacity:h=.5,position:c="bottom-right"}=a,r=document.createElement("canvas"),g=r.getContext("2d");r.width=l.width,r.height=l.height,g.drawImage(l,0,0),g.font=`${n}px ${s}`,g.fillStyle=i,g.globalAlpha=h;const d=g.measureText(t).width,b=n;let C,T;switch(c){case"top-left":C=10,T=b+10;break;case"top-right":C=l.width-d-10,T=b+10;break;case"bottom-left":C=10,T=l.height-10;break;case"bottom-right":C=l.width-d-10,T=l.height-10;break;case"center":C=(l.width-d)/2,T=(l.height+b)/2;break;default:C=l.width-d-10,T=l.height-10}return g.fillText(t,C,T),g.globalAlpha=1,r}function ut(l){const t=document.createElement("canvas"),a=t.getContext("2d");t.width=l.width,t.height=l.height,a.drawImage(l,0,0);const n=a.getImageData(0,0,l.width,l.height),s=n.data;for(let i=0;i<s.length;i+=4){const h=s[i]*.299+s[i+1]*.587+s[i+2]*.114;s[i]=h,s[i+1]=h,s[i+2]=h}return a.putImageData(n,0,0),t}const dt={install:l=>{l.component("ElectronicSignature",j)},ElectronicSignature:j},mt="1.0.0";x.ElectronicSignature=j,x.PEN_STYLE_CONFIGS=U,x.SignatureReplayController=re,x.addWatermark=ct,x.calculateStrokeWidth=oe,x.cloneSignatureData=F,x.convertToGrayscale=ut,x.createDrawOptionsFromPenStyle=ue,x.createEmptySignatureData=q,x.createReplayData=he,x.cropSignature=rt,x.default=dt,x.drawSmoothPath=Je,x.exportSignature=ie,x.getAllPenStyles=Ye,x.getAngle=ne,x.getControlPoint=ae,x.getDevicePixelRatio=de,x.getDistance=V,x.getPenStyleConfig=ce,x.getSignatureBounds=me,x.isSignatureEmpty=J,x.loadImageToCanvas=le,x.resizeSignature=ht,x.setupHighDPICanvas=lt,x.signatureToSVG=se,x.version=mt,Object.defineProperties(x,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});

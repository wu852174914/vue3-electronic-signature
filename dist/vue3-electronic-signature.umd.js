(function(v,u){typeof exports=="object"&&typeof module<"u"?u(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],u):(v=typeof globalThis<"u"?globalThis:v||self,u(v.Vue3ElectronicSignature={},v.Vue))})(this,function(v,u){"use strict";var At=Object.defineProperty;var Nt=(v,u,O)=>u in v?At(v,u,{enumerable:!0,configurable:!0,writable:!0,value:O}):v[u]=O;var M=(v,u,O)=>(Nt(v,typeof u!="symbol"?u+"":u,O),O);function O(h,t){return Math.sqrt(Math.pow(t.x-h.x,2)+Math.pow(t.y-h.y,2))}function ee(h,t){return Math.atan2(t.y-h.y,t.x-h.x)}function te(h,t,o,n){const i=t||h,s=o||h,l=.2,c=ee(i,s)*(n?1:-1),r=O(i,s)*l;return{x:h.x+Math.cos(c)*r,y:h.y+Math.sin(c)*r,time:h.time}}function ne(h,t,o){if(!o.pressure.enabled)return o.strokeWidth;const n=O(h,t),i=t.time-h.time,s=i>0?n/i:0,l=Math.max(.1,Math.min(1,1-s*.01)),{min:c,max:r}=o.pressure;return c+(r-c)*l}function qe(h,t,o){if(t.length<2)return;if(h.strokeStyle=o.strokeColor,h.lineCap="round",h.lineJoin="round",!o.smoothing||t.length<3){h.beginPath(),h.lineWidth=o.strokeWidth,h.moveTo(t[0].x,t[0].y);for(let i=1;i<t.length;i++)h.lineTo(t[i].x,t[i].y);h.stroke();return}h.beginPath(),h.moveTo(t[0].x,t[0].y);for(let i=1;i<t.length-1;i++){const s=t[i],l=t[i+1];o.pressure.enabled?h.lineWidth=ne(t[i-1],s,o):h.lineWidth=o.strokeWidth;const c=te(s,t[i-1],l);h.quadraticCurveTo(c.x,c.y,s.x,s.y)}const n=t[t.length-1];h.lineTo(n.x,n.y),h.stroke()}function ae(h){const{canvasSize:t,paths:o}=h;let n=`<svg width="${t.width}" height="${t.height}" xmlns="http://www.w3.org/2000/svg">`;return o.forEach(i=>{if(i.points.length<2)return;let s=`M ${i.points[0].x} ${i.points[0].y}`;for(let l=1;l<i.points.length;l++)s+=` L ${i.points[l].x} ${i.points[l].y}`;n+=`<path d="${s}" stroke="${i.strokeColor}" stroke-width="${i.strokeWidth}" fill="none" stroke-linecap="round" stroke-linejoin="round"/>`}),n+="</svg>",n}function oe(h,t,o={format:"png"}){const{format:n,quality:i=.9,size:s,backgroundColor:l}=o;if(n==="svg")return ae(t);const c=document.createElement("canvas"),r=c.getContext("2d");if(s){c.width=s.width,c.height=s.height;const g=s.width/h.width,p=s.height/h.height;r.scale(g,p)}else c.width=h.width,c.height=h.height;switch(l&&l!=="transparent"&&(r.fillStyle=l,r.fillRect(0,0,c.width,c.height)),r.drawImage(h,0,0),n){case"jpeg":return c.toDataURL("image/jpeg",i);case"base64":return c.toDataURL("image/png").split(",")[1];case"png":default:return c.toDataURL("image/png")}}function se(h,t){return new Promise((o,n)=>{const i=new Image;i.onload=()=>{const s=h.getContext("2d");s.clearRect(0,0,h.width,h.height),s.drawImage(i,0,0,h.width,h.height),o()},i.onerror=n,i.src=t})}function B(h){return h.paths.length===0||h.paths.every(t=>t.points.length===0)}function z(h,t){return{paths:[],canvasSize:{width:h,height:t},timestamp:Date.now(),isEmpty:!0}}function A(h){return JSON.parse(JSON.stringify(h))}class ie{constructor(t){M(this,"canvas");M(this,"ctx");M(this,"replayData",null);M(this,"state","idle");M(this,"currentTime",0);M(this,"speed",1);M(this,"animationId",null);M(this,"startTimestamp",0);M(this,"pausedTime",0);M(this,"options",{});M(this,"eventCallbacks",new Map);M(this,"offscreenCanvas",null);M(this,"offscreenCtx",null);M(this,"lastFrameImageBitmap",null);M(this,"renderThrottle",0);M(this,"isRendering",!1);M(this,"seededRandom");this.canvas=t,this.ctx=t.getContext("2d"),this.initializeOffscreenCanvas(),this.seededRandom=this.createSeededRandom()}createSeededRandom(){return t=>{const i=Math.pow(2,32);return(1664525*t+1013904223)%i/i}}initializeOffscreenCanvas(){try{if(typeof OffscreenCanvas<"u"?(this.offscreenCanvas=new OffscreenCanvas(this.canvas.width,this.canvas.height),this.offscreenCtx=this.offscreenCanvas.getContext("2d")):(this.offscreenCanvas=document.createElement("canvas"),this.offscreenCanvas.width=this.canvas.width,this.offscreenCanvas.height=this.canvas.height,this.offscreenCtx=this.offscreenCanvas.getContext("2d")),this.offscreenCtx){this.offscreenCtx.imageSmoothingEnabled=!0,this.offscreenCtx.imageSmoothingQuality="high";try{this.offscreenCtx.textRenderingOptimization="optimizeSpeed"}catch{}}}catch(t){console.warn("Failed to initialize optimized offscreen canvas:",t),this.offscreenCanvas=document.createElement("canvas"),this.offscreenCanvas.width=this.canvas.width,this.offscreenCanvas.height=this.canvas.height,this.offscreenCtx=this.offscreenCanvas.getContext("2d")}}setReplayData(t,o={}){console.log("设置回放数据:",t),console.log("回放选项:",o),this.replayData=t,this.options={...o},this.speed=o.speed||t.speed||1,this.currentTime=o.startTime||0,this.state="idle",this.resetOptimizationState(),console.log("回放数据设置完成，路径数量:",t.paths.length),console.log("总时长:",t.totalDuration)}resetOptimizationState(){this.offscreenCanvas&&(this.offscreenCanvas.width=this.canvas.width,this.offscreenCanvas.height=this.canvas.height)}play(){if(console.log("播放方法调用，回放数据:",this.replayData),console.log("当前状态:",this.state),!this.replayData){console.error("没有回放数据，无法播放");return}if(this.replayData.totalDuration<=0){console.error("回放数据总时长为0，无法播放");return}if(this.replayData.paths.length===0){console.error("回放数据没有路径，无法播放");return}if(this.state==="playing"){console.log("已在播放中，忽略");return}this.state==="paused"?(console.log("从暂停状态恢复播放"),this.state="playing",this.startTimestamp=performance.now()-this.pausedTime,this.emit("replay-resume")):(console.log("开始新的播放"),this.state="playing",this.startTimestamp=performance.now(),this.pausedTime=0,this.currentTime=this.options.startTime||0,this.clearCanvas(),this.emit("replay-start")),this.animate()}pause(){this.state==="playing"&&(this.state="paused",this.pausedTime=performance.now()-this.startTimestamp,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.emit("replay-pause"))}stop(){this.state="stopped",this.currentTime=0,this.pausedTime=0,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.clearCanvas(),this.emit("replay-stop")}seek(t){if(!this.replayData)return;const o=this.options.endTime||this.replayData.totalDuration;this.currentTime=Math.max(0,Math.min(t,o)),this.state==="playing"?this.startTimestamp=performance.now()-this.currentTime/this.speed:this.pausedTime=this.currentTime/this.speed,this.renderFrame(this.currentTime)}setSpeed(t){const o=this.state==="playing";o&&this.pause(),this.speed=Math.max(.1,Math.min(5,t)),this.emit("replay-speed-change",this.speed),o&&this.play()}getState(){return this.state}getCurrentTime(){return this.currentTime}getTotalDuration(){var t;return((t=this.replayData)==null?void 0:t.totalDuration)||0}getProgress(){const t=this.getTotalDuration();return t>0?this.currentTime/t:0}animate(){if(this.state!=="playing"||!this.replayData)return;const t=performance.now();this.currentTime=(t-this.startTimestamp)*this.speed;const o=this.options.endTime||this.replayData.totalDuration;if(this.currentTime>=o){this.currentTime=o,this.state="completed",this.renderFrame(this.currentTime),this.emit("replay-complete"),this.options.loop&&setTimeout(()=>{this.currentTime=this.options.startTime||0,this.play()},500);return}this.renderFrame(this.currentTime),this.emit("replay-progress",this.getProgress(),this.currentTime),this.animationId=requestAnimationFrame(()=>this.animate())}renderFrame(t){if(!this.replayData||!this.offscreenCanvas||!this.offscreenCtx)return;const o=performance.now();if(!(o-this.renderThrottle<16)&&(this.renderThrottle=o,!this.isRendering)){this.isRendering=!0;try{this.renderToOffscreenCanvas(t),this.transferToMainCanvasSync()}finally{this.isRendering=!1}}}transferToMainCanvasSync(){if(this.offscreenCanvas)try{this.ctx.imageSmoothingEnabled=!1,this.ctx.globalCompositeOperation="copy",this.ctx.drawImage(this.offscreenCanvas,0,0),this.ctx.globalCompositeOperation="source-over",this.ctx.imageSmoothingEnabled=!0}catch{this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.offscreenCanvas,0,0)}}renderToOffscreenCanvas(t){if(!this.replayData||!this.offscreenCtx)return;const o=this.offscreenCanvas,n=this.offscreenCtx;n.globalCompositeOperation="copy",n.fillStyle="transparent",n.fillRect(0,0,o.width,o.height),n.globalCompositeOperation="source-over";let i=!1;for(let s=0;s<this.replayData.paths.length;s++){const l=this.replayData.paths[s],c=l.startTime||0,r=l.endTime||c+(l.duration||0);if(t<c)break;if(t>=r){this.drawCompletePathToOffscreen(l),!i&&Math.abs(t-r)<32&&this.emit("replay-path-end",s,l);continue}i=!0;const g=Math.max(0,Math.min(1,(t-c)/Math.max(r-c,1)));g>0&&Math.abs(t-c)<32&&this.emit("replay-path-start",s,l),this.drawPartialPathToOffscreen(l,g);break}}getPointsUpToTime(t,o,n){const i=[];for(let s=0;s<t.length;s++){const l=t[s],c=o+(l.relativeTime||s*50);if(c<=n)i.push(l);else{if(s>0){const r=t[s-1],g=o+(r.relativeTime||(s-1)*50);if(g<=n){const p=(n-g)/(c-g),d={x:r.x+(l.x-r.x)*p,y:r.y+(l.y-r.y)*p,time:n,pressure:r.pressure?r.pressure+(l.pressure||r.pressure-r.pressure)*p:l.pressure};i.push(d)}}break}}return i}calculateDynamicStrokeWidth(t,o,n,i){switch(n){case"pen":return 1;case"brush":if(o){const T=Math.sqrt(Math.pow(t.x-o.x,2)+Math.pow(t.y-o.y,2)),C=Math.max(1,(t.time||0)-(o.time||0)),w=T/C,W=Math.max(.1,Math.min(3,100/Math.max(w,1))),P=t.pressure||.5,D=Math.floor(t.x*1e3+t.y*1e3+(t.time||0)),F=.8+this.seededRandom(D)*.4;return Math.max(1,Math.min(20,i*W*(.3+P*1.4)*F))}return i;case"marker":return 12;case"pencil":const s=t.pressure||.5,l=Math.floor(t.x*1e3+t.y*1e3+(t.time||0)),c=.9+this.seededRandom(l+1)*.2;return i*(.7+s*.6)*c;case"ballpoint":const r=t.pressure||.5;return i*(.8+r*.4);case"elegant":const g=t.pressure||.5;let p=1;if(o){const T=Math.sqrt(Math.pow(t.x-o.x,2)+Math.pow(t.y-o.y,2)),C=Math.max(1,(t.time||0)-(o.time||0)),w=T/C;p=Math.max(.3,Math.min(2,50/Math.max(w,1)))}const d=g*p;return i*(.4+d*1.6);default:return i}}drawStyledStrokeForReplay(t,o,n,i){if(!(t.length<2))switch(this.ctx.strokeStyle=n,o){case"pen":if(this.ctx.lineWidth=1,this.ctx.lineCap="butt",this.ctx.lineJoin="miter",this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y),t.length>=3){for(let s=1;s<t.length-1;s++){const l=this.getControlPoint(t[s],t[s-1],t[s+1]);this.ctx.quadraticCurveTo(l.x,l.y,t[s].x,t[s].y)}this.ctx.lineTo(t[t.length-1].x,t[t.length-1].y)}else for(let s=1;s<t.length;s++)this.ctx.lineTo(t[s].x,t[s].y);this.ctx.stroke();break;case"brush":this.ctx.lineCap="round",this.ctx.lineJoin="round";for(let s=1;s<t.length;s++){const l=t[s],c=t[s-1],r=this.calculateDynamicStrokeWidth(l,c,o,i);this.ctx.lineWidth=r,this.ctx.beginPath(),this.ctx.moveTo(c.x,c.y),this.ctx.lineTo(l.x,l.y),this.ctx.stroke();const g=Math.floor(l.x*100+l.y*100+s);r>8&&this.seededRandom(g)>.6&&(this.ctx.globalAlpha=.2,this.ctx.beginPath(),this.ctx.arc(l.x,l.y,r*.3,0,Math.PI*2),this.ctx.fill(),this.ctx.globalAlpha=1)}break;case"marker":this.ctx.globalAlpha=.7,this.ctx.lineWidth=12,this.ctx.lineCap="square",this.ctx.lineJoin="bevel",this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(let s=1;s<t.length;s++)this.ctx.lineTo(t[s].x,t[s].y);this.ctx.stroke(),this.ctx.globalAlpha=.3,this.ctx.lineWidth=16,this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(let s=1;s<t.length;s++)this.ctx.lineTo(t[s].x,t[s].y);this.ctx.stroke(),this.ctx.globalAlpha=1;break;case"pencil":this.ctx.lineCap="round",this.ctx.lineJoin="round";for(let s=1;s<t.length;s++){const l=t[s],c=t[s-1],r=this.calculateDynamicStrokeWidth(l,c,o,i);this.ctx.lineWidth=r,this.ctx.globalAlpha=.8,this.ctx.beginPath(),this.ctx.moveTo(c.x,c.y),this.ctx.lineTo(l.x,l.y),this.ctx.stroke();for(let p=0;p<3;p++){const d=Math.floor(l.x*10+l.y*10+s*10+p);if(this.seededRandom(d)>.5){this.ctx.globalAlpha=.2,this.ctx.lineWidth=r*.3;const T=(this.seededRandom(d+1)-.5)*2,C=(this.seededRandom(d+2)-.5)*2;this.ctx.beginPath(),this.ctx.moveTo(c.x+T,c.y+C),this.ctx.lineTo(l.x+T,l.y+C),this.ctx.stroke()}}const g=Math.floor(l.x*5+l.y*5+s*5);if(this.seededRandom(g)>.8){this.ctx.globalAlpha=.4;for(let p=0;p<5;p++){const d=g+p*10;this.ctx.beginPath(),this.ctx.arc(l.x+(this.seededRandom(d+1)-.5)*3,l.y+(this.seededRandom(d+2)-.5)*3,this.seededRandom(d+3)*.8,0,Math.PI*2),this.ctx.fill()}}}this.ctx.globalAlpha=1;break;case"ballpoint":this.ctx.lineCap="round",this.ctx.lineJoin="round";for(let s=1;s<t.length;s++){const l=t[s],c=t[s-1],r=this.calculateDynamicStrokeWidth(l,c,o,i),g=Math.floor(l.x*50+l.y*50+s);if(this.seededRandom(g)>.1){if(this.ctx.lineWidth=r,this.ctx.globalAlpha=this.seededRandom(g+1)>.2?1:.7,this.ctx.beginPath(),s<t.length-1){const d=t[s+1],T=this.getControlPoint(l,c,d);this.ctx.moveTo(c.x,c.y),this.ctx.quadraticCurveTo(T.x,T.y,l.x,l.y)}else this.ctx.moveTo(c.x,c.y),this.ctx.lineTo(l.x,l.y);this.ctx.stroke()}const p=Math.floor(l.x*20+l.y*20+s*3);this.seededRandom(p)>.95&&(this.ctx.globalAlpha=.8,this.ctx.beginPath(),this.ctx.arc(l.x,l.y,r*.8,0,Math.PI*2),this.ctx.fill())}this.ctx.globalAlpha=1;break;case"elegant":this.drawElegantStroke(t,n,i);break}}drawElegantStroke(t,o,n){if(!(t.length<2)){this.ctx.strokeStyle=o,this.ctx.fillStyle=o,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.globalCompositeOperation="source-over";for(let i=1;i<t.length;i++){const s=t[i],l=t[i-1],c=this.calculateDynamicStrokeWidth(s,l,"elegant",n),r=i>1?this.calculateDynamicStrokeWidth(l,t[i-2],"elegant",n):c;this.drawElegantSegment(l,s,r,c)}this.addElegantConnections(t,n)}}drawElegantSegment(t,o,n,i){const s=Math.max(3,Math.floor(Math.sqrt(Math.pow(o.x-t.x,2)+Math.pow(o.y-t.y,2))/2));this.ctx.beginPath();const l=[],c=[];for(let r=0;r<=s;r++){const g=r/s,p=this.smoothStep(g),d=t.x+(o.x-t.x)*p,T=t.y+(o.y-t.y)*p,C=n+(i-n)*p,w=o.x-t.x,W=o.y-t.y,P=Math.sqrt(w*w+W*W);if(P>0){const D=-W/P*C/2,F=w/P*C/2;l.push({x:d+D,y:T+F}),c.push({x:d-D,y:T-F})}}if(l.length>0&&c.length>0){this.ctx.moveTo(l[0].x,l[0].y);for(let r=1;r<l.length;r++)this.ctx.lineTo(l[r].x,l[r].y);for(let r=c.length-1;r>=0;r--)this.ctx.lineTo(c[r].x,c[r].y);this.ctx.closePath(),this.ctx.fill()}}addElegantConnections(t,o){for(let n=1;n<t.length-1;n++){const i=t[n-1],s=t[n],l=t[n+1],c=Math.atan2(s.y-i.y,s.x-i.x),r=Math.atan2(l.y-s.y,l.x-s.x);if(Math.abs(r-c)>.3){const p=this.calculateDynamicStrokeWidth(s,i,"elegant",o);this.ctx.beginPath(),this.ctx.arc(s.x,s.y,p/3,0,Math.PI*2),this.ctx.fill()}}}smoothStep(t){return t*t*(3-2*t)}getControlPoint(t,o,n){const s={length:Math.sqrt(Math.pow(n.x-o.x,2)+Math.pow(n.y-o.y,2)),angle:Math.atan2(n.y-o.y,n.x-o.x)},l=s.angle+Math.PI,c=s.length*.2;return{x:t.x+Math.cos(l)*c,y:t.y+Math.sin(l)*c,time:t.time||0}}clearCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}on(t,o){this.eventCallbacks.has(t)||this.eventCallbacks.set(t,[]),this.eventCallbacks.get(t).push(o)}off(t,o){if(this.eventCallbacks.has(t))if(o){const n=this.eventCallbacks.get(t),i=n.indexOf(o);i>-1&&n.splice(i,1)}else this.eventCallbacks.delete(t)}emit(t,...o){const n=this.eventCallbacks.get(t);n&&n.forEach(i=>i(...o))}drawCompletePathToOffscreen(t){if(!this.offscreenCtx||t.points.length<2)return;const o=this.ctx;this.ctx=this.offscreenCtx;const n=t.penStyle||this.options.penStyle||"pen";this.drawStyledStrokeForReplay(t.points,n,t.strokeColor,t.strokeWidth),this.ctx=o}drawPartialPathToOffscreen(t,o){if(!this.offscreenCtx||t.points.length<2)return;const n=t.startTime||0,i=t.duration||0,s=n+i*o,l=this.getPointsUpToTime(t.points,n,s);if(l.length<2)return;const c=this.ctx;this.ctx=this.offscreenCtx;const r=t.penStyle||this.options.penStyle||"pen";this.drawStyledStrokeForReplay(l,r,t.strokeColor,t.strokeWidth),this.ctx=c}destroy(){this.stop(),this.eventCallbacks.clear(),this.replayData=null,this.lastFrameImageBitmap&&(this.lastFrameImageBitmap.close(),this.lastFrameImageBitmap=null)}}function le(h){const t=h.paths.map(r=>{const g=r.points.map((d,T)=>{var w;let C;if(d.time&&r.points[0].time)C=d.time-r.points[0].time;else if(T===0)C=0;else{const W=r.points[T-1],D=Math.sqrt(Math.pow(d.x-W.x,2)+Math.pow(d.y-W.y,2))/100*1e3;C=(((w=g[T-1])==null?void 0:w.relativeTime)||0)+Math.max(D,16)}return{...d,relativeTime:C}}),p=g.length>0?g[g.length-1].relativeTime:0;return{...r,points:g,duration:p}}),o=[];for(let r=0;r<t.length;r++){const g=t[r];let p;if(r===0)p=0;else{const C=o[r-1],w=Be(h.paths[r-1].points,h.paths[r].points);p=C.endTime+w}const d=p+g.duration,T={...g,startTime:p,endTime:d};console.log(`路径 ${r}: 开始时间=${p}, 结束时间=${d}, 持续时间=${g.duration}`),o.push(T)}const n=o.length>0?o[o.length-1].endTime:0;console.log("回放数据生成完成:"),console.log("- 路径数量:",o.length),console.log("- 总时长:",n),console.log("- 路径详情:",o.map(r=>({startTime:r.startTime,endTime:r.endTime,duration:r.duration,pointCount:r.points.length})));const i=o.reduce((r,g)=>r+$e(g.points),0),s=n>0?i/(n/1e3):0,l=o.slice(1).map((r,g)=>{const p=o[g];return r.startTime-p.endTime}),c=l.length>0?l.reduce((r,g)=>r+g,0)/l.length:0;return{paths:o,totalDuration:n,speed:1,metadata:{deviceType:ze(h),averageSpeed:s,totalDistance:i,averagePauseTime:c}}}function Be(h,t){if(h.length===0||t.length===0)return 200;const o=h[h.length-1],n=t[0];if(o.time&&n.time)return Math.max(n.time-o.time,50);const i=Math.sqrt(Math.pow(n.x-o.x,2)+Math.pow(n.y-o.y,2));return Math.min(Math.max(i*2,100),1e3)}function ze(h){const t=h.paths.reduce((s,l)=>s+l.points.length,0),o=h.paths.length;if(t===0)return"touch";const n=t/o;return n>20?"touch":n<10?"mouse":h.paths.some(s=>s.points.some(l=>l.pressure!==void 0))?"pen":"touch"}function $e(h){let t=0;for(let o=1;o<h.length;o++){const n=h[o].x-h[o-1].x,i=h[o].y-h[o-1].y;t+=Math.sqrt(n*n+i*i)}return t}const j={pen:{name:"钢笔",description:"极细线条，锐利精准，商务签名",strokeWidth:1,smoothing:!0,pressure:{enabled:!1,min:1,max:1},lineCap:"butt",lineJoin:"miter",recommendedColor:"#000080"},brush:{name:"毛笔",description:"粗细变化极大，传统书法效果",strokeWidth:8,smoothing:!0,pressure:{enabled:!0,min:1,max:16},lineCap:"round",lineJoin:"round",recommendedColor:"#2c3e50"},marker:{name:"马克笔",description:"超粗线条，荧光笔效果",strokeWidth:12,smoothing:!1,pressure:{enabled:!1,min:10,max:14},lineCap:"square",lineJoin:"bevel",recommendedColor:"#ff6b35"},pencil:{name:"铅笔",description:"粗糙纹理，素描效果",strokeWidth:3,smoothing:!1,pressure:{enabled:!0,min:2,max:5},lineCap:"round",lineJoin:"round",recommendedColor:"#666666"},ballpoint:{name:"圆珠笔",description:"细线条，轻微断续效果",strokeWidth:1.2,smoothing:!0,pressure:{enabled:!0,min:.8,max:1.8},lineCap:"round",lineJoin:"round",recommendedColor:"#1e3a8a"},elegant:{name:"优雅笔",description:"适中线条，由粗到细的渐变之美，连笔流畅",strokeWidth:3,smoothing:!0,pressure:{enabled:!0,min:.4,max:2.5},lineCap:"round",lineJoin:"round",recommendedColor:"#374151"}};function re(h){return j[h]}function Ye(){return Object.entries(j).map(([h,t])=>({key:h,config:t}))}function he(h,t){const o=re(h);return{strokeWidth:o.strokeWidth,smoothing:o.smoothing,pressure:o.pressure,lineCap:o.lineCap,lineJoin:o.lineJoin,strokeColor:t||o.recommendedColor||"#000000"}}const Xe=["width","height"],Le={key:1,class:"signature-toolbar"},He=["disabled"],Ue=["disabled"],je=["disabled"],Ge={key:2,class:"replay-controls"},Qe={class:"replay-buttons"},Ke=["disabled"],Ze={key:0},et={key:1},tt=["disabled"],nt={class:"replay-progress"},at=["max","value","disabled"],ot={class:"time-display"},st={class:"replay-speed"},it=u.defineComponent({__name:"ElectronicSignature",props:{showToolbar:{type:Boolean,default:!1},width:{default:"100%"},height:{default:300},penStyle:{default:"pen"},strokeColor:{default:"#000000"},strokeWidth:{default:2},backgroundColor:{default:"transparent"},disabled:{type:Boolean,default:!1},placeholder:{default:"请在此处签名"},smoothing:{type:Boolean,default:!0},pressureSensitive:{type:Boolean,default:!1},minStrokeWidth:{default:1},maxStrokeWidth:{default:4},borderStyle:{default:"1px solid #ddd"},borderRadius:{default:"4px"},replayMode:{type:Boolean},replayData:{},replayOptions:{}},emits:["signature-start","signature-drawing","signature-end","signature-clear","signature-undo","signature-redo","replay-start","replay-progress","replay-pause","replay-resume","replay-stop","replay-complete","replay-path-start","replay-path-end","replay-speed-change"],setup(h,{expose:t,emit:o}){const n=h,i=o,s=u.ref(),l=u.ref(!1),c=u.ref(null),r=u.ref(z(0,0)),g=u.ref([]),p=u.ref(-1),d=u.ref(null),T=u.ref(!1),C=u.ref("idle"),w=u.ref(0),W=u.ref(0),P=u.computed(()=>typeof n.width=="number"?n.width:800),D=u.computed(()=>typeof n.height=="number"?n.height:300),F=u.computed(()=>({position:"relative",display:"inline-block",width:typeof n.width=="string"?n.width:`${n.width}px`,height:typeof n.height=="string"?n.height:`${n.height}px`})),gt=u.computed(()=>({border:n.borderStyle,borderRadius:n.borderRadius,backgroundColor:n.backgroundColor,cursor:n.disabled?"not-allowed":"crosshair",display:"block",width:"100%",height:"100%"})),ft=u.computed(()=>({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"#999",fontSize:"14px",pointerEvents:"none",userSelect:"none"})),pt=u.computed(()=>T.value?!1:n.placeholder&&B(r.value)),de=u.computed(()=>p.value>0),me=u.computed(()=>p.value<g.value.length-1),ge=u.computed(()=>T.value&&d.value),I=u.computed(()=>!ge.value&&!n.disabled),yt=u.computed(()=>{var e;return ge.value&&((e=n.replayOptions)==null?void 0:e.showControls)!==!1}),E=u.computed(()=>{if(n.penStyle){const e=he(n.penStyle,n.strokeColor);return{strokeColor:e.strokeColor,strokeWidth:n.strokeWidth||e.strokeWidth,smoothing:n.smoothing!==void 0?n.smoothing:e.smoothing,pressure:{enabled:n.pressureSensitive!==void 0?n.pressureSensitive:e.pressure.enabled,min:n.minStrokeWidth||e.pressure.min,max:n.maxStrokeWidth||e.pressure.max},lineCap:e.lineCap,lineJoin:e.lineJoin}}return{strokeColor:n.strokeColor||"#000000",strokeWidth:n.strokeWidth||2,smoothing:n.smoothing!==void 0?n.smoothing:!0,pressure:{enabled:n.pressureSensitive||!1,min:n.minStrokeWidth||1,max:n.maxStrokeWidth||4},lineCap:"round",lineJoin:"round"}}),fe=()=>{var e;return((e=s.value)==null?void 0:e.getContext("2d"))||null},X=(e,a)=>{const f=s.value,b=f.getBoundingClientRect(),m=f.width/b.width,y=f.height/b.height;return{x:(e-b.left)*m,y:(a-b.top)*y,time:Date.now()}},pe=e=>{if(!I.value)return;l.value=!0;const a=performance.now(),f={...e,time:a};c.value={points:[f],strokeColor:n.strokeColor,strokeWidth:n.strokeWidth,penStyle:n.penStyle,startTime:a,endTime:a,duration:0},i("signature-start")},J=(e,a,f,b)=>{switch(f){case"pen":return 1;case"brush":if(a){const _=Math.sqrt(Math.pow(e.x-a.x,2)+Math.pow(e.y-a.y,2)),V=Math.max(1,(e.time||0)-(a.time||0)),q=_/V,U=Math.max(.1,Math.min(3,100/Math.max(q,1))),$=e.pressure||.5,Y=.8+Math.random()*.4;return Math.max(1,Math.min(20,b*U*(.3+$*1.4)*Y))}return b;case"marker":return 12;case"pencil":const m=e.pressure||.5,y=.9+Math.random()*.2;return b*(.7+m*.6)*y;case"ballpoint":const x=e.pressure||.5;return b*(.8+x*.4);case"elegant":const S=e.pressure||.5;let k=1;if(a){const _=Math.sqrt(Math.pow(e.x-a.x,2)+Math.pow(e.y-a.y,2)),V=Math.max(1,(e.time||0)-(a.time||0)),q=_/V;k=Math.max(.3,Math.min(2,50/Math.max(q,1)))}const R=S*k;return b*(.4+R*1.6);default:return b}},Q=(e,a,f)=>{var b;if(!(a.length<2))switch(e.strokeStyle=((b=c.value)==null?void 0:b.strokeColor)||E.value.strokeColor,e.lineCap=E.value.lineCap||"round",e.lineJoin=E.value.lineJoin||"round",f){case"pen":if(e.lineWidth=1,e.lineCap="butt",e.lineJoin="miter",e.beginPath(),e.moveTo(a[0].x,a[0].y),a.length>=3){for(let m=1;m<a.length-1;m++){const y=ye(a[m],a[m-1],a[m+1]);e.quadraticCurveTo(y.x,y.y,a[m].x,a[m].y)}e.lineTo(a[a.length-1].x,a[a.length-1].y)}else for(let m=1;m<a.length;m++)e.lineTo(a[m].x,a[m].y);e.stroke();break;case"brush":e.lineCap="round",e.lineJoin="round";for(let m=1;m<a.length;m++){const y=a[m],x=a[m-1],S=J(y,x,f,E.value.strokeWidth),k=e.createLinearGradient(x.x,x.y,y.x,y.y);k.addColorStop(0,e.strokeStyle),k.addColorStop(1,e.strokeStyle),e.lineWidth=S,e.beginPath(),e.moveTo(x.x,x.y),e.lineTo(y.x,y.y),e.stroke(),S>8&&Math.random()>.6&&(e.globalAlpha=.2,e.beginPath(),e.arc(y.x,y.y,S*.3,0,Math.PI*2),e.fill(),e.globalAlpha=1)}break;case"marker":e.globalAlpha=.7,e.lineWidth=12,e.lineCap="square",e.lineJoin="bevel",e.beginPath(),e.moveTo(a[0].x,a[0].y);for(let m=1;m<a.length;m++)e.lineTo(a[m].x,a[m].y);e.stroke(),e.globalAlpha=.3,e.lineWidth=16,e.beginPath(),e.moveTo(a[0].x,a[0].y);for(let m=1;m<a.length;m++)e.lineTo(a[m].x,a[m].y);e.stroke(),e.globalAlpha=1;break;case"pencil":e.lineCap="round",e.lineJoin="round";for(let m=1;m<a.length;m++){const y=a[m],x=a[m-1],S=J(y,x,f,E.value.strokeWidth);e.lineWidth=S,e.globalAlpha=.8,e.beginPath(),e.moveTo(x.x,x.y),e.lineTo(y.x,y.y),e.stroke();for(let k=0;k<3;k++)if(Math.random()>.5){e.globalAlpha=.2,e.lineWidth=S*.3;const R=(Math.random()-.5)*2,_=(Math.random()-.5)*2;e.beginPath(),e.moveTo(x.x+R,x.y+_),e.lineTo(y.x+R,y.y+_),e.stroke()}if(Math.random()>.8){e.globalAlpha=.4;for(let k=0;k<5;k++)e.beginPath(),e.arc(y.x+(Math.random()-.5)*3,y.y+(Math.random()-.5)*3,Math.random()*.8,0,Math.PI*2),e.fill()}}e.globalAlpha=1;break;case"ballpoint":e.lineCap="round",e.lineJoin="round";for(let m=1;m<a.length;m++){const y=a[m],x=a[m-1],S=J(y,x,f,E.value.strokeWidth);if(Math.random()>.1){if(e.lineWidth=S,e.globalAlpha=Math.random()>.2?1:.7,e.beginPath(),E.value.smoothing&&m<a.length-1){const k=a[m+1],R=ye(y,x,k);e.moveTo(x.x,x.y),e.quadraticCurveTo(R.x,R.y,y.x,y.y)}else e.moveTo(x.x,x.y),e.lineTo(y.x,y.y);e.stroke()}Math.random()>.95&&(e.globalAlpha=.8,e.beginPath(),e.arc(y.x,y.y,S*.8,0,Math.PI*2),e.fill())}e.globalAlpha=1;break;case"elegant":xt(e,a);break}},vt=()=>{if(!c.value||c.value.points.length<2)return;const e=fe();if(!e)return;const a=c.value.points,f=a.length,b=n.penStyle||"pen";if(f===2)Q(e,a,b);else if(f>=3){const m=a.slice(-3);Q(e,m,b)}},xt=(e,a)=>{var f,b;if(!(a.length<2)){e.strokeStyle=((f=c.value)==null?void 0:f.strokeColor)||E.value.strokeColor,e.fillStyle=((b=c.value)==null?void 0:b.strokeColor)||E.value.strokeColor,e.lineCap="round",e.lineJoin="round",e.globalCompositeOperation="source-over";for(let m=1;m<a.length;m++){const y=a[m],x=a[m-1],S=J(y,x,"elegant",E.value.strokeWidth),k=m>1?J(x,a[m-2],"elegant",E.value.strokeWidth):S;Ct(e,x,y,k,S)}bt(e,a)}},Ct=(e,a,f,b,m)=>{const y=Math.max(3,Math.floor(Math.sqrt(Math.pow(f.x-a.x,2)+Math.pow(f.y-a.y,2))/2));e.beginPath();const x=[],S=[];for(let k=0;k<=y;k++){const R=k/y,_=kt(R),V=a.x+(f.x-a.x)*_,q=a.y+(f.y-a.y)*_,U=b+(m-b)*_,$=f.x-a.x,Y=f.y-a.y,Z=Math.sqrt($*$+Y*Y);if(Z>0){const Je=-Y/Z*U/2,Ve=$/Z*U/2;x.push({x:V+Je,y:q+Ve}),S.push({x:V-Je,y:q-Ve})}}if(x.length>0&&S.length>0){e.moveTo(x[0].x,x[0].y);for(let k=1;k<x.length;k++)e.lineTo(x[k].x,x[k].y);for(let k=S.length-1;k>=0;k--)e.lineTo(S[k].x,S[k].y);e.closePath(),e.fill()}},bt=(e,a)=>{for(let f=1;f<a.length-1;f++){const b=a[f-1],m=a[f],y=a[f+1],x=Math.atan2(m.y-b.y,m.x-b.x),S=Math.atan2(y.y-m.y,y.x-m.x);if(Math.abs(S-x)>.3){const R=J(m,b,"elegant",E.value.strokeWidth);e.beginPath(),e.arc(m.x,m.y,R/3,0,Math.PI*2),e.fill()}}},kt=e=>e*e*(3-2*e),ye=(e,a,f)=>{const m={length:Math.sqrt(Math.pow(f.x-a.x,2)+Math.pow(f.y-a.y,2)),angle:Math.atan2(f.y-a.y,f.x-a.x)},y=m.angle+Math.PI,x=m.length*.2;return{x:e.x+Math.cos(y)*x,y:e.y+Math.sin(y)*x,time:e.time||0}},Tt=(e,a)=>{if(a.points.length<2)return;const f=a.penStyle||n.penStyle||"pen",b=c.value;c.value=a,Q(e,a.points,f),c.value=b},ve=e=>{if(!l.value||!c.value||!I.value)return;const a=performance.now(),f={...e,time:a};c.value.points.push(f),c.value.startTime&&(c.value.endTime=a,c.value.duration=a-c.value.startTime),vt(),ke(),i("signature-drawing",r.value)},xe=()=>{if(!(!l.value||!c.value)){if(l.value=!1,c.value.points.length>0){const e=c.value.points[c.value.points.length-1];e.time&&c.value.startTime&&(c.value.endTime=e.time,c.value.duration=e.time-c.value.startTime)}r.value.paths.push(c.value),r.value.isEmpty=!1,r.value.timestamp=Date.now(),L(),N(),c.value=null,i("signature-end",r.value)}},wt=e=>{e.preventDefault();const a=X(e.clientX,e.clientY);pe(a)},St=e=>{if(e.preventDefault(),!l.value)return;const a=X(e.clientX,e.clientY);ve(a)},Ce=e=>{e.preventDefault(),xe()},Mt=e=>{if(e.preventDefault(),e.touches.length!==1)return;const a=e.touches[0],f=X(a.clientX,a.clientY);pe(f)},Pt=e=>{if(e.preventDefault(),e.touches.length!==1||!l.value)return;const a=e.touches[0],f=X(a.clientX,a.clientY);ve(f)},be=e=>{e.preventDefault(),xe()},ke=()=>{r.value.canvasSize={width:P.value,height:D.value},r.value.isEmpty=B(r.value)},L=()=>{g.value=g.value.slice(0,p.value+1),g.value.push(A(r.value)),p.value=g.value.length-1;const e=50;g.value.length>e&&(g.value=g.value.slice(-e),p.value=g.value.length-1)},N=()=>{const e=fe();e&&(e.clearRect(0,0,P.value,D.value),n.backgroundColor&&n.backgroundColor!=="transparent"&&(e.fillStyle=n.backgroundColor,e.fillRect(0,0,P.value,D.value)),r.value.paths.forEach(a=>{a.points.length>0&&Tt(e,a)}))},H=()=>{if(console.log("初始化回放控制器"),console.log("canvas引用是否存在:",!!s.value),!s.value){console.error("canvas引用不存在，无法初始化回放控制器");return}d.value&&(console.log("销毁现有回放控制器"),d.value.destroy()),console.log("创建新的回放控制器"),d.value=new ie(s.value),console.log("回放控制器创建成功:",!!d.value),d.value.on("replay-start",()=>{C.value="playing",i("replay-start")}),d.value.on("replay-progress",(e,a)=>{w.value=e,W.value=a,i("replay-progress",e,a)}),d.value.on("replay-pause",()=>{C.value="paused",i("replay-pause")}),d.value.on("replay-resume",()=>{C.value="playing",i("replay-resume")}),d.value.on("replay-stop",()=>{C.value="stopped",i("replay-stop")}),d.value.on("replay-complete",()=>{C.value="completed",i("replay-complete")}),d.value.on("replay-path-start",(e,a)=>{i("replay-path-start",e,a)}),d.value.on("replay-path-end",(e,a)=>{i("replay-path-end",e,a)}),d.value.on("replay-speed-change",e=>{i("replay-speed-change",e)})},Te=(e,a)=>{if(d.value||H(),d.value){T.value=!0;const f={...a,drawOptions:E.value,penStyle:n.penStyle};d.value.setReplayData(e,f),console.log("startReplay调用，自动播放:",a==null?void 0:a.autoPlay),(a==null?void 0:a.autoPlay)===!0&&d.value.play()}},we=e=>{T.value=e,!e&&d.value&&(d.value.stop(),N())},Dt=()=>B(r.value)?null:le(r.value),Se=()=>{console.log("play方法被调用"),console.log("回放控制器是否存在:",!!d.value),d.value||(console.log("回放控制器不存在，尝试初始化"),H()),d.value?(console.log("调用回放控制器的play方法"),d.value.play()):console.error("回放控制器初始化失败，无法播放")},Me=()=>{var e;(e=d.value)==null||e.pause()},Pe=()=>{var e;(e=d.value)==null||e.stop()},De=e=>{var a;(a=d.value)==null||a.seek(e)},Ee=e=>{var a;(a=d.value)==null||a.setSpeed(e)},Et=()=>{var e;return((e=d.value)==null?void 0:e.getState())||"idle"},Wt=()=>{var e;return((e=d.value)==null?void 0:e.getCurrentTime())||0},K=()=>{var e;return((e=d.value)==null?void 0:e.getTotalDuration())||0},Rt=()=>{var e;return((e=d.value)==null?void 0:e.getProgress())||0},We=e=>{const a=Math.floor(e/1e3),f=Math.floor(a/60),b=a%60;return`${f}:${b.toString().padStart(2,"0")}`},Re=()=>{I.value&&(r.value=z(P.value,D.value),N(),L(),i("signature-clear"))},Ie=()=>{!de.value||!I.value||(p.value--,r.value=A(g.value[p.value]),N(),i("signature-undo",r.value))},_e=()=>{!me.value||!I.value||(p.value++,r.value=A(g.value[p.value]),N(),i("signature-redo",r.value))},Oe=e=>{const a=s.value;return oe(a,r.value,e)},Ae=()=>B(r.value),Ne=async e=>{if(!I.value)return;const a=s.value;await se(a,e),r.value=z(P.value,D.value),r.value.isEmpty=!1,L()},It=()=>A(r.value),_t=e=>{I.value&&(r.value=A(e),N(),L())},Fe=(e,a)=>{const f=e||P.value,b=a||D.value,m=Oe({format:"png"});u.nextTick(()=>{const y=s.value;y.width=f,y.height=b,Ae()||Ne(m),ke()})},Ot=()=>{const e=s.value;e.width=P.value,e.height=D.value,r.value=z(P.value,D.value),g.value=[A(r.value)],p.value=0,N()};return u.watch([()=>n.width,()=>n.height],()=>{u.nextTick(()=>{s.value&&Fe()})}),u.watch(()=>n.replayMode,e=>{e!==void 0&&we(e)}),u.watch(()=>n.replayData,e=>{if(console.log("watch监听到回放数据变化:",e),console.log("当前回放模式:",n.replayMode),console.log("回放控制器是否存在:",!!d.value),e&&n.replayMode)if(d.value||(console.log("回放控制器未初始化，先初始化"),H()),d.value){console.log("开始设置回放数据到控制器");const a={...n.replayOptions,drawOptions:E.value,penStyle:n.penStyle};d.value.setReplayData(e,a),console.log("回放数据已更新:",e)}else console.error("回放控制器初始化失败");else e||console.log("回放数据为空，跳过设置"),n.replayMode||console.log("不在回放模式，跳过设置")},{immediate:!0}),u.onMounted(()=>{u.nextTick(()=>{Ot(),H(),n.replayMode&&n.replayData&&Te(n.replayData,n.replayOptions)})}),u.onUnmounted(()=>{d.value&&(d.value.destroy(),d.value=null)}),t({clear:Re,undo:Ie,redo:_e,save:Oe,isEmpty:Ae,fromDataURL:Ne,getSignatureData:It,setSignatureData:_t,resize:Fe,startReplay:Te,getReplayData:Dt,setReplayMode:we,play:Se,pause:Me,stop:Pe,seek:De,setSpeed:Ee,getState:Et,getCurrentTime:Wt,getTotalDuration:K,getProgress:Rt}),(e,a)=>(u.openBlock(),u.createElementBlock("div",{class:"electronic-signature",style:u.normalizeStyle(F.value)},[u.createElementVNode("canvas",{ref_key:"canvasRef",ref:s,width:P.value,height:D.value,style:u.normalizeStyle(gt.value),onMousedown:wt,onMousemove:St,onMouseup:Ce,onMouseleave:Ce,onTouchstart:Mt,onTouchmove:Pt,onTouchend:be,onTouchcancel:be},null,44,Xe),pt.value?(u.openBlock(),u.createElementBlock("div",{key:0,class:"signature-placeholder",style:u.normalizeStyle(ft.value)},u.toDisplayString(e.placeholder),5)):u.createCommentVNode("",!0),e.showToolbar?(u.openBlock(),u.createElementBlock("div",Le,[u.createElementVNode("button",{onClick:Re,disabled:!I.value},"清除",8,He),u.createElementVNode("button",{onClick:Ie,disabled:!I.value||!de.value},"撤销",8,Ue),u.createElementVNode("button",{onClick:_e,disabled:!I.value||!me.value},"重做",8,je)])):u.createCommentVNode("",!0),yt.value?(u.openBlock(),u.createElementBlock("div",Ge,[u.createElementVNode("div",Qe,[u.createElementVNode("button",{onClick:a[0]||(a[0]=f=>C.value==="playing"?Me():Se()),disabled:C.value==="idle",class:"replay-btn play-pause-btn"},[C.value==="playing"?(u.openBlock(),u.createElementBlock("span",Ze,"⏸️")):(u.openBlock(),u.createElementBlock("span",et,"▶️"))],8,Ke),u.createElementVNode("button",{onClick:a[1]||(a[1]=f=>Pe()),disabled:C.value==="idle",class:"replay-btn stop-btn"}," ⏹️ ",8,tt)]),u.createElementVNode("div",nt,[u.createElementVNode("input",{type:"range",min:"0",max:K(),value:W.value,onInput:a[2]||(a[2]=f=>De(Number(f.target.value))),class:"progress-slider",disabled:C.value==="idle"},null,40,at),u.createElementVNode("div",ot,[u.createElementVNode("span",null,u.toDisplayString(We(W.value)),1),a[4]||(a[4]=u.createElementVNode("span",null,"/",-1)),u.createElementVNode("span",null,u.toDisplayString(We(K())),1)])]),u.createElementVNode("div",st,[a[6]||(a[6]=u.createElementVNode("label",null,"速度:",-1)),u.createElementVNode("select",{onChange:a[3]||(a[3]=f=>Ee(Number(f.target.value))),class:"speed-select"},a[5]||(a[5]=[u.createElementVNode("option",{value:"0.5"},"0.5x",-1),u.createElementVNode("option",{value:"1",selected:""},"1x",-1),u.createElementVNode("option",{value:"1.5"},"1.5x",-1),u.createElementVNode("option",{value:"2"},"2x",-1)]),32)])])):u.createCommentVNode("",!0)],4))}}),Ft="",G=((h,t)=>{const o=h.__vccOpts||h;for(const[n,i]of t)o[n]=i;return o})(it,[["__scopeId","data-v-bb077751"]]);function ce(){return window.devicePixelRatio||1}function lt(h){const t=h.getContext("2d"),o=ce(),n=h.clientWidth,i=h.clientHeight;return h.width=n*o,h.height=i*o,t.scale(o,o),h.style.width=n+"px",h.style.height=i+"px",t}function ue(h){if(h.paths.length===0)return{minX:0,minY:0,maxX:0,maxY:0,width:0,height:0};let t=1/0,o=1/0,n=-1/0,i=-1/0;return h.paths.forEach(s=>{s.points.forEach(l=>{t=Math.min(t,l.x),o=Math.min(o,l.y),n=Math.max(n,l.x),i=Math.max(i,l.y)})}),{minX:t,minY:o,maxX:n,maxY:i,width:n-t,height:i-o}}function rt(h,t,o=10){const n=ue(t);if(n.width===0||n.height===0){const r=document.createElement("canvas");return r.width=1,r.height=1,r}const i=document.createElement("canvas"),s=i.getContext("2d"),l=n.width+o*2,c=n.height+o*2;return i.width=l,i.height=c,s.drawImage(h,n.minX-o,n.minY-o,l,c,0,0,l,c),i}function ht(h,t,o,n=!0){const i=document.createElement("canvas"),s=i.getContext("2d");let l=t,c=o;if(n){const r=h.width/h.height,g=t/o;r>g?c=t/r:l=o*r}return i.width=l,i.height=c,s.imageSmoothingEnabled=!0,s.imageSmoothingQuality="high",s.drawImage(h,0,0,l,c),i}function ct(h,t,o={}){const{fontSize:n=12,fontFamily:i="Arial",color:s="#999",opacity:l=.5,position:c="bottom-right"}=o,r=document.createElement("canvas"),g=r.getContext("2d");r.width=h.width,r.height=h.height,g.drawImage(h,0,0),g.font=`${n}px ${i}`,g.fillStyle=s,g.globalAlpha=l;const d=g.measureText(t).width,T=n;let C,w;switch(c){case"top-left":C=10,w=T+10;break;case"top-right":C=h.width-d-10,w=T+10;break;case"bottom-left":C=10,w=h.height-10;break;case"bottom-right":C=h.width-d-10,w=h.height-10;break;case"center":C=(h.width-d)/2,w=(h.height+T)/2;break;default:C=h.width-d-10,w=h.height-10}return g.fillText(t,C,w),g.globalAlpha=1,r}function ut(h){const t=document.createElement("canvas"),o=t.getContext("2d");t.width=h.width,t.height=h.height,o.drawImage(h,0,0);const n=o.getImageData(0,0,h.width,h.height),i=n.data;for(let s=0;s<i.length;s+=4){const l=i[s]*.299+i[s+1]*.587+i[s+2]*.114;i[s]=l,i[s+1]=l,i[s+2]=l}return o.putImageData(n,0,0),t}const dt={install:h=>{h.component("ElectronicSignature",G)},ElectronicSignature:G},mt="1.0.0";v.ElectronicSignature=G,v.PEN_STYLE_CONFIGS=j,v.SignatureReplayController=ie,v.addWatermark=ct,v.calculateStrokeWidth=ne,v.cloneSignatureData=A,v.convertToGrayscale=ut,v.createDrawOptionsFromPenStyle=he,v.createEmptySignatureData=z,v.createReplayData=le,v.cropSignature=rt,v.default=dt,v.drawSmoothPath=qe,v.exportSignature=oe,v.getAllPenStyles=Ye,v.getAngle=ee,v.getControlPoint=te,v.getDevicePixelRatio=ce,v.getDistance=O,v.getPenStyleConfig=re,v.getSignatureBounds=ue,v.isSignatureEmpty=B,v.loadImageToCanvas=se,v.resizeSignature=ht,v.setupHighDPICanvas=lt,v.signatureToSVG=ae,v.version=mt,Object.defineProperties(v,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});

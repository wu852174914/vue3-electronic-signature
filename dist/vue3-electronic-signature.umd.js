(function(C,u){typeof exports=="object"&&typeof module<"u"?u(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],u):(C=typeof globalThis<"u"?globalThis:C||self,u(C.Vue3ElectronicSignature={},C.Vue))})(this,function(C,u){"use strict";var zt=Object.defineProperty;var $t=(C,u,A)=>u in C?zt(C,u,{enumerable:!0,configurable:!0,writable:!0,value:A}):C[u]=A;var W=(C,u,A)=>($t(C,typeof u!="symbol"?u+"":u,A),A);function A(l,t){return Math.sqrt(Math.pow(t.x-l.x,2)+Math.pow(t.y-l.y,2))}function oe(l,t){return Math.atan2(t.y-l.y,t.x-l.x)}function se(l,t,o,a){const s=t||l,i=o||l,c=.2,h=oe(s,i)*(a?1:-1),r=A(s,i)*c;return{x:l.x+Math.cos(h)*r,y:l.y+Math.sin(h)*r,time:l.time}}function ie(l,t,o){if(!o.pressure.enabled)return o.strokeWidth;const a=A(l,t),s=t.time-l.time,i=s>0?a/s:0,c=Math.max(.1,Math.min(1,1-i*.01)),{min:h,max:r}=o.pressure;return h+(r-h)*c}function qe(l,t,o){if(t.length<2)return;if(l.strokeStyle=o.strokeColor,l.lineCap="round",l.lineJoin="round",!o.smoothing||t.length<3){l.beginPath(),l.lineWidth=o.strokeWidth,l.moveTo(t[0].x,t[0].y);for(let s=1;s<t.length;s++)l.lineTo(t[s].x,t[s].y);l.stroke();return}l.beginPath(),l.moveTo(t[0].x,t[0].y);for(let s=1;s<t.length-1;s++){const i=t[s],c=t[s+1];o.pressure.enabled?l.lineWidth=ie(t[s-1],i,o):l.lineWidth=o.strokeWidth;const h=se(i,t[s-1],c);l.quadraticCurveTo(h.x,h.y,i.x,i.y)}const a=t[t.length-1];l.lineTo(a.x,a.y),l.stroke()}function le(l){const{canvasSize:t,paths:o}=l;let a=`<svg width="${t.width}" height="${t.height}" xmlns="http://www.w3.org/2000/svg">`;return o.forEach(s=>{if(s.points.length<2)return;let i=`M ${s.points[0].x} ${s.points[0].y}`;for(let c=1;c<s.points.length;c++)i+=` L ${s.points[c].x} ${s.points[c].y}`;a+=`<path d="${i}" stroke="${s.strokeColor}" stroke-width="${s.strokeWidth}" fill="none" stroke-linecap="round" stroke-linejoin="round"/>`}),a+="</svg>",a}function re(l,t,o={format:"png"}){const{format:a,quality:s=.9,size:i,backgroundColor:c}=o;if(a==="svg")return le(t);const h=document.createElement("canvas"),r=h.getContext("2d");if(i){h.width=i.width,h.height=i.height;const m=i.width/l.width,p=i.height/l.height;r.scale(m,p)}else h.width=l.width,h.height=l.height;switch(c&&c!=="transparent"&&(r.fillStyle=c,r.fillRect(0,0,h.width,h.height)),r.drawImage(l,0,0),a){case"jpeg":return h.toDataURL("image/jpeg",s);case"base64":return h.toDataURL("image/png").split(",")[1];case"png":default:return h.toDataURL("image/png")}}function he(l,t){return new Promise((o,a)=>{const s=new Image;s.onload=()=>{const i=l.getContext("2d");i.clearRect(0,0,l.width,l.height),i.drawImage(s,0,0,l.width,l.height),o()},s.onerror=a,s.src=t})}function z(l){return l.paths.length===0||l.paths.every(t=>t.points.length===0)}function $(l,t){return{paths:[],canvasSize:{width:l,height:t},timestamp:Date.now(),isEmpty:!0}}function N(l){return JSON.parse(JSON.stringify(l))}class ce{constructor(t){W(this,"canvas");W(this,"ctx");W(this,"replayData",null);W(this,"state","idle");W(this,"currentTime",0);W(this,"speed",1);W(this,"animationId",null);W(this,"startTimestamp",0);W(this,"pausedTime",0);W(this,"options",{});W(this,"eventCallbacks",new Map);W(this,"offscreenCanvas",null);W(this,"offscreenCtx",null);W(this,"lastFrameImageBitmap",null);W(this,"renderThrottle",0);W(this,"isRendering",!1);W(this,"seededRandom");this.canvas=t,this.ctx=t.getContext("2d"),this.initializeOffscreenCanvas(),this.seededRandom=this.createSeededRandom()}createSeededRandom(){return t=>{const s=Math.pow(2,32);return(1664525*t+1013904223)%s/s}}initializeOffscreenCanvas(){try{if(typeof OffscreenCanvas<"u"?(this.offscreenCanvas=new OffscreenCanvas(this.canvas.width,this.canvas.height),this.offscreenCtx=this.offscreenCanvas.getContext("2d")):(this.offscreenCanvas=document.createElement("canvas"),this.offscreenCanvas.width=this.canvas.width,this.offscreenCanvas.height=this.canvas.height,this.offscreenCtx=this.offscreenCanvas.getContext("2d")),this.offscreenCtx){this.offscreenCtx.imageSmoothingEnabled=!0,this.offscreenCtx.imageSmoothingQuality="high";try{this.offscreenCtx.textRenderingOptimization="optimizeSpeed"}catch{}}}catch(t){console.warn("Failed to initialize optimized offscreen canvas:",t),this.offscreenCanvas=document.createElement("canvas"),this.offscreenCanvas.width=this.canvas.width,this.offscreenCanvas.height=this.canvas.height,this.offscreenCtx=this.offscreenCanvas.getContext("2d")}}setReplayData(t,o={}){console.log("设置回放数据:",t),console.log("回放选项:",o),this.replayData=t,this.options={...o},this.speed=o.speed||t.speed||1,this.currentTime=o.startTime||0,this.state="idle",this.resetOptimizationState(),console.log("回放数据设置完成，路径数量:",t.paths.length),console.log("总时长:",t.totalDuration)}resetOptimizationState(){this.offscreenCanvas&&(this.offscreenCanvas.width=this.canvas.width,this.offscreenCanvas.height=this.canvas.height)}play(){if(console.log("播放方法调用，回放数据:",this.replayData),console.log("当前状态:",this.state),!this.replayData){console.error("没有回放数据，无法播放");return}if(this.replayData.totalDuration<=0){console.error("回放数据总时长为0，无法播放");return}if(this.replayData.paths.length===0){console.error("回放数据没有路径，无法播放");return}if(this.state==="playing"){console.log("已在播放中，忽略");return}this.state==="paused"?(console.log("从暂停状态恢复播放"),this.state="playing",this.startTimestamp=performance.now()-this.pausedTime,this.emit("replay-resume")):(console.log("开始新的播放"),this.state="playing",this.startTimestamp=performance.now(),this.pausedTime=0,this.currentTime=this.options.startTime||0,this.clearCanvas(),this.emit("replay-start")),this.animate()}pause(){this.state==="playing"&&(this.state="paused",this.pausedTime=performance.now()-this.startTimestamp,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.emit("replay-pause"))}stop(){this.state="stopped",this.currentTime=0,this.pausedTime=0,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.clearCanvas(),this.emit("replay-stop")}seek(t){if(!this.replayData)return;const o=this.options.endTime||this.replayData.totalDuration;this.currentTime=Math.max(0,Math.min(t,o)),this.state==="playing"?this.startTimestamp=performance.now()-this.currentTime/this.speed:this.pausedTime=this.currentTime/this.speed,this.renderFrame(this.currentTime)}setSpeed(t){const o=this.state==="playing";o&&this.pause(),this.speed=Math.max(.1,Math.min(5,t)),this.emit("replay-speed-change",this.speed),o&&this.play()}getState(){return this.state}getCurrentTime(){return this.currentTime}getTotalDuration(){var t;return((t=this.replayData)==null?void 0:t.totalDuration)||0}getProgress(){const t=this.getTotalDuration();return t>0?this.currentTime/t:0}animate(){if(this.state!=="playing"||!this.replayData)return;const t=performance.now();this.currentTime=(t-this.startTimestamp)*this.speed;const o=this.options.endTime||this.replayData.totalDuration;if(this.currentTime>=o){this.currentTime=o,this.state="completed",this.renderFrame(this.currentTime),this.emit("replay-complete"),this.options.loop&&setTimeout(()=>{this.currentTime=this.options.startTime||0,this.play()},500);return}this.renderFrame(this.currentTime),this.emit("replay-progress",this.getProgress(),this.currentTime),this.animationId=requestAnimationFrame(()=>this.animate())}renderFrame(t){if(!this.replayData||!this.offscreenCanvas||!this.offscreenCtx)return;const o=performance.now();if(!(o-this.renderThrottle<16)&&(this.renderThrottle=o,!this.isRendering)){this.isRendering=!0;try{this.renderToOffscreenCanvas(t),this.transferToMainCanvasSync()}finally{this.isRendering=!1}}}transferToMainCanvasSync(){if(this.offscreenCanvas)try{this.ctx.imageSmoothingEnabled=!1,this.ctx.globalCompositeOperation="copy",this.ctx.drawImage(this.offscreenCanvas,0,0),this.ctx.globalCompositeOperation="source-over",this.ctx.imageSmoothingEnabled=!0}catch{this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.offscreenCanvas,0,0)}}renderToOffscreenCanvas(t){if(!this.replayData||!this.offscreenCtx)return;const o=this.offscreenCanvas,a=this.offscreenCtx;a.globalCompositeOperation="copy",a.fillStyle="transparent",a.fillRect(0,0,o.width,o.height),a.globalCompositeOperation="source-over";let s=!1;for(let i=0;i<this.replayData.paths.length;i++){const c=this.replayData.paths[i],h=c.startTime||0,r=c.endTime||h+(c.duration||0);if(t<h)break;if(t>=r){this.drawCompletePathToOffscreen(c),!s&&Math.abs(t-r)<32&&this.emit("replay-path-end",i,c);continue}s=!0;const m=Math.max(0,Math.min(1,(t-h)/Math.max(r-h,1)));m>0&&Math.abs(t-h)<32&&this.emit("replay-path-start",i,c),this.drawPartialPathToOffscreen(c,m);break}}getPointsUpToTime(t,o,a){const s=[];for(let i=0;i<t.length;i++){const c=t[i],h=o+(c.relativeTime||i*50);if(h<=a)s.push(c);else{if(i>0){const r=t[i-1],m=o+(r.relativeTime||(i-1)*50);if(m<=a){const p=(a-m)/(h-m),w={x:r.x+(c.x-r.x)*p,y:r.y+(c.y-r.y)*p,time:a,pressure:r.pressure?r.pressure+(c.pressure||r.pressure-r.pressure)*p:c.pressure};s.push(w)}}break}}return s}calculateDynamicStrokeWidth(t,o,a,s){switch(a){case"pen":return 1;case"brush":if(o){const g=Math.sqrt(Math.pow(t.x-o.x,2)+Math.pow(t.y-o.y,2)),b=Math.max(1,(t.time||0)-(o.time||0)),M=g/b,O=Math.max(.1,Math.min(3,100/Math.max(M,1))),V=t.pressure||.5,P=Math.floor(t.x*1e3+t.y*1e3+(t.time||0)),R=.8+this.seededRandom(P)*.4;return Math.max(1,Math.min(20,s*O*(.3+V*1.4)*R))}return s;case"marker":return 12;case"pencil":const i=t.pressure||.5,c=Math.floor(t.x*1e3+t.y*1e3+(t.time||0)),h=.9+this.seededRandom(c+1)*.2;return s*(.7+i*.6)*h;case"ballpoint":const r=t.pressure||.5;return s*(.8+r*.4);case"elegant":const m=t.pressure||.5;let p=1;if(o){const g=Math.sqrt(Math.pow(t.x-o.x,2)+Math.pow(t.y-o.y,2)),b=Math.max(1,(t.time||0)-(o.time||0)),M=g/b;p=Math.max(.3,Math.min(2,50/Math.max(M,1)))}const w=m*p;return s*(.4+w*1.6);default:return s}}drawStyledStrokeForReplay(t,o,a,s){if(!(t.length<2))switch(this.ctx.strokeStyle=a,o){case"pen":if(this.ctx.lineWidth=1,this.ctx.lineCap="butt",this.ctx.lineJoin="miter",this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y),t.length>=3){for(let i=1;i<t.length-1;i++){const c=this.getControlPoint(t[i],t[i-1],t[i+1]);this.ctx.quadraticCurveTo(c.x,c.y,t[i].x,t[i].y)}this.ctx.lineTo(t[t.length-1].x,t[t.length-1].y)}else for(let i=1;i<t.length;i++)this.ctx.lineTo(t[i].x,t[i].y);this.ctx.stroke();break;case"brush":this.ctx.lineCap="round",this.ctx.lineJoin="round";for(let i=1;i<t.length;i++){const c=t[i],h=t[i-1],r=this.calculateDynamicStrokeWidth(c,h,o,s);this.ctx.lineWidth=r,this.ctx.beginPath(),this.ctx.moveTo(h.x,h.y),this.ctx.lineTo(c.x,c.y),this.ctx.stroke();const m=Math.floor(c.x*100+c.y*100+i);r>8&&this.seededRandom(m)>.6&&(this.ctx.globalAlpha=.2,this.ctx.beginPath(),this.ctx.arc(c.x,c.y,r*.3,0,Math.PI*2),this.ctx.fill(),this.ctx.globalAlpha=1)}break;case"marker":this.ctx.globalAlpha=.7,this.ctx.lineWidth=12,this.ctx.lineCap="square",this.ctx.lineJoin="bevel",this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(let i=1;i<t.length;i++)this.ctx.lineTo(t[i].x,t[i].y);this.ctx.stroke(),this.ctx.globalAlpha=.3,this.ctx.lineWidth=16,this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(let i=1;i<t.length;i++)this.ctx.lineTo(t[i].x,t[i].y);this.ctx.stroke(),this.ctx.globalAlpha=1;break;case"pencil":this.ctx.lineCap="round",this.ctx.lineJoin="round";for(let i=1;i<t.length;i++){const c=t[i],h=t[i-1],r=this.calculateDynamicStrokeWidth(c,h,o,s);this.ctx.lineWidth=r,this.ctx.globalAlpha=.8,this.ctx.beginPath(),this.ctx.moveTo(h.x,h.y),this.ctx.lineTo(c.x,c.y),this.ctx.stroke();for(let p=0;p<3;p++){const w=Math.floor(c.x*10+c.y*10+i*10+p);if(this.seededRandom(w)>.5){this.ctx.globalAlpha=.2,this.ctx.lineWidth=r*.3;const g=(this.seededRandom(w+1)-.5)*2,b=(this.seededRandom(w+2)-.5)*2;this.ctx.beginPath(),this.ctx.moveTo(h.x+g,h.y+b),this.ctx.lineTo(c.x+g,c.y+b),this.ctx.stroke()}}const m=Math.floor(c.x*5+c.y*5+i*5);if(this.seededRandom(m)>.8){this.ctx.globalAlpha=.4;for(let p=0;p<5;p++){const w=m+p*10;this.ctx.beginPath(),this.ctx.arc(c.x+(this.seededRandom(w+1)-.5)*3,c.y+(this.seededRandom(w+2)-.5)*3,this.seededRandom(w+3)*.8,0,Math.PI*2),this.ctx.fill()}}}this.ctx.globalAlpha=1;break;case"ballpoint":this.ctx.lineCap="round",this.ctx.lineJoin="round";for(let i=1;i<t.length;i++){const c=t[i],h=t[i-1],r=this.calculateDynamicStrokeWidth(c,h,o,s),m=Math.floor(c.x*50+c.y*50+i);if(this.seededRandom(m)>.1){if(this.ctx.lineWidth=r,this.ctx.globalAlpha=this.seededRandom(m+1)>.2?1:.7,this.ctx.beginPath(),i<t.length-1){const p=t[i+1],w=this.getControlPoint(c,h,p);this.ctx.moveTo(h.x,h.y),this.ctx.quadraticCurveTo(w.x,w.y,c.x,c.y)}else this.ctx.moveTo(h.x,h.y),this.ctx.lineTo(c.x,c.y);this.ctx.stroke()}}this.ctx.globalAlpha=1;break;case"elegant":this.drawElegantStroke(t,a,s);break}}drawElegantStroke(t,o,a){if(t.length<2)return;this.ctx.strokeStyle=o,this.ctx.fillStyle=o,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.globalCompositeOperation="source-over";const s=this.preprocessPointsForVelocity(t,a);this.drawVelocityBasedPath(s),this.addVelocityBasedConnections(s)}preprocessPointsForVelocity(t,o){const a=[];for(let s=0;s<t.length;s++){const i=t[s];let c=0,h=o;if(s>0){const m=t[s-1],p=Math.sqrt(Math.pow(i.x-m.x,2)+Math.pow(i.y-m.y,2)),w=Math.max(1,(i.time||0)-(m.time||0));c=p/w;const g=i.pressure||.5,b=Math.max(.2,Math.min(3,100/Math.max(c,1)));h=o*(.3+g*b*1.4)}let r=h;if(s>0){const m=a[s-1].smoothedWidth;r=m+(h-m)*.3}a.push({...i,velocity:c,dynamicWidth:h,smoothedWidth:Math.max(.5,Math.min(o*3,r))})}return a}drawVelocityBasedPath(t){if(!(t.length<2))for(let o=1;o<t.length;o++){const a=t[o],s=t[o-1];this.drawVelocitySegment(s,a,s.smoothedWidth,a.smoothedWidth)}}drawVelocitySegment(t,o,a,s){const i=Math.sqrt(Math.pow(o.x-t.x,2)+Math.pow(o.y-t.y,2)),c=Math.max(2,Math.min(10,Math.floor(i/3)));this.ctx.beginPath();const h=[];for(let r=0;r<=c;r++){const m=r/c,p=this.smoothStep(m),w=t.x+(o.x-t.x)*p,g=t.y+(o.y-t.y)*p,b=a+(s-a)*p,M=o.x-t.x,O=o.y-t.y,V=Math.sqrt(M*M+O*O);if(V>0){const P=-O/V*b/2,R=M/V*b/2;r===0?this.ctx.moveTo(w+P,g+R):this.ctx.lineTo(w+P,g+R),h.push({x:w-P,y:g-R})}}for(let r=h.length-1;r>=0;r--)this.ctx.lineTo(h[r].x,h[r].y);this.ctx.closePath(),this.ctx.fill()}addVelocityBasedConnections(t){for(let o=1;o<t.length-1;o++){const a=t[o-1],s=t[o],i=t[o+1],c=Math.abs(s.velocity-a.velocity),h=(s.velocity+a.velocity)/2,r=Math.atan2(s.y-a.y,s.x-a.x),m=Math.atan2(i.y-s.y,i.x-s.x);let p=Math.abs(m-r);if(p>Math.PI&&(p=2*Math.PI-p),c>h*.3||p>.15){const g=s.smoothedWidth*.6,b=this.ctx.createRadialGradient(s.x,s.y,0,s.x,s.y,g);b.addColorStop(0,this.ctx.fillStyle),b.addColorStop(1,"transparent");const M=this.ctx.fillStyle;this.ctx.fillStyle=b,this.ctx.beginPath(),this.ctx.arc(s.x,s.y,g,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle=M}if(p>.05){const g=s.smoothedWidth*.2;this.ctx.beginPath(),this.ctx.arc(s.x,s.y,g,0,Math.PI*2),this.ctx.fill()}}}smoothStep(t){return t*t*(3-2*t)}getControlPoint(t,o,a){const i={length:Math.sqrt(Math.pow(a.x-o.x,2)+Math.pow(a.y-o.y,2)),angle:Math.atan2(a.y-o.y,a.x-o.x)},c=i.angle+Math.PI,h=i.length*.2;return{x:t.x+Math.cos(c)*h,y:t.y+Math.sin(c)*h,time:t.time||0}}clearCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}on(t,o){this.eventCallbacks.has(t)||this.eventCallbacks.set(t,[]),this.eventCallbacks.get(t).push(o)}off(t,o){if(this.eventCallbacks.has(t))if(o){const a=this.eventCallbacks.get(t),s=a.indexOf(o);s>-1&&a.splice(s,1)}else this.eventCallbacks.delete(t)}emit(t,...o){const a=this.eventCallbacks.get(t);a&&a.forEach(s=>s(...o))}drawCompletePathToOffscreen(t){if(!this.offscreenCtx||t.points.length<2)return;const o=this.ctx;this.ctx=this.offscreenCtx;const a=t.penStyle||this.options.penStyle||"pen";this.drawStyledStrokeForReplay(t.points,a,t.strokeColor,t.strokeWidth),this.ctx=o}drawPartialPathToOffscreen(t,o){if(!this.offscreenCtx||t.points.length<2)return;const a=t.startTime||0,s=t.duration||0,i=a+s*o,c=this.getPointsUpToTime(t.points,a,i);if(c.length<2)return;const h=this.ctx;this.ctx=this.offscreenCtx;const r=t.penStyle||this.options.penStyle||"pen";this.drawStyledStrokeForReplay(c,r,t.strokeColor,t.strokeWidth),this.ctx=h}destroy(){this.stop(),this.eventCallbacks.clear(),this.replayData=null,this.lastFrameImageBitmap&&(this.lastFrameImageBitmap.close(),this.lastFrameImageBitmap=null)}}function ue(l){const t=l.paths.map(r=>{const m=r.points.map((w,g)=>{var M;let b;if(w.time&&r.points[0].time)b=w.time-r.points[0].time;else if(g===0)b=0;else{const O=r.points[g-1],P=Math.sqrt(Math.pow(w.x-O.x,2)+Math.pow(w.y-O.y,2))/100*1e3;b=(((M=m[g-1])==null?void 0:M.relativeTime)||0)+Math.max(P,16)}return{...w,relativeTime:b}}),p=m.length>0?m[m.length-1].relativeTime:0;return{...r,points:m,duration:p}}),o=[];for(let r=0;r<t.length;r++){const m=t[r];let p;if(r===0)p=0;else{const b=o[r-1],M=ze(l.paths[r-1].points,l.paths[r].points);p=b.endTime+M}const w=p+m.duration,g={...m,startTime:p,endTime:w};console.log(`路径 ${r}: 开始时间=${p}, 结束时间=${w}, 持续时间=${m.duration}`),o.push(g)}const a=o.length>0?o[o.length-1].endTime:0;console.log("回放数据生成完成:"),console.log("- 路径数量:",o.length),console.log("- 总时长:",a),console.log("- 路径详情:",o.map(r=>({startTime:r.startTime,endTime:r.endTime,duration:r.duration,pointCount:r.points.length})));const s=o.reduce((r,m)=>r+Ye(m.points),0),i=a>0?s/(a/1e3):0,c=o.slice(1).map((r,m)=>{const p=o[m];return r.startTime-p.endTime}),h=c.length>0?c.reduce((r,m)=>r+m,0)/c.length:0;return{paths:o,totalDuration:a,speed:1,metadata:{deviceType:$e(l),averageSpeed:i,totalDistance:s,averagePauseTime:h}}}function ze(l,t){if(l.length===0||t.length===0)return 200;const o=l[l.length-1],a=t[0];if(o.time&&a.time)return Math.max(a.time-o.time,50);const s=Math.sqrt(Math.pow(a.x-o.x,2)+Math.pow(a.y-o.y,2));return Math.min(Math.max(s*2,100),1e3)}function $e(l){const t=l.paths.reduce((i,c)=>i+c.points.length,0),o=l.paths.length;if(t===0)return"touch";const a=t/o;return a>20?"touch":a<10?"mouse":l.paths.some(i=>i.points.some(c=>c.pressure!==void 0))?"pen":"touch"}function Ye(l){let t=0;for(let o=1;o<l.length;o++){const a=l[o].x-l[o-1].x,s=l[o].y-l[o-1].y;t+=Math.sqrt(a*a+s*s)}return t}const j={pen:{name:"钢笔",description:"极细线条，锐利精准，商务签名",strokeWidth:1,smoothing:!0,pressure:{enabled:!1,min:1,max:1},lineCap:"butt",lineJoin:"miter",recommendedColor:"#000080"},brush:{name:"毛笔",description:"粗细变化极大，传统书法效果",strokeWidth:8,smoothing:!0,pressure:{enabled:!0,min:1,max:16},lineCap:"round",lineJoin:"round",recommendedColor:"#2c3e50"},marker:{name:"马克笔",description:"超粗线条，荧光笔效果",strokeWidth:12,smoothing:!1,pressure:{enabled:!1,min:10,max:14},lineCap:"square",lineJoin:"bevel",recommendedColor:"#ff6b35"},pencil:{name:"铅笔",description:"粗糙纹理，素描效果",strokeWidth:3,smoothing:!1,pressure:{enabled:!0,min:2,max:5},lineCap:"round",lineJoin:"round",recommendedColor:"#666666"},ballpoint:{name:"圆珠笔",description:"细线条，轻微断续效果",strokeWidth:1.2,smoothing:!0,pressure:{enabled:!0,min:.8,max:1.8},lineCap:"round",lineJoin:"round",recommendedColor:"#1e3a8a"},elegant:{name:"优雅笔",description:"适中线条，由粗到细的渐变之美，连笔流畅",strokeWidth:3,smoothing:!0,pressure:{enabled:!0,min:.4,max:2.5},lineCap:"round",lineJoin:"round",recommendedColor:"#374151"}};function de(l){return j[l]}function Xe(){return Object.entries(j).map(([l,t])=>({key:l,config:t}))}function me(l,t){const o=de(l);return{strokeWidth:o.strokeWidth,smoothing:o.smoothing,pressure:o.pressure,lineCap:o.lineCap,lineJoin:o.lineJoin,strokeColor:t||o.recommendedColor||"#000000"}}const Le=["width","height"],Ge={key:1,class:"signature-toolbar"},He=["disabled"],Ue=["disabled"],je=["disabled"],Qe={key:2,class:"replay-controls"},Ke={class:"replay-buttons"},Ze=["disabled"],et={key:0},tt={key:1},nt=["disabled"],at={class:"replay-progress"},ot=["max","value","disabled"],st={class:"time-display"},it={class:"replay-speed"},lt=16,rt=u.defineComponent({__name:"ElectronicSignature",props:{showToolbar:{type:Boolean,default:!1},width:{default:"100%"},height:{default:300},penStyle:{default:"ballpoint"},strokeColor:{default:"#000000"},strokeWidth:{default:2},backgroundColor:{default:"transparent"},disabled:{type:Boolean,default:!1},placeholder:{default:"请在此处签名"},smoothing:{type:Boolean,default:!0},pressureSensitive:{type:Boolean,default:!1},minStrokeWidth:{default:1},maxStrokeWidth:{default:4},borderStyle:{default:"1px solid #ddd"},borderRadius:{default:"4px"},replayMode:{type:Boolean},realTimeMode:{type:Boolean,default:!0},replayData:{},replayOptions:{}},emits:["signature-start","signature-drawing","signature-end","signature-clear","signature-undo","signature-redo","replay-start","replay-progress","replay-pause","replay-resume","replay-stop","replay-complete","replay-path-start","replay-path-end","replay-speed-change"],setup(l,{expose:t,emit:o}){const a=l,s=o,i=u.ref(),c=u.ref(!1),h=u.ref(null),r=u.ref($(0,0)),m=u.ref([]),p=u.ref(-1),w=u.ref(0),g=u.ref(null),b=u.ref(!1),M=u.ref("idle"),O=u.ref(0),V=u.ref(0),P=u.computed(()=>typeof a.width=="number"?a.width:800),R=u.computed(()=>typeof a.height=="number"?a.height:300),pt=u.computed(()=>({position:"relative",display:"inline-block",width:typeof a.width=="string"?a.width:`${a.width}px`,height:typeof a.height=="string"?a.height:`${a.height}px`})),yt=u.computed(()=>({border:a.borderStyle,borderRadius:a.borderRadius,backgroundColor:a.backgroundColor,cursor:a.disabled?"not-allowed":"crosshair",display:"block",width:"100%",height:"100%"})),vt=u.computed(()=>({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"#999",fontSize:"14px",pointerEvents:"none",userSelect:"none"})),xt=u.computed(()=>b.value?!1:a.placeholder&&z(r.value)),pe=u.computed(()=>p.value>0),ye=u.computed(()=>p.value<m.value.length-1),ve=u.computed(()=>b.value&&g.value),F=u.computed(()=>!ve.value&&!a.disabled),Ct=u.computed(()=>{var e;return ve.value&&((e=a.replayOptions)==null?void 0:e.showControls)!==!1}),_=u.computed(()=>{if(a.penStyle){const e=me(a.penStyle,a.strokeColor);return{strokeColor:e.strokeColor,strokeWidth:a.strokeWidth||e.strokeWidth,smoothing:a.smoothing!==void 0?a.smoothing:e.smoothing,pressure:{enabled:a.pressureSensitive!==void 0?a.pressureSensitive:e.pressure.enabled,min:a.minStrokeWidth||e.pressure.min,max:a.maxStrokeWidth||e.pressure.max},lineCap:e.lineCap,lineJoin:e.lineJoin}}return{strokeColor:a.strokeColor||"#000000",strokeWidth:a.strokeWidth||2,smoothing:a.smoothing!==void 0?a.smoothing:!0,pressure:{enabled:a.pressureSensitive||!1,min:a.minStrokeWidth||1,max:a.maxStrokeWidth||4},lineCap:"round",lineJoin:"round"}}),Y=()=>{var e;return((e=i.value)==null?void 0:e.getContext("2d"))||null},G=(e,n)=>{const d=i.value,y=d.getBoundingClientRect(),v=d.width/y.width,f=d.height/y.height;return{x:(e-y.left)*v,y:(n-y.top)*f,time:Date.now()}},xe=e=>{if(!F.value)return;c.value=!0;const n=performance.now(),d={...e,time:n};h.value={points:[d],strokeColor:a.strokeColor,strokeWidth:a.strokeWidth,penStyle:a.penStyle,startTime:n,endTime:n,duration:0},s("signature-start")},K=(e,n,d,y)=>{switch(d){case"pen":return 1;case"brush":if(n){const k=Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2)),I=Math.max(1,(e.time||0)-(n.time||0)),E=k/I,B=Math.max(.1,Math.min(3,100/Math.max(E,1))),q=e.pressure||.5,L=.8+Math.random()*.4;return Math.max(1,Math.min(20,y*B*(.3+q*1.4)*L))}return y;case"marker":return 12;case"pencil":const v=e.pressure||.5,f=.9+Math.random()*.2;return y*(.7+v*.6)*f;case"ballpoint":const x=e.pressure||.5;return y*(.8+x*.4);case"elegant":const T=e.pressure||.5;let S=1;if(n){const k=Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2)),I=Math.max(1,(e.time||0)-(n.time||0)),E=k/I;S=Math.max(.3,Math.min(2,50/Math.max(E,1)))}const D=T*S;return y*(.4+D*1.6);default:return y}},X=(e,n,d,y=!1)=>{var v;if(!(n.length<2))switch(e.strokeStyle=((v=h.value)==null?void 0:v.strokeColor)||_.value.strokeColor,e.lineCap=_.value.lineCap||"round",e.lineJoin=_.value.lineJoin||"round",d){case"pen":if(e.lineWidth=1,e.lineCap="butt",e.lineJoin="miter",e.beginPath(),e.moveTo(n[0].x,n[0].y),n.length>=3){for(let f=1;f<n.length-1;f++){const x=Ce(n[f],n[f-1],n[f+1]);e.quadraticCurveTo(x.x,x.y,n[f].x,n[f].y)}e.lineTo(n[n.length-1].x,n[n.length-1].y)}else for(let f=1;f<n.length;f++)e.lineTo(n[f].x,n[f].y);e.stroke();break;case"brush":e.lineCap="round",e.lineJoin="round";for(let f=1;f<n.length;f++){const x=n[f],T=n[f-1],S=K(x,T,d,_.value.strokeWidth),D=e.createLinearGradient(T.x,T.y,x.x,x.y);D.addColorStop(0,e.strokeStyle),D.addColorStop(1,e.strokeStyle),e.lineWidth=S,e.beginPath(),e.moveTo(T.x,T.y),e.lineTo(x.x,x.y),e.stroke(),S>8&&Math.random()>.6&&(e.globalAlpha=.2,e.beginPath(),e.arc(x.x,x.y,S*.3,0,Math.PI*2),e.fill(),e.globalAlpha=1)}break;case"marker":e.globalAlpha=.7,e.lineWidth=12,e.lineCap="square",e.lineJoin="bevel",e.beginPath(),e.moveTo(n[0].x,n[0].y);for(let f=1;f<n.length;f++)e.lineTo(n[f].x,n[f].y);e.stroke(),e.globalAlpha=.3,e.lineWidth=16,e.beginPath(),e.moveTo(n[0].x,n[0].y);for(let f=1;f<n.length;f++)e.lineTo(n[f].x,n[f].y);e.stroke(),e.globalAlpha=1;break;case"pencil":e.lineCap="round",e.lineJoin="round";for(let f=1;f<n.length;f++){const x=n[f],T=n[f-1],S=K(x,T,d,_.value.strokeWidth);e.lineWidth=S,e.globalAlpha=.8,e.beginPath(),e.moveTo(T.x,T.y),e.lineTo(x.x,x.y),e.stroke();for(let D=0;D<3;D++)if(Math.random()>.5){e.globalAlpha=.2,e.lineWidth=S*.3;const k=(Math.random()-.5)*2,I=(Math.random()-.5)*2;e.beginPath(),e.moveTo(T.x+k,T.y+I),e.lineTo(x.x+k,x.y+I),e.stroke()}if(Math.random()>.8){e.globalAlpha=.4;for(let D=0;D<5;D++)e.beginPath(),e.arc(x.x+(Math.random()-.5)*3,x.y+(Math.random()-.5)*3,Math.random()*.8,0,Math.PI*2),e.fill()}}e.globalAlpha=1;break;case"ballpoint":e.lineCap="round",e.lineJoin="round";for(let f=1;f<n.length;f++){const x=n[f],T=n[f-1],S=K(x,T,d,_.value.strokeWidth);if(Math.random()>.1){if(e.lineWidth=S,e.globalAlpha=Math.random()>.2?1:.7,e.beginPath(),_.value.smoothing&&f<n.length-1){const D=n[f+1],k=Ce(x,T,D);e.moveTo(T.x,T.y),e.quadraticCurveTo(k.x,k.y,x.x,x.y)}else e.moveTo(T.x,T.y),e.lineTo(x.x,x.y);e.stroke()}}e.globalAlpha=1;break;case"elegant":St(e,n,y);break}},wt=()=>{if(!h.value||h.value.points.length<2)return;const e=Y();if(!e)return;const n=h.value.penStyle||a.penStyle||"pen";if(n==="brush"){bt();return}if(n==="ballpoint"){Mt();return}e.clearRect(0,0,P.value,R.value);for(const d of r.value.paths)d!==h.value&&Z(e,d);h.value.points.length>=2&&Z(e,h.value)},bt=()=>{if(!h.value||h.value.points.length<2)return;const e=Y();if(!e)return;const n=h.value.points;if(n.length>=2){const y=n.slice(-3);y.length>=2&&X(e,y,"brush",!0)}},Mt=()=>{if(!h.value||h.value.points.length<2)return;const e=Y();if(!e)return;const n=h.value.points;if(n.length>=2){const y=n.slice(-3);y.length>=2&&X(e,y,"ballpoint",!0)}},Tt=()=>{if(!h.value||h.value.points.length<2)return;const e=Y();if(!e)return;const n=h.value.points,d=n.length,y=a.penStyle||"pen";if(d===2)X(e,n,y,!0);else if(d>=3){const v=n.slice(-3);X(e,v,y,!0)}},St=(e,n,d=!1)=>{var v,f;if(n.length<2)return;e.strokeStyle=((v=h.value)==null?void 0:v.strokeColor)||_.value.strokeColor,e.fillStyle=((f=h.value)==null?void 0:f.strokeColor)||_.value.strokeColor,e.lineCap="round",e.lineJoin="round",e.globalCompositeOperation="source-over";const y=kt(n,_.value.strokeWidth);Pt(e,y),d||Wt(e,y)},kt=(e,n)=>{const d=[];for(let y=0;y<e.length;y++){const v=e[y];let f=0,x=n;if(y>0){const S=e[y-1],D=Math.sqrt(Math.pow(v.x-S.x,2)+Math.pow(v.y-S.y,2)),k=Math.max(1,(v.time||0)-(S.time||0));f=D/k;const I=v.pressure||.5,E=Math.max(.2,Math.min(3,100/Math.max(f,1)));x=n*(.3+I*E*1.4)}let T=x;if(y>0){const S=d[y-1].smoothedWidth;T=S+(x-S)*.3}d.push({...v,velocity:f,dynamicWidth:x,smoothedWidth:Math.max(.5,Math.min(n*3,T))})}return d},Pt=(e,n)=>{if(!(n.length<2))for(let d=1;d<n.length;d++){const y=n[d],v=n[d-1];Dt(e,v,y,v.smoothedWidth,y.smoothedWidth)}},Dt=(e,n,d,y,v)=>{const f=Math.sqrt(Math.pow(d.x-n.x,2)+Math.pow(d.y-n.y,2)),x=Math.max(2,Math.min(10,Math.floor(f/3)));e.beginPath();const T=[];for(let S=0;S<=x;S++){const D=S/x,k=Rt(D),I=n.x+(d.x-n.x)*k,E=n.y+(d.y-n.y)*k,B=y+(v-y)*k,q=d.x-n.x,L=d.y-n.y,te=Math.sqrt(q*q+L*L);if(te>0){const ne=-L/te*B/2,ae=q/te*B/2;S===0?e.moveTo(I+ne,E+ae):e.lineTo(I+ne,E+ae),T.push({x:I-ne,y:E-ae})}}for(let S=T.length-1;S>=0;S--)e.lineTo(T[S].x,T[S].y);e.closePath(),e.fill()},Wt=(e,n)=>{for(let d=1;d<n.length-1;d++){const y=n[d-1],v=n[d],f=n[d+1],x=Math.abs(v.velocity-y.velocity),T=(v.velocity+y.velocity)/2,S=Math.atan2(v.y-y.y,v.x-y.x),D=Math.atan2(f.y-v.y,f.x-v.x);let k=Math.abs(D-S);if(k>Math.PI&&(k=2*Math.PI-k),x>T*.3||k>.15){const E=v.smoothedWidth*.6,B=e.createRadialGradient(v.x,v.y,0,v.x,v.y,E);B.addColorStop(0,e.fillStyle),B.addColorStop(1,"transparent");const q=e.fillStyle;e.fillStyle=B,e.beginPath(),e.arc(v.x,v.y,E,0,Math.PI*2),e.fill(),e.fillStyle=q}if(k>.05){const E=v.smoothedWidth*.2;e.beginPath(),e.arc(v.x,v.y,E,0,Math.PI*2),e.fill()}}},Rt=e=>e*e*(3-2*e),Ce=(e,n,d)=>{const v={length:Math.sqrt(Math.pow(d.x-n.x,2)+Math.pow(d.y-n.y,2)),angle:Math.atan2(d.y-n.y,d.x-n.x)},f=v.angle+Math.PI,x=v.length*.2;return{x:e.x+Math.cos(f)*x,y:e.y+Math.sin(f)*x,time:e.time||0}},Z=(e,n)=>{if(n.points.length<2)return;const d=n.penStyle||a.penStyle||"pen",y=h.value;h.value=n,X(e,n.points,d),h.value=y},we=e=>{if(!c.value||!h.value||!F.value)return;const n=performance.now();if(n-w.value<lt)return;w.value=n;const d={...e,time:n};h.value.points.push(d),h.value.startTime&&(h.value.endTime=n,h.value.duration=n-h.value.startTime),a.realTimeMode?wt():Tt(),Se(),s("signature-drawing",r.value)},be=()=>{if(!(!c.value||!h.value)){if(c.value=!1,h.value.points.length>0){const e=h.value.points[h.value.points.length-1];e.time&&h.value.startTime&&(h.value.endTime=e.time,h.value.duration=e.time-h.value.startTime)}r.value.paths.push(h.value),r.value.isEmpty=!1,r.value.timestamp=Date.now(),H(),J(),h.value=null,s("signature-end",r.value)}},Et=e=>{e.preventDefault();const n=G(e.clientX,e.clientY);xe(n)},It=e=>{if(e.preventDefault(),!c.value)return;const n=G(e.clientX,e.clientY);we(n)},Me=e=>{e.preventDefault(),be()},_t=e=>{if(e.preventDefault(),e.touches.length!==1)return;const n=e.touches[0],d=G(n.clientX,n.clientY);xe(d)},Ot=e=>{if(e.preventDefault(),e.touches.length!==1||!c.value)return;const n=e.touches[0],d=G(n.clientX,n.clientY);we(d)},Te=e=>{e.preventDefault(),be()},Se=()=>{r.value.canvasSize={width:P.value,height:R.value},r.value.isEmpty=z(r.value)},H=()=>{m.value=m.value.slice(0,p.value+1),m.value.push(N(r.value)),p.value=m.value.length-1;const e=50;m.value.length>e&&(m.value=m.value.slice(-e),p.value=m.value.length-1)},J=()=>{const e=Y();e&&(e.clearRect(0,0,P.value,R.value),a.backgroundColor&&a.backgroundColor!=="transparent"&&(e.fillStyle=a.backgroundColor,e.fillRect(0,0,P.value,R.value)),r.value.paths.forEach(n=>{n.points.length>0&&Z(e,n)}))},U=()=>{if(console.log("初始化回放控制器"),console.log("canvas引用是否存在:",!!i.value),!i.value){console.error("canvas引用不存在，无法初始化回放控制器");return}g.value&&(console.log("销毁现有回放控制器"),g.value.destroy()),console.log("创建新的回放控制器"),g.value=new ce(i.value),console.log("回放控制器创建成功:",!!g.value),g.value.on("replay-start",()=>{M.value="playing",s("replay-start")}),g.value.on("replay-progress",(e,n)=>{O.value=e,V.value=n,s("replay-progress",e,n)}),g.value.on("replay-pause",()=>{M.value="paused",s("replay-pause")}),g.value.on("replay-resume",()=>{M.value="playing",s("replay-resume")}),g.value.on("replay-stop",()=>{M.value="stopped",s("replay-stop")}),g.value.on("replay-complete",()=>{M.value="completed",s("replay-complete")}),g.value.on("replay-path-start",(e,n)=>{s("replay-path-start",e,n)}),g.value.on("replay-path-end",(e,n)=>{s("replay-path-end",e,n)}),g.value.on("replay-speed-change",e=>{s("replay-speed-change",e)})},ke=(e,n)=>{if(g.value||U(),g.value){b.value=!0;const d={...n,drawOptions:_.value,penStyle:a.penStyle};g.value.setReplayData(e,d),console.log("startReplay调用，自动播放:",n==null?void 0:n.autoPlay),(n==null?void 0:n.autoPlay)===!0&&g.value.play()}},Pe=e=>{b.value=e,!e&&g.value&&(g.value.stop(),J())},Vt=()=>z(r.value)?null:ue(r.value),De=()=>{console.log("play方法被调用"),console.log("回放控制器是否存在:",!!g.value),g.value||(console.log("回放控制器不存在，尝试初始化"),U()),g.value?(console.log("调用回放控制器的play方法"),g.value.play()):console.error("回放控制器初始化失败，无法播放")},We=()=>{var e;(e=g.value)==null||e.pause()},Re=()=>{var e;(e=g.value)==null||e.stop()},Ee=e=>{var n;(n=g.value)==null||n.seek(e)},Ie=e=>{var n;(n=g.value)==null||n.setSpeed(e)},Ft=()=>{var e;return((e=g.value)==null?void 0:e.getState())||"idle"},At=()=>{var e;return((e=g.value)==null?void 0:e.getCurrentTime())||0},ee=()=>{var e;return((e=g.value)==null?void 0:e.getTotalDuration())||0},Bt=()=>{var e;return((e=g.value)==null?void 0:e.getProgress())||0},_e=e=>{const n=Math.floor(e/1e3),d=Math.floor(n/60),y=n%60;return`${d}:${y.toString().padStart(2,"0")}`},Oe=()=>{F.value&&(r.value=$(P.value,R.value),J(),H(),s("signature-clear"))},Ve=()=>{!pe.value||!F.value||(p.value--,r.value=N(m.value[p.value]),J(),s("signature-undo",r.value))},Fe=()=>{!ye.value||!F.value||(p.value++,r.value=N(m.value[p.value]),J(),s("signature-redo",r.value))},Ae=e=>{const n=i.value;return re(n,r.value,e)},Be=()=>z(r.value),Ne=async e=>{if(!F.value)return;const n=i.value;await he(n,e),r.value=$(P.value,R.value),r.value.isEmpty=!1,H()},Nt=()=>N(r.value),Jt=e=>{F.value&&(r.value=N(e),J(),H())},Je=(e,n)=>{const d=e||P.value,y=n||R.value,v=Ae({format:"png"});u.nextTick(()=>{const f=i.value;f.width=d,f.height=y,Be()||Ne(v),Se()})},qt=()=>{const e=i.value;e.width=P.value,e.height=R.value,r.value=$(P.value,R.value),m.value=[N(r.value)],p.value=0,J()};return u.watch([()=>a.width,()=>a.height],()=>{u.nextTick(()=>{i.value&&Je()})}),u.watch(()=>a.replayMode,e=>{e!==void 0&&Pe(e)}),u.watch(()=>a.replayData,e=>{if(console.log("watch监听到回放数据变化:",e),console.log("当前回放模式:",a.replayMode),console.log("回放控制器是否存在:",!!g.value),e&&a.replayMode)if(g.value||(console.log("回放控制器未初始化，先初始化"),U()),g.value){console.log("开始设置回放数据到控制器");const n={...a.replayOptions,drawOptions:_.value,penStyle:a.penStyle};g.value.setReplayData(e,n),console.log("回放数据已更新:",e)}else console.error("回放控制器初始化失败");else e||console.log("回放数据为空，跳过设置"),a.replayMode||console.log("不在回放模式，跳过设置")},{immediate:!0}),u.onMounted(()=>{u.nextTick(()=>{qt(),U(),a.replayMode&&a.replayData&&ke(a.replayData,a.replayOptions)})}),u.onUnmounted(()=>{g.value&&(g.value.destroy(),g.value=null)}),t({clear:Oe,undo:Ve,redo:Fe,save:Ae,isEmpty:Be,fromDataURL:Ne,getSignatureData:Nt,setSignatureData:Jt,resize:Je,startReplay:ke,getReplayData:Vt,setReplayMode:Pe,play:De,pause:We,stop:Re,seek:Ee,setSpeed:Ie,getState:Ft,getCurrentTime:At,getTotalDuration:ee,getProgress:Bt}),(e,n)=>(u.openBlock(),u.createElementBlock("div",{class:"electronic-signature",style:u.normalizeStyle(pt.value)},[u.createElementVNode("canvas",{ref_key:"canvasRef",ref:i,width:P.value,height:R.value,style:u.normalizeStyle(yt.value),onMousedown:Et,onMousemove:It,onMouseup:Me,onMouseleave:Me,onTouchstart:_t,onTouchmove:Ot,onTouchend:Te,onTouchcancel:Te},null,44,Le),xt.value?(u.openBlock(),u.createElementBlock("div",{key:0,class:"signature-placeholder",style:u.normalizeStyle(vt.value)},u.toDisplayString(e.placeholder),5)):u.createCommentVNode("",!0),e.showToolbar?(u.openBlock(),u.createElementBlock("div",Ge,[u.createElementVNode("button",{onClick:Oe,disabled:!F.value},"清除",8,He),u.createElementVNode("button",{onClick:Ve,disabled:!F.value||!pe.value},"撤销",8,Ue),u.createElementVNode("button",{onClick:Fe,disabled:!F.value||!ye.value},"重做",8,je)])):u.createCommentVNode("",!0),Ct.value?(u.openBlock(),u.createElementBlock("div",Qe,[u.createElementVNode("div",Ke,[u.createElementVNode("button",{onClick:n[0]||(n[0]=d=>M.value==="playing"?We():De()),disabled:M.value==="idle",class:"replay-btn play-pause-btn"},[M.value==="playing"?(u.openBlock(),u.createElementBlock("span",et,"⏸️")):(u.openBlock(),u.createElementBlock("span",tt,"▶️"))],8,Ze),u.createElementVNode("button",{onClick:n[1]||(n[1]=d=>Re()),disabled:M.value==="idle",class:"replay-btn stop-btn"}," ⏹️ ",8,nt)]),u.createElementVNode("div",at,[u.createElementVNode("input",{type:"range",min:"0",max:ee(),value:V.value,onInput:n[2]||(n[2]=d=>Ee(Number(d.target.value))),class:"progress-slider",disabled:M.value==="idle"},null,40,ot),u.createElementVNode("div",st,[u.createElementVNode("span",null,u.toDisplayString(_e(V.value)),1),n[4]||(n[4]=u.createElementVNode("span",null,"/",-1)),u.createElementVNode("span",null,u.toDisplayString(_e(ee())),1)])]),u.createElementVNode("div",it,[n[6]||(n[6]=u.createElementVNode("label",null,"速度:",-1)),u.createElementVNode("select",{onChange:n[3]||(n[3]=d=>Ie(Number(d.target.value))),class:"speed-select"},n[5]||(n[5]=[u.createElementVNode("option",{value:"0.5"},"0.5x",-1),u.createElementVNode("option",{value:"1",selected:""},"1x",-1),u.createElementVNode("option",{value:"1.5"},"1.5x",-1),u.createElementVNode("option",{value:"2"},"2x",-1)]),32)])])):u.createCommentVNode("",!0)],4))}}),Yt="",Q=((l,t)=>{const o=l.__vccOpts||l;for(const[a,s]of t)o[a]=s;return o})(rt,[["__scopeId","data-v-f381ec60"]]);function ge(){return window.devicePixelRatio||1}function ht(l){const t=l.getContext("2d"),o=ge(),a=l.clientWidth,s=l.clientHeight;return l.width=a*o,l.height=s*o,t.scale(o,o),l.style.width=a+"px",l.style.height=s+"px",t}function fe(l){if(l.paths.length===0)return{minX:0,minY:0,maxX:0,maxY:0,width:0,height:0};let t=1/0,o=1/0,a=-1/0,s=-1/0;return l.paths.forEach(i=>{i.points.forEach(c=>{t=Math.min(t,c.x),o=Math.min(o,c.y),a=Math.max(a,c.x),s=Math.max(s,c.y)})}),{minX:t,minY:o,maxX:a,maxY:s,width:a-t,height:s-o}}function ct(l,t,o=10){const a=fe(t);if(a.width===0||a.height===0){const r=document.createElement("canvas");return r.width=1,r.height=1,r}const s=document.createElement("canvas"),i=s.getContext("2d"),c=a.width+o*2,h=a.height+o*2;return s.width=c,s.height=h,i.drawImage(l,a.minX-o,a.minY-o,c,h,0,0,c,h),s}function ut(l,t,o,a=!0){const s=document.createElement("canvas"),i=s.getContext("2d");let c=t,h=o;if(a){const r=l.width/l.height,m=t/o;r>m?h=t/r:c=o*r}return s.width=c,s.height=h,i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(l,0,0,c,h),s}function dt(l,t,o={}){const{fontSize:a=12,fontFamily:s="Arial",color:i="#999",opacity:c=.5,position:h="bottom-right"}=o,r=document.createElement("canvas"),m=r.getContext("2d");r.width=l.width,r.height=l.height,m.drawImage(l,0,0),m.font=`${a}px ${s}`,m.fillStyle=i,m.globalAlpha=c;const w=m.measureText(t).width,g=a;let b,M;switch(h){case"top-left":b=10,M=g+10;break;case"top-right":b=l.width-w-10,M=g+10;break;case"bottom-left":b=10,M=l.height-10;break;case"bottom-right":b=l.width-w-10,M=l.height-10;break;case"center":b=(l.width-w)/2,M=(l.height+g)/2;break;default:b=l.width-w-10,M=l.height-10}return m.fillText(t,b,M),m.globalAlpha=1,r}function mt(l){const t=document.createElement("canvas"),o=t.getContext("2d");t.width=l.width,t.height=l.height,o.drawImage(l,0,0);const a=o.getImageData(0,0,l.width,l.height),s=a.data;for(let i=0;i<s.length;i+=4){const c=s[i]*.299+s[i+1]*.587+s[i+2]*.114;s[i]=c,s[i+1]=c,s[i+2]=c}return o.putImageData(a,0,0),t}const gt={install:l=>{l.component("ElectronicSignature",Q)},ElectronicSignature:Q},ft="1.0.0";C.ElectronicSignature=Q,C.PEN_STYLE_CONFIGS=j,C.SignatureReplayController=ce,C.addWatermark=dt,C.calculateStrokeWidth=ie,C.cloneSignatureData=N,C.convertToGrayscale=mt,C.createDrawOptionsFromPenStyle=me,C.createEmptySignatureData=$,C.createReplayData=ue,C.cropSignature=ct,C.default=gt,C.drawSmoothPath=qe,C.exportSignature=re,C.getAllPenStyles=Xe,C.getAngle=oe,C.getControlPoint=se,C.getDevicePixelRatio=ge,C.getDistance=A,C.getPenStyleConfig=de,C.getSignatureBounds=fe,C.isSignatureEmpty=z,C.loadImageToCanvas=he,C.resizeSignature=ut,C.setupHighDPICanvas=ht,C.signatureToSVG=le,C.version=ft,Object.defineProperties(C,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});

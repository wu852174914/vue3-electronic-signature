(function(m,i){typeof exports=="object"&&typeof module<"u"?i(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],i):(m=typeof globalThis<"u"?globalThis:m||self,i(m.Vue3ElectronicSignature={},m.Vue))})(this,function(m,i){"use strict";var ct=Object.defineProperty;var ht=(m,i,b)=>i in m?ct(m,i,{enumerable:!0,configurable:!0,writable:!0,value:b}):m[i]=b;var T=(m,i,b)=>(ht(m,typeof i!="symbol"?i+"":i,b),b);function b(o,e){return Math.sqrt(Math.pow(e.x-o.x,2)+Math.pow(e.y-o.y,2))}function z(o,e){return Math.atan2(e.y-o.y,e.x-o.x)}function A(o,e,n,t){const a=e||o,r=n||o,h=.2,u=z(a,r)*(t?1:-1),l=b(a,r)*h;return{x:o.x+Math.cos(u)*l,y:o.y+Math.sin(u)*l,time:o.time}}function X(o,e,n){if(!n.pressure.enabled)return n.strokeWidth;const t=b(o,e),a=e.time-o.time,r=a>0?t/a:0,h=Math.max(.1,Math.min(1,1-r*.01)),{min:u,max:l}=n.pressure;return u+(l-u)*h}function Y(o,e,n){if(e.length<2)return;if(o.strokeStyle=n.strokeColor,o.lineCap="round",o.lineJoin="round",!n.smoothing||e.length<3){o.beginPath(),o.lineWidth=n.strokeWidth,o.moveTo(e[0].x,e[0].y);for(let a=1;a<e.length;a++)o.lineTo(e[a].x,e[a].y);o.stroke();return}o.beginPath(),o.moveTo(e[0].x,e[0].y);for(let a=1;a<e.length-1;a++){const r=e[a],h=e[a+1];n.pressure.enabled?o.lineWidth=X(e[a-1],r,n):o.lineWidth=n.strokeWidth;const u=A(r,e[a-1],h);o.quadraticCurveTo(u.x,u.y,r.x,r.y)}const t=e[e.length-1];o.lineTo(t.x,t.y),o.stroke()}function q(o){const{canvasSize:e,paths:n}=o;let t=`<svg width="${e.width}" height="${e.height}" xmlns="http://www.w3.org/2000/svg">`;return n.forEach(a=>{if(a.points.length<2)return;let r=`M ${a.points[0].x} ${a.points[0].y}`;for(let h=1;h<a.points.length;h++)r+=` L ${a.points[h].x} ${a.points[h].y}`;t+=`<path d="${r}" stroke="${a.strokeColor}" stroke-width="${a.strokeWidth}" fill="none" stroke-linecap="round" stroke-linejoin="round"/>`}),t+="</svg>",t}function F(o,e,n={format:"png"}){const{format:t,quality:a=.9,size:r,backgroundColor:h}=n;if(t==="svg")return q(e);const u=document.createElement("canvas"),l=u.getContext("2d");if(r){u.width=r.width,u.height=r.height;const p=r.width/o.width,g=r.height/o.height;l.scale(p,g)}else u.width=o.width,u.height=o.height;switch(h&&h!=="transparent"&&(l.fillStyle=h,l.fillRect(0,0,u.width,u.height)),l.drawImage(o,0,0),t){case"jpeg":return u.toDataURL("image/jpeg",a);case"base64":return u.toDataURL("image/png").split(",")[1];case"png":default:return u.toDataURL("image/png")}}function H(o,e){return new Promise((n,t)=>{const a=new Image;a.onload=()=>{const r=o.getContext("2d");r.clearRect(0,0,o.width,o.height),r.drawImage(a,0,0,o.width,o.height),n()},a.onerror=t,a.src=e})}function E(o){return o.paths.length===0||o.paths.every(e=>e.points.length===0)}function W(o,e){return{paths:[],canvasSize:{width:o,height:e},timestamp:Date.now(),isEmpty:!0}}function D(o){return JSON.parse(JSON.stringify(o))}class U{constructor(e){T(this,"canvas");T(this,"ctx");T(this,"replayData",null);T(this,"state","idle");T(this,"currentTime",0);T(this,"speed",1);T(this,"animationId",null);T(this,"startTimestamp",0);T(this,"pausedTime",0);T(this,"options",{});T(this,"eventCallbacks",new Map);this.canvas=e,this.ctx=e.getContext("2d")}setReplayData(e,n={}){console.log("设置回放数据:",e),console.log("回放选项:",n),this.replayData=e,this.options={...n},this.speed=n.speed||e.speed||1,this.currentTime=n.startTime||0,this.state="idle",console.log("回放数据设置完成，路径数量:",e.paths.length),console.log("总时长:",e.totalDuration)}play(){if(console.log("播放方法调用，回放数据:",this.replayData),console.log("当前状态:",this.state),!this.replayData){console.error("没有回放数据，无法播放");return}if(this.replayData.totalDuration<=0){console.error("回放数据总时长为0，无法播放");return}if(this.replayData.paths.length===0){console.error("回放数据没有路径，无法播放");return}if(this.state==="playing"){console.log("已在播放中，忽略");return}this.state==="paused"?(console.log("从暂停状态恢复播放"),this.state="playing",this.startTimestamp=performance.now()-this.pausedTime,this.emit("replay-resume")):(console.log("开始新的播放"),this.state="playing",this.startTimestamp=performance.now(),this.pausedTime=0,this.currentTime=this.options.startTime||0,this.clearCanvas(),this.emit("replay-start")),this.animate()}pause(){this.state==="playing"&&(this.state="paused",this.pausedTime=performance.now()-this.startTimestamp,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.emit("replay-pause"))}stop(){this.state="stopped",this.currentTime=0,this.pausedTime=0,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.clearCanvas(),this.emit("replay-stop")}seek(e){if(!this.replayData)return;const n=this.options.endTime||this.replayData.totalDuration;this.currentTime=Math.max(0,Math.min(e,n)),this.state==="playing"?this.startTimestamp=performance.now()-this.currentTime/this.speed:this.pausedTime=this.currentTime/this.speed,this.renderFrame(this.currentTime)}setSpeed(e){const n=this.state==="playing";n&&this.pause(),this.speed=Math.max(.1,Math.min(5,e)),this.emit("replay-speed-change",this.speed),n&&this.play()}getState(){return this.state}getCurrentTime(){return this.currentTime}getTotalDuration(){var e;return((e=this.replayData)==null?void 0:e.totalDuration)||0}getProgress(){const e=this.getTotalDuration();return e>0?this.currentTime/e:0}animate(){if(this.state!=="playing"||!this.replayData)return;const e=performance.now();this.currentTime=(e-this.startTimestamp)*this.speed;const n=this.options.endTime||this.replayData.totalDuration;if(this.currentTime>=n){this.currentTime=n,this.state="completed",this.renderFrame(this.currentTime),this.emit("replay-complete"),this.options.loop&&setTimeout(()=>{this.currentTime=this.options.startTime||0,this.play()},500);return}this.renderFrame(this.currentTime),this.emit("replay-progress",this.getProgress(),this.currentTime),this.animationId=requestAnimationFrame(()=>this.animate())}renderFrame(e){if(!this.replayData)return;this.clearCanvas();let n=!1;for(let t=0;t<this.replayData.paths.length;t++){const a=this.replayData.paths[t],r=a.startTime||0,h=a.endTime||r+(a.duration||0);if(e<r)break;if(e>=h){this.drawCompletePath(a),!n&&Math.abs(e-h)<32&&this.emit("replay-path-end",t,a);continue}n=!0;const u=Math.max(0,Math.min(1,(e-r)/Math.max(h-r,1)));u>0&&Math.abs(e-r)<32&&this.emit("replay-path-start",t,a),this.drawPartialPath(a,u);break}}drawCompletePath(e){if(e.points.length<2)return;const n=this.options.drawOptions||{strokeColor:e.strokeColor,strokeWidth:e.strokeWidth,smoothing:!0,pressure:{enabled:!1,min:1,max:4}};this.drawPathWithSmoothAlgorithm(e.points,{...n,strokeColor:e.strokeColor,strokeWidth:e.strokeWidth})}drawPartialPath(e,n){if(e.points.length<2)return;const t=e.startTime||0,a=e.duration||0,r=t+a*n,h=this.getPointsUpToTime(e.points,t,r);if(h.length<2)return;const u=this.options.drawOptions||{strokeColor:e.strokeColor,strokeWidth:e.strokeWidth,smoothing:!0,pressure:{enabled:!1,min:1,max:4}};this.drawPathWithSmoothAlgorithm(h,{...u,strokeColor:e.strokeColor,strokeWidth:e.strokeWidth})}getPointsUpToTime(e,n,t){const a=[];for(let r=0;r<e.length;r++){const h=e[r],u=n+(h.relativeTime||r*50);if(u<=t)a.push(h);else{if(r>0){const l=e[r-1],p=n+(l.relativeTime||(r-1)*50);if(p<=t){const g=(t-p)/(u-p),d={x:l.x+(h.x-l.x)*g,y:l.y+(h.y-l.y)*g,time:t,pressure:l.pressure?l.pressure+(h.pressure||l.pressure-l.pressure)*g:h.pressure};a.push(d)}}break}}return a}drawPathWithSmoothAlgorithm(e,n){if(e.length<2)return;if(this.ctx.strokeStyle=n.strokeColor,this.ctx.lineCap="round",this.ctx.lineJoin="round",!n.smoothing||e.length<3){this.ctx.beginPath(),this.ctx.lineWidth=n.strokeWidth,this.ctx.moveTo(e[0].x,e[0].y);for(let a=1;a<e.length;a++)this.ctx.lineTo(e[a].x,e[a].y);this.ctx.stroke();return}this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y);for(let a=1;a<e.length-1;a++){const r=e[a],h=e[a+1];this.ctx.lineWidth=n.strokeWidth;const u=this.getControlPoint(r,e[a-1],h);this.ctx.quadraticCurveTo(u.x,u.y,r.x,r.y)}const t=e[e.length-1];this.ctx.lineTo(t.x,t.y),this.ctx.stroke()}getControlPoint(e,n,t){const r={length:Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2)),angle:Math.atan2(t.y-n.y,t.x-n.x)},h=r.angle+Math.PI,u=r.length*.2;return{x:e.x+Math.cos(h)*u,y:e.y+Math.sin(h)*u,time:e.time||0}}clearCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}on(e,n){this.eventCallbacks.has(e)||this.eventCallbacks.set(e,[]),this.eventCallbacks.get(e).push(n)}off(e,n){if(this.eventCallbacks.has(e))if(n){const t=this.eventCallbacks.get(e),a=t.indexOf(n);a>-1&&t.splice(a,1)}else this.eventCallbacks.delete(e)}emit(e,...n){const t=this.eventCallbacks.get(e);t&&t.forEach(a=>a(...n))}destroy(){this.stop(),this.eventCallbacks.clear(),this.replayData=null}}function L(o){const e=o.paths.map(l=>{const p=l.points.map((d,v)=>{var w;let f;if(d.time&&l.points[0].time)f=d.time-l.points[0].time;else if(v===0)f=0;else{const M=l.points[v-1],k=Math.sqrt(Math.pow(d.x-M.x,2)+Math.pow(d.y-M.y,2))/100*1e3;f=(((w=p[v-1])==null?void 0:w.relativeTime)||0)+Math.max(k,16)}return{...d,relativeTime:f}}),g=p.length>0?p[p.length-1].relativeTime:0;return{...l,points:p,duration:g}}),n=[];for(let l=0;l<e.length;l++){const p=e[l];let g;if(l===0)g=0;else{const f=n[l-1],w=Te(o.paths[l-1].points,o.paths[l].points);g=f.endTime+w}const d=g+p.duration,v={...p,startTime:g,endTime:d};console.log(`路径 ${l}: 开始时间=${g}, 结束时间=${d}, 持续时间=${p.duration}`),n.push(v)}const t=n.length>0?n[n.length-1].endTime:0;console.log("回放数据生成完成:"),console.log("- 路径数量:",n.length),console.log("- 总时长:",t),console.log("- 路径详情:",n.map(l=>({startTime:l.startTime,endTime:l.endTime,duration:l.duration,pointCount:l.points.length})));const a=n.reduce((l,p)=>l+xe(p.points),0),r=t>0?a/(t/1e3):0,h=n.slice(1).map((l,p)=>{const g=n[p];return l.startTime-g.endTime}),u=h.length>0?h.reduce((l,p)=>l+p,0)/h.length:0;return{paths:n,totalDuration:t,speed:1,metadata:{deviceType:ke(o),averageSpeed:r,totalDistance:a,averagePauseTime:u}}}function Te(o,e){if(o.length===0||e.length===0)return 200;const n=o[o.length-1],t=e[0];if(n.time&&t.time)return Math.max(t.time-n.time,50);const a=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2));return Math.min(Math.max(a*2,100),1e3)}function ke(o){const e=o.paths.reduce((r,h)=>r+h.points.length,0),n=o.paths.length;if(e===0)return"touch";const t=e/n;return t>20?"touch":t<10?"mouse":o.paths.some(r=>r.points.some(h=>h.pressure!==void 0))?"pen":"touch"}function xe(o){let e=0;for(let n=1;n<o.length;n++){const t=o[n].x-o[n-1].x,a=o[n].y-o[n-1].y;e+=Math.sqrt(t*t+a*a)}return e}const Ce=["width","height"],be={key:1,class:"signature-toolbar"},Se=["disabled"],De=["disabled"],Pe=["disabled"],Me={key:2,class:"replay-controls"},Ee={class:"replay-buttons"},We=["disabled"],_e={key:0},Re={key:1},Ie=["disabled"],Ne={class:"replay-progress"},Ve=["max","value","disabled"],Oe={class:"time-display"},$e={class:"replay-speed"},Be=i.defineComponent({__name:"ElectronicSignature",props:{showToolbar:{type:Boolean,default:!1},width:{default:"100%"},height:{default:300},strokeColor:{default:"#000000"},strokeWidth:{default:2},backgroundColor:{default:"transparent"},disabled:{type:Boolean,default:!1},placeholder:{default:"请在此处签名"},smoothing:{type:Boolean,default:!0},pressureSensitive:{type:Boolean,default:!1},minStrokeWidth:{default:1},maxStrokeWidth:{default:4},borderStyle:{default:"1px solid #ddd"},borderRadius:{default:"4px"},replayMode:{type:Boolean},replayData:{},replayOptions:{}},emits:["signature-start","signature-drawing","signature-end","signature-clear","signature-undo","signature-redo","replay-start","replay-progress","replay-pause","replay-resume","replay-stop","replay-complete","replay-path-start","replay-path-end","replay-speed-change"],setup(o,{expose:e,emit:n}){const t=o,a=n,r=i.ref(),h=i.ref(!1),u=i.ref(null),l=i.ref(W(0,0)),p=i.ref([]),g=i.ref(-1),d=i.ref(null),v=i.ref(!1),f=i.ref("idle"),w=i.ref(0),M=i.ref(0),x=i.computed(()=>typeof t.width=="number"?t.width:800),k=i.computed(()=>typeof t.height=="number"?t.height:300),Ue=i.computed(()=>({position:"relative",display:"inline-block",width:typeof t.width=="string"?t.width:`${t.width}px`,height:typeof t.height=="string"?t.height:`${t.height}px`})),Le=i.computed(()=>({border:t.borderStyle,borderRadius:t.borderRadius,backgroundColor:t.backgroundColor,cursor:t.disabled?"not-allowed":"crosshair",display:"block",width:"100%",height:"100%"})),je=i.computed(()=>({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"#999",fontSize:"14px",pointerEvents:"none",userSelect:"none"})),Ge=i.computed(()=>v.value?!1:t.placeholder&&E(l.value)),J=i.computed(()=>g.value>0),Q=i.computed(()=>g.value<p.value.length-1),K=i.computed(()=>v.value&&d.value),C=i.computed(()=>!K.value&&!t.disabled),Je=i.computed(()=>{var s;return K.value&&((s=t.replayOptions)==null?void 0:s.showControls)!==!1}),O=i.computed(()=>({strokeColor:t.strokeColor,strokeWidth:t.strokeWidth,smoothing:t.smoothing,pressure:{enabled:t.pressureSensitive,min:t.minStrokeWidth,max:t.maxStrokeWidth}})),Qe=()=>{var s;return((s=r.value)==null?void 0:s.getContext("2d"))||null},_=(s,c)=>{const y=r.value,S=y.getBoundingClientRect(),B=y.width/S.width,N=y.height/S.height;return{x:(s-S.left)*B,y:(c-S.top)*N,time:Date.now()}},Z=s=>{if(!C.value)return;h.value=!0;const c=performance.now(),y={...s,time:c};u.value={points:[y],strokeColor:t.strokeColor,strokeWidth:t.strokeWidth,startTime:c,endTime:c,duration:0},a("signature-start")},ee=s=>{if(!h.value||!u.value||!C.value)return;const c=performance.now(),y={...s,time:c};u.value.points.push(y),u.value.startTime&&(u.value.endTime=c,u.value.duration=c-u.value.startTime),P(),oe(),a("signature-drawing",l.value)},te=()=>{if(!(!h.value||!u.value)){if(h.value=!1,u.value.points.length>0){const s=u.value.points[u.value.points.length-1];s.time&&u.value.startTime&&(u.value.endTime=s.time,u.value.duration=s.time-u.value.startTime)}l.value.paths.push(u.value),l.value.isEmpty=!1,l.value.timestamp=Date.now(),R(),u.value=null,a("signature-end",l.value)}},Ke=s=>{s.preventDefault();const c=_(s.clientX,s.clientY);Z(c)},Ze=s=>{if(s.preventDefault(),!h.value)return;const c=_(s.clientX,s.clientY);ee(c)},ae=s=>{s.preventDefault(),te()},et=s=>{if(s.preventDefault(),s.touches.length!==1)return;const c=s.touches[0],y=_(c.clientX,c.clientY);Z(y)},tt=s=>{if(s.preventDefault(),s.touches.length!==1||!h.value)return;const c=s.touches[0],y=_(c.clientX,c.clientY);ee(y)},ne=s=>{s.preventDefault(),te()},oe=()=>{l.value.canvasSize={width:x.value,height:k.value},l.value.isEmpty=E(l.value)},R=()=>{p.value=p.value.slice(0,g.value+1),p.value.push(D(l.value)),g.value=p.value.length-1;const s=50;p.value.length>s&&(p.value=p.value.slice(-s),g.value=p.value.length-1)},P=()=>{const s=Qe();s&&(s.clearRect(0,0,x.value,k.value),t.backgroundColor&&t.backgroundColor!=="transparent"&&(s.fillStyle=t.backgroundColor,s.fillRect(0,0,x.value,k.value)),l.value.paths.forEach(c=>{if(c.points.length>0){const y={strokeColor:c.strokeColor,strokeWidth:c.strokeWidth,smoothing:t.smoothing,pressure:O.value.pressure};Y(s,c.points,y)}}))},I=()=>{if(console.log("初始化回放控制器"),console.log("canvas引用是否存在:",!!r.value),!r.value){console.error("canvas引用不存在，无法初始化回放控制器");return}d.value&&(console.log("销毁现有回放控制器"),d.value.destroy()),console.log("创建新的回放控制器"),d.value=new U(r.value),console.log("回放控制器创建成功:",!!d.value),d.value.on("replay-start",()=>{f.value="playing",a("replay-start")}),d.value.on("replay-progress",(s,c)=>{w.value=s,M.value=c,a("replay-progress",s,c)}),d.value.on("replay-pause",()=>{f.value="paused",a("replay-pause")}),d.value.on("replay-resume",()=>{f.value="playing",a("replay-resume")}),d.value.on("replay-stop",()=>{f.value="stopped",a("replay-stop")}),d.value.on("replay-complete",()=>{f.value="completed",a("replay-complete")}),d.value.on("replay-path-start",(s,c)=>{a("replay-path-start",s,c)}),d.value.on("replay-path-end",(s,c)=>{a("replay-path-end",s,c)}),d.value.on("replay-speed-change",s=>{a("replay-speed-change",s)})},se=(s,c)=>{if(d.value||I(),d.value){v.value=!0;const y={...c,drawOptions:O.value};d.value.setReplayData(s,y),console.log("startReplay调用，自动播放:",c==null?void 0:c.autoPlay),(c==null?void 0:c.autoPlay)===!0&&d.value.play()}},ie=s=>{v.value=s,!s&&d.value&&(d.value.stop(),P())},at=()=>E(l.value)?null:L(l.value),le=()=>{console.log("play方法被调用"),console.log("回放控制器是否存在:",!!d.value),d.value||(console.log("回放控制器不存在，尝试初始化"),I()),d.value?(console.log("调用回放控制器的play方法"),d.value.play()):console.error("回放控制器初始化失败，无法播放")},re=()=>{var s;(s=d.value)==null||s.pause()},ce=()=>{var s;(s=d.value)==null||s.stop()},he=s=>{var c;(c=d.value)==null||c.seek(s)},ue=s=>{var c;(c=d.value)==null||c.setSpeed(s)},nt=()=>{var s;return((s=d.value)==null?void 0:s.getState())||"idle"},ot=()=>{var s;return((s=d.value)==null?void 0:s.getCurrentTime())||0},$=()=>{var s;return((s=d.value)==null?void 0:s.getTotalDuration())||0},st=()=>{var s;return((s=d.value)==null?void 0:s.getProgress())||0},de=s=>{const c=Math.floor(s/1e3),y=Math.floor(c/60),S=c%60;return`${y}:${S.toString().padStart(2,"0")}`},pe=()=>{C.value&&(l.value=W(x.value,k.value),P(),R(),a("signature-clear"))},me=()=>{!J.value||!C.value||(g.value--,l.value=D(p.value[g.value]),P(),a("signature-undo",l.value))},ge=()=>{!Q.value||!C.value||(g.value++,l.value=D(p.value[g.value]),P(),a("signature-redo",l.value))},fe=s=>{const c=r.value;return F(c,l.value,s)},ye=()=>E(l.value),ve=async s=>{if(!C.value)return;const c=r.value;await H(c,s),l.value=W(x.value,k.value),l.value.isEmpty=!1,R()},it=()=>D(l.value),lt=s=>{C.value&&(l.value=D(s),P(),R())},we=(s,c)=>{const y=s||x.value,S=c||k.value,B=fe({format:"png"});i.nextTick(()=>{const N=r.value;N.width=y,N.height=S,ye()||ve(B),oe()})},rt=()=>{const s=r.value;s.width=x.value,s.height=k.value,l.value=W(x.value,k.value),p.value=[D(l.value)],g.value=0,P()};return i.watch([()=>t.width,()=>t.height],()=>{i.nextTick(()=>{r.value&&we()})}),i.watch(()=>t.replayMode,s=>{s!==void 0&&ie(s)}),i.watch(()=>t.replayData,s=>{if(console.log("watch监听到回放数据变化:",s),console.log("当前回放模式:",t.replayMode),console.log("回放控制器是否存在:",!!d.value),s&&t.replayMode)if(d.value||(console.log("回放控制器未初始化，先初始化"),I()),d.value){console.log("开始设置回放数据到控制器");const c={...t.replayOptions,drawOptions:O.value};d.value.setReplayData(s,c),console.log("回放数据已更新:",s)}else console.error("回放控制器初始化失败");else s||console.log("回放数据为空，跳过设置"),t.replayMode||console.log("不在回放模式，跳过设置")},{immediate:!0}),i.onMounted(()=>{i.nextTick(()=>{rt(),I(),t.replayMode&&t.replayData&&se(t.replayData,t.replayOptions)})}),i.onUnmounted(()=>{d.value&&(d.value.destroy(),d.value=null)}),e({clear:pe,undo:me,redo:ge,save:fe,isEmpty:ye,fromDataURL:ve,getSignatureData:it,setSignatureData:lt,resize:we,startReplay:se,getReplayData:at,setReplayMode:ie,play:le,pause:re,stop:ce,seek:he,setSpeed:ue,getState:nt,getCurrentTime:ot,getTotalDuration:$,getProgress:st}),(s,c)=>(i.openBlock(),i.createElementBlock("div",{class:"electronic-signature",style:i.normalizeStyle(Ue.value)},[i.createElementVNode("canvas",{ref_key:"canvasRef",ref:r,width:x.value,height:k.value,style:i.normalizeStyle(Le.value),onMousedown:Ke,onMousemove:Ze,onMouseup:ae,onMouseleave:ae,onTouchstart:et,onTouchmove:tt,onTouchend:ne,onTouchcancel:ne},null,44,Ce),Ge.value?(i.openBlock(),i.createElementBlock("div",{key:0,class:"signature-placeholder",style:i.normalizeStyle(je.value)},i.toDisplayString(s.placeholder),5)):i.createCommentVNode("",!0),s.showToolbar?(i.openBlock(),i.createElementBlock("div",be,[i.createElementVNode("button",{onClick:pe,disabled:!C.value},"清除",8,Se),i.createElementVNode("button",{onClick:me,disabled:!C.value||!J.value},"撤销",8,De),i.createElementVNode("button",{onClick:ge,disabled:!C.value||!Q.value},"重做",8,Pe)])):i.createCommentVNode("",!0),Je.value?(i.openBlock(),i.createElementBlock("div",Me,[i.createElementVNode("div",Ee,[i.createElementVNode("button",{onClick:c[0]||(c[0]=y=>f.value==="playing"?re():le()),disabled:f.value==="idle",class:"replay-btn play-pause-btn"},[f.value==="playing"?(i.openBlock(),i.createElementBlock("span",_e,"⏸️")):(i.openBlock(),i.createElementBlock("span",Re,"▶️"))],8,We),i.createElementVNode("button",{onClick:c[1]||(c[1]=y=>ce()),disabled:f.value==="idle",class:"replay-btn stop-btn"}," ⏹️ ",8,Ie)]),i.createElementVNode("div",Ne,[i.createElementVNode("input",{type:"range",min:"0",max:$(),value:M.value,onInput:c[2]||(c[2]=y=>he(Number(y.target.value))),class:"progress-slider",disabled:f.value==="idle"},null,40,Ve),i.createElementVNode("div",Oe,[i.createElementVNode("span",null,i.toDisplayString(de(M.value)),1),c[4]||(c[4]=i.createElementVNode("span",null,"/",-1)),i.createElementVNode("span",null,i.toDisplayString(de($())),1)])]),i.createElementVNode("div",$e,[c[6]||(c[6]=i.createElementVNode("label",null,"速度:",-1)),i.createElementVNode("select",{onChange:c[3]||(c[3]=y=>ue(Number(y.target.value))),class:"speed-select"},c[5]||(c[5]=[i.createElementVNode("option",{value:"0.5"},"0.5x",-1),i.createElementVNode("option",{value:"1",selected:""},"1x",-1),i.createElementVNode("option",{value:"1.5"},"1.5x",-1),i.createElementVNode("option",{value:"2"},"2x",-1)]),32)])])):i.createCommentVNode("",!0)],4))}}),ut="",V=((o,e)=>{const n=o.__vccOpts||o;for(const[t,a]of e)n[t]=a;return n})(Be,[["__scopeId","data-v-4463879c"]]);function j(){return window.devicePixelRatio||1}function ze(o){const e=o.getContext("2d"),n=j(),t=o.clientWidth,a=o.clientHeight;return o.width=t*n,o.height=a*n,e.scale(n,n),o.style.width=t+"px",o.style.height=a+"px",e}function G(o){if(o.paths.length===0)return{minX:0,minY:0,maxX:0,maxY:0,width:0,height:0};let e=1/0,n=1/0,t=-1/0,a=-1/0;return o.paths.forEach(r=>{r.points.forEach(h=>{e=Math.min(e,h.x),n=Math.min(n,h.y),t=Math.max(t,h.x),a=Math.max(a,h.y)})}),{minX:e,minY:n,maxX:t,maxY:a,width:t-e,height:a-n}}function Ae(o,e,n=10){const t=G(e);if(t.width===0||t.height===0){const l=document.createElement("canvas");return l.width=1,l.height=1,l}const a=document.createElement("canvas"),r=a.getContext("2d"),h=t.width+n*2,u=t.height+n*2;return a.width=h,a.height=u,r.drawImage(o,t.minX-n,t.minY-n,h,u,0,0,h,u),a}function Xe(o,e,n,t=!0){const a=document.createElement("canvas"),r=a.getContext("2d");let h=e,u=n;if(t){const l=o.width/o.height,p=e/n;l>p?u=e/l:h=n*l}return a.width=h,a.height=u,r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.drawImage(o,0,0,h,u),a}function Ye(o,e,n={}){const{fontSize:t=12,fontFamily:a="Arial",color:r="#999",opacity:h=.5,position:u="bottom-right"}=n,l=document.createElement("canvas"),p=l.getContext("2d");l.width=o.width,l.height=o.height,p.drawImage(o,0,0),p.font=`${t}px ${a}`,p.fillStyle=r,p.globalAlpha=h;const d=p.measureText(e).width,v=t;let f,w;switch(u){case"top-left":f=10,w=v+10;break;case"top-right":f=o.width-d-10,w=v+10;break;case"bottom-left":f=10,w=o.height-10;break;case"bottom-right":f=o.width-d-10,w=o.height-10;break;case"center":f=(o.width-d)/2,w=(o.height+v)/2;break;default:f=o.width-d-10,w=o.height-10}return p.fillText(e,f,w),p.globalAlpha=1,l}function qe(o){const e=document.createElement("canvas"),n=e.getContext("2d");e.width=o.width,e.height=o.height,n.drawImage(o,0,0);const t=n.getImageData(0,0,o.width,o.height),a=t.data;for(let r=0;r<a.length;r+=4){const h=a[r]*.299+a[r+1]*.587+a[r+2]*.114;a[r]=h,a[r+1]=h,a[r+2]=h}return n.putImageData(t,0,0),e}const Fe={install:o=>{o.component("ElectronicSignature",V)},ElectronicSignature:V},He="1.0.0";m.ElectronicSignature=V,m.SignatureReplayController=U,m.addWatermark=Ye,m.calculateStrokeWidth=X,m.cloneSignatureData=D,m.convertToGrayscale=qe,m.createEmptySignatureData=W,m.createReplayData=L,m.cropSignature=Ae,m.default=Fe,m.drawSmoothPath=Y,m.exportSignature=F,m.getAngle=z,m.getControlPoint=A,m.getDevicePixelRatio=j,m.getDistance=b,m.getSignatureBounds=G,m.isSignatureEmpty=E,m.loadImageToCanvas=H,m.resizeSignature=Xe,m.setupHighDPICanvas=ze,m.signatureToSVG=q,m.version=He,Object.defineProperties(m,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});

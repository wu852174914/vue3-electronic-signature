(function(g,i){typeof exports=="object"&&typeof module<"u"?i(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],i):(g=typeof globalThis<"u"?globalThis:g||self,i(g.Vue3ElectronicSignature={},g.Vue))})(this,function(g,i){"use strict";var dt=Object.defineProperty;var mt=(g,i,D)=>i in g?dt(g,i,{enumerable:!0,configurable:!0,writable:!0,value:D}):g[i]=D;var x=(g,i,D)=>(mt(g,typeof i!="symbol"?i+"":i,D),D);function D(s,e){return Math.sqrt(Math.pow(e.x-s.x,2)+Math.pow(e.y-s.y,2))}function A(s,e){return Math.atan2(e.y-s.y,e.x-s.x)}function q(s,e,n,t){const o=e||s,c=n||s,u=.2,h=A(o,c)*(t?1:-1),l=D(o,c)*u;return{x:s.x+Math.cos(h)*l,y:s.y+Math.sin(h)*l,time:s.time}}function X(s,e,n){if(!n.pressure.enabled)return n.strokeWidth;const t=D(s,e),o=e.time-s.time,c=o>0?t/o:0,u=Math.max(.1,Math.min(1,1-c*.01)),{min:h,max:l}=n.pressure;return h+(l-h)*u}function Y(s,e,n){if(e.length<2)return;if(s.strokeStyle=n.strokeColor,s.lineCap="round",s.lineJoin="round",!n.smoothing||e.length<3){s.beginPath(),s.lineWidth=n.strokeWidth,s.moveTo(e[0].x,e[0].y);for(let o=1;o<e.length;o++)s.lineTo(e[o].x,e[o].y);s.stroke();return}s.beginPath(),s.moveTo(e[0].x,e[0].y);for(let o=1;o<e.length-1;o++){const c=e[o],u=e[o+1];n.pressure.enabled?s.lineWidth=X(e[o-1],c,n):s.lineWidth=n.strokeWidth;const h=q(c,e[o-1],u);s.quadraticCurveTo(h.x,h.y,c.x,c.y)}const t=e[e.length-1];s.lineTo(t.x,t.y),s.stroke()}function F(s){const{canvasSize:e,paths:n}=s;let t=`<svg width="${e.width}" height="${e.height}" xmlns="http://www.w3.org/2000/svg">`;return n.forEach(o=>{if(o.points.length<2)return;let c=`M ${o.points[0].x} ${o.points[0].y}`;for(let u=1;u<o.points.length;u++)c+=` L ${o.points[u].x} ${o.points[u].y}`;t+=`<path d="${c}" stroke="${o.strokeColor}" stroke-width="${o.strokeWidth}" fill="none" stroke-linecap="round" stroke-linejoin="round"/>`}),t+="</svg>",t}function H(s,e,n={format:"png"}){const{format:t,quality:o=.9,size:c,backgroundColor:u}=n;if(t==="svg")return F(e);const h=document.createElement("canvas"),l=h.getContext("2d");if(c){h.width=c.width,h.height=c.height;const m=c.width/s.width,y=c.height/s.height;l.scale(m,y)}else h.width=s.width,h.height=s.height;switch(u&&u!=="transparent"&&(l.fillStyle=u,l.fillRect(0,0,h.width,h.height)),l.drawImage(s,0,0),t){case"jpeg":return h.toDataURL("image/jpeg",o);case"base64":return h.toDataURL("image/png").split(",")[1];case"png":default:return h.toDataURL("image/png")}}function U(s,e){return new Promise((n,t)=>{const o=new Image;o.onload=()=>{const c=s.getContext("2d");c.clearRect(0,0,s.width,s.height),c.drawImage(o,0,0,s.width,s.height),n()},o.onerror=t,o.src=e})}function _(s){return s.paths.length===0||s.paths.every(e=>e.points.length===0)}function R(s,e){return{paths:[],canvasSize:{width:s,height:e},timestamp:Date.now(),isEmpty:!0}}function M(s){return JSON.parse(JSON.stringify(s))}class L{constructor(e){x(this,"canvas");x(this,"ctx");x(this,"replayData",null);x(this,"state","idle");x(this,"currentTime",0);x(this,"speed",1);x(this,"animationId",null);x(this,"startTimestamp",0);x(this,"pausedTime",0);x(this,"options",{});x(this,"eventCallbacks",new Map);this.canvas=e,this.ctx=e.getContext("2d")}setReplayData(e,n={}){console.log("设置回放数据:",e),console.log("回放选项:",n),this.replayData=e,this.options={...n},this.speed=n.speed||e.speed||1,this.currentTime=n.startTime||0,this.state="idle",console.log("回放数据设置完成，路径数量:",e.paths.length),console.log("总时长:",e.totalDuration)}play(){if(console.log("播放方法调用，回放数据:",this.replayData),console.log("当前状态:",this.state),!this.replayData){console.error("没有回放数据，无法播放");return}if(this.replayData.totalDuration<=0){console.error("回放数据总时长为0，无法播放");return}if(this.replayData.paths.length===0){console.error("回放数据没有路径，无法播放");return}if(this.state==="playing"){console.log("已在播放中，忽略");return}this.state==="paused"?(console.log("从暂停状态恢复播放"),this.state="playing",this.startTimestamp=performance.now()-this.pausedTime,this.emit("replay-resume")):(console.log("开始新的播放"),this.state="playing",this.startTimestamp=performance.now(),this.pausedTime=0,this.currentTime=this.options.startTime||0,this.clearCanvas(),this.emit("replay-start")),this.animate()}pause(){this.state==="playing"&&(this.state="paused",this.pausedTime=performance.now()-this.startTimestamp,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.emit("replay-pause"))}stop(){this.state="stopped",this.currentTime=0,this.pausedTime=0,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.clearCanvas(),this.emit("replay-stop")}seek(e){if(!this.replayData)return;const n=this.options.endTime||this.replayData.totalDuration;this.currentTime=Math.max(0,Math.min(e,n)),this.state==="playing"?this.startTimestamp=performance.now()-this.currentTime/this.speed:this.pausedTime=this.currentTime/this.speed,this.renderFrame(this.currentTime)}setSpeed(e){const n=this.state==="playing";n&&this.pause(),this.speed=Math.max(.1,Math.min(5,e)),this.emit("replay-speed-change",this.speed),n&&this.play()}getState(){return this.state}getCurrentTime(){return this.currentTime}getTotalDuration(){var e;return((e=this.replayData)==null?void 0:e.totalDuration)||0}getProgress(){const e=this.getTotalDuration();return e>0?this.currentTime/e:0}animate(){if(this.state!=="playing"||!this.replayData)return;const e=performance.now();this.currentTime=(e-this.startTimestamp)*this.speed;const n=this.options.endTime||this.replayData.totalDuration;if(this.currentTime>=n){this.currentTime=n,this.state="completed",this.renderFrame(this.currentTime),this.emit("replay-complete"),this.options.loop&&setTimeout(()=>{this.currentTime=this.options.startTime||0,this.play()},500);return}this.renderFrame(this.currentTime),this.emit("replay-progress",this.getProgress(),this.currentTime),this.animationId=requestAnimationFrame(()=>this.animate())}renderFrame(e){if(!this.replayData)return;this.clearCanvas();let n=!1;for(let t=0;t<this.replayData.paths.length;t++){const o=this.replayData.paths[t],c=o.startTime||0,u=o.endTime||c+(o.duration||0);if(e<c)break;if(e>=u){this.drawCompletePath(o),!n&&Math.abs(e-u)<32&&this.emit("replay-path-end",t,o);continue}n=!0;const h=Math.max(0,Math.min(1,(e-c)/Math.max(u-c,1)));h>0&&Math.abs(e-c)<32&&this.emit("replay-path-start",t,o),this.drawPartialPath(o,h);break}}drawCompletePath(e){if(e.points.length<2)return;const n=this.options.drawOptions||{strokeColor:e.strokeColor,strokeWidth:e.strokeWidth,smoothing:!0,pressure:{enabled:!1,min:1,max:4}};this.drawPathWithSmoothAlgorithm(e.points,{...n,strokeColor:e.strokeColor,strokeWidth:e.strokeWidth})}drawPartialPath(e,n){if(e.points.length<2)return;const t=e.startTime||0,o=e.duration||0,c=t+o*n,u=this.getPointsUpToTime(e.points,t,c);if(u.length<2)return;const h=this.options.drawOptions||{strokeColor:e.strokeColor,strokeWidth:e.strokeWidth,smoothing:!0,pressure:{enabled:!1,min:1,max:4}};this.drawPathWithSmoothAlgorithm(u,{...h,strokeColor:e.strokeColor,strokeWidth:e.strokeWidth})}getPointsUpToTime(e,n,t){const o=[];for(let c=0;c<e.length;c++){const u=e[c],h=n+(u.relativeTime||c*50);if(h<=t)o.push(u);else{if(c>0){const l=e[c-1],m=n+(l.relativeTime||(c-1)*50);if(m<=t){const y=(t-m)/(h-m),d={x:l.x+(u.x-l.x)*y,y:l.y+(u.y-l.y)*y,time:t,pressure:l.pressure?l.pressure+(u.pressure||l.pressure-l.pressure)*y:u.pressure};o.push(d)}}break}}return o}drawPathWithSmoothAlgorithm(e,n){if(e.length<2)return;if(this.ctx.strokeStyle=n.strokeColor,this.ctx.lineCap="round",this.ctx.lineJoin="round",!n.smoothing||e.length<3){this.ctx.beginPath(),this.ctx.lineWidth=n.strokeWidth,this.ctx.moveTo(e[0].x,e[0].y);for(let o=1;o<e.length;o++)this.ctx.lineTo(e[o].x,e[o].y);this.ctx.stroke();return}this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y);for(let o=1;o<e.length-1;o++){const c=e[o],u=e[o+1];this.ctx.lineWidth=n.strokeWidth;const h=this.getControlPoint(c,e[o-1],u);this.ctx.quadraticCurveTo(h.x,h.y,c.x,c.y)}const t=e[e.length-1];this.ctx.lineTo(t.x,t.y),this.ctx.stroke()}getControlPoint(e,n,t){const c={length:Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2)),angle:Math.atan2(t.y-n.y,t.x-n.x)},u=c.angle+Math.PI,h=c.length*.2;return{x:e.x+Math.cos(u)*h,y:e.y+Math.sin(u)*h,time:e.time||0}}clearCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}on(e,n){this.eventCallbacks.has(e)||this.eventCallbacks.set(e,[]),this.eventCallbacks.get(e).push(n)}off(e,n){if(this.eventCallbacks.has(e))if(n){const t=this.eventCallbacks.get(e),o=t.indexOf(n);o>-1&&t.splice(o,1)}else this.eventCallbacks.delete(e)}emit(e,...n){const t=this.eventCallbacks.get(e);t&&t.forEach(o=>o(...n))}destroy(){this.stop(),this.eventCallbacks.clear(),this.replayData=null}}function j(s){const e=s.paths.map(l=>{const m=l.points.map((d,v)=>{var w;let f;if(d.time&&l.points[0].time)f=d.time-l.points[0].time;else if(v===0)f=0;else{const W=l.points[v-1],C=Math.sqrt(Math.pow(d.x-W.x,2)+Math.pow(d.y-W.y,2))/100*1e3;f=(((w=m[v-1])==null?void 0:w.relativeTime)||0)+Math.max(C,16)}return{...d,relativeTime:f}}),y=m.length>0?m[m.length-1].relativeTime:0;return{...l,points:m,duration:y}}),n=[];for(let l=0;l<e.length;l++){const m=e[l];let y;if(l===0)y=0;else{const f=n[l-1],w=xe(s.paths[l-1].points,s.paths[l].points);y=f.endTime+w}const d=y+m.duration,v={...m,startTime:y,endTime:d};console.log(`路径 ${l}: 开始时间=${y}, 结束时间=${d}, 持续时间=${m.duration}`),n.push(v)}const t=n.length>0?n[n.length-1].endTime:0;console.log("回放数据生成完成:"),console.log("- 路径数量:",n.length),console.log("- 总时长:",t),console.log("- 路径详情:",n.map(l=>({startTime:l.startTime,endTime:l.endTime,duration:l.duration,pointCount:l.points.length})));const o=n.reduce((l,m)=>l+be(m.points),0),c=t>0?o/(t/1e3):0,u=n.slice(1).map((l,m)=>{const y=n[m];return l.startTime-y.endTime}),h=u.length>0?u.reduce((l,m)=>l+m,0)/u.length:0;return{paths:n,totalDuration:t,speed:1,metadata:{deviceType:Ce(s),averageSpeed:c,totalDistance:o,averagePauseTime:h}}}function xe(s,e){if(s.length===0||e.length===0)return 200;const n=s[s.length-1],t=e[0];if(n.time&&t.time)return Math.max(t.time-n.time,50);const o=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2));return Math.min(Math.max(o*2,100),1e3)}function Ce(s){const e=s.paths.reduce((c,u)=>c+u.points.length,0),n=s.paths.length;if(e===0)return"touch";const t=e/n;return t>20?"touch":t<10?"mouse":s.paths.some(c=>c.points.some(u=>u.pressure!==void 0))?"pen":"touch"}function be(s){let e=0;for(let n=1;n<s.length;n++){const t=s[n].x-s[n-1].x,o=s[n].y-s[n-1].y;e+=Math.sqrt(t*t+o*o)}return e}const Se=["width","height"],Pe={key:1,class:"signature-toolbar"},De=["disabled"],Me=["disabled"],Ee=["disabled"],We={key:2,class:"replay-controls"},_e={class:"replay-buttons"},Re=["disabled"],Ie={key:0},Ne={key:1},Ve=["disabled"],Oe={class:"replay-progress"},$e=["max","value","disabled"],Be={class:"time-display"},ze={class:"replay-speed"},Ae=i.defineComponent({__name:"ElectronicSignature",props:{showToolbar:{type:Boolean,default:!1},width:{default:"100%"},height:{default:300},strokeColor:{default:"#000000"},strokeWidth:{default:2},backgroundColor:{default:"transparent"},disabled:{type:Boolean,default:!1},placeholder:{default:"请在此处签名"},smoothing:{type:Boolean,default:!0},pressureSensitive:{type:Boolean,default:!1},minStrokeWidth:{default:1},maxStrokeWidth:{default:4},borderStyle:{default:"1px solid #ddd"},borderRadius:{default:"4px"},replayMode:{type:Boolean},replayData:{},replayOptions:{}},emits:["signature-start","signature-drawing","signature-end","signature-clear","signature-undo","signature-redo","replay-start","replay-progress","replay-pause","replay-resume","replay-stop","replay-complete","replay-path-start","replay-path-end","replay-speed-change"],setup(s,{expose:e,emit:n}){const t=s,o=n,c=i.ref(),u=i.ref(!1),h=i.ref(null),l=i.ref(R(0,0)),m=i.ref([]),y=i.ref(-1),d=i.ref(null),v=i.ref(!1),f=i.ref("idle"),w=i.ref(0),W=i.ref(0),S=i.computed(()=>typeof t.width=="number"?t.width:800),C=i.computed(()=>typeof t.height=="number"?t.height:300),je=i.computed(()=>({position:"relative",display:"inline-block",width:typeof t.width=="string"?t.width:`${t.width}px`,height:typeof t.height=="string"?t.height:`${t.height}px`})),Je=i.computed(()=>({border:t.borderStyle,borderRadius:t.borderRadius,backgroundColor:t.backgroundColor,cursor:t.disabled?"not-allowed":"crosshair",display:"block",width:"100%",height:"100%"})),Ge=i.computed(()=>({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"#999",fontSize:"14px",pointerEvents:"none",userSelect:"none"})),Qe=i.computed(()=>v.value?!1:t.placeholder&&_(l.value)),Q=i.computed(()=>y.value>0),K=i.computed(()=>y.value<m.value.length-1),Z=i.computed(()=>v.value&&d.value),P=i.computed(()=>!Z.value&&!t.disabled),Ke=i.computed(()=>{var a;return Z.value&&((a=t.replayOptions)==null?void 0:a.showControls)!==!1}),B=i.computed(()=>({strokeColor:t.strokeColor,strokeWidth:t.strokeWidth,smoothing:t.smoothing,pressure:{enabled:t.pressureSensitive,min:t.minStrokeWidth,max:t.maxStrokeWidth}})),ee=()=>{var a;return((a=c.value)==null?void 0:a.getContext("2d"))||null},N=(a,r)=>{const p=c.value,T=p.getBoundingClientRect(),k=p.width/T.width,b=p.height/T.height;return{x:(a-T.left)*k,y:(r-T.top)*b,time:Date.now()}},te=a=>{if(!P.value)return;u.value=!0;const r=performance.now(),p={...a,time:r};h.value={points:[p],strokeColor:t.strokeColor,strokeWidth:t.strokeWidth,startTime:r,endTime:r,duration:0},o("signature-start")},Ze=()=>{if(!h.value||h.value.points.length<2)return;const a=ee();if(!a)return;const r=h.value.points,p=r.length;if(a.strokeStyle=h.value.strokeColor,a.lineWidth=h.value.strokeWidth,a.lineCap="round",a.lineJoin="round",p===2)a.beginPath(),a.moveTo(r[0].x,r[0].y),a.lineTo(r[1].x,r[1].y),a.stroke();else if(p>=3){const T=r[p-3],k=r[p-2],b=r[p-1];if(a.beginPath(),t.smoothing){a.moveTo(T.x,T.y);const I=et(k,T,b);a.quadraticCurveTo(I.x,I.y,k.x,k.y)}else a.moveTo(k.x,k.y),a.lineTo(b.x,b.y);a.stroke()}},et=(a,r,p)=>{const k={length:Math.sqrt(Math.pow(p.x-r.x,2)+Math.pow(p.y-r.y,2)),angle:Math.atan2(p.y-r.y,p.x-r.x)},b=k.angle+Math.PI,I=k.length*.2;return{x:a.x+Math.cos(b)*I,y:a.y+Math.sin(b)*I,time:a.time||0}},ae=a=>{if(!u.value||!h.value||!P.value)return;const r=performance.now(),p={...a,time:r};h.value.points.push(p),h.value.startTime&&(h.value.endTime=r,h.value.duration=r-h.value.startTime),Ze(),ie(),o("signature-drawing",l.value)},oe=()=>{if(!(!u.value||!h.value)){if(u.value=!1,h.value.points.length>0){const a=h.value.points[h.value.points.length-1];a.time&&h.value.startTime&&(h.value.endTime=a.time,h.value.duration=a.time-h.value.startTime)}l.value.paths.push(h.value),l.value.isEmpty=!1,l.value.timestamp=Date.now(),V(),E(),h.value=null,o("signature-end",l.value)}},tt=a=>{a.preventDefault();const r=N(a.clientX,a.clientY);te(r)},at=a=>{if(a.preventDefault(),!u.value)return;const r=N(a.clientX,a.clientY);ae(r)},ne=a=>{a.preventDefault(),oe()},ot=a=>{if(a.preventDefault(),a.touches.length!==1)return;const r=a.touches[0],p=N(r.clientX,r.clientY);te(p)},nt=a=>{if(a.preventDefault(),a.touches.length!==1||!u.value)return;const r=a.touches[0],p=N(r.clientX,r.clientY);ae(p)},se=a=>{a.preventDefault(),oe()},ie=()=>{l.value.canvasSize={width:S.value,height:C.value},l.value.isEmpty=_(l.value)},V=()=>{m.value=m.value.slice(0,y.value+1),m.value.push(M(l.value)),y.value=m.value.length-1;const a=50;m.value.length>a&&(m.value=m.value.slice(-a),y.value=m.value.length-1)},E=()=>{const a=ee();a&&(a.clearRect(0,0,S.value,C.value),t.backgroundColor&&t.backgroundColor!=="transparent"&&(a.fillStyle=t.backgroundColor,a.fillRect(0,0,S.value,C.value)),l.value.paths.forEach(r=>{if(r.points.length>0){const p={strokeColor:r.strokeColor,strokeWidth:r.strokeWidth,smoothing:t.smoothing,pressure:B.value.pressure};Y(a,r.points,p)}}))},O=()=>{if(console.log("初始化回放控制器"),console.log("canvas引用是否存在:",!!c.value),!c.value){console.error("canvas引用不存在，无法初始化回放控制器");return}d.value&&(console.log("销毁现有回放控制器"),d.value.destroy()),console.log("创建新的回放控制器"),d.value=new L(c.value),console.log("回放控制器创建成功:",!!d.value),d.value.on("replay-start",()=>{f.value="playing",o("replay-start")}),d.value.on("replay-progress",(a,r)=>{w.value=a,W.value=r,o("replay-progress",a,r)}),d.value.on("replay-pause",()=>{f.value="paused",o("replay-pause")}),d.value.on("replay-resume",()=>{f.value="playing",o("replay-resume")}),d.value.on("replay-stop",()=>{f.value="stopped",o("replay-stop")}),d.value.on("replay-complete",()=>{f.value="completed",o("replay-complete")}),d.value.on("replay-path-start",(a,r)=>{o("replay-path-start",a,r)}),d.value.on("replay-path-end",(a,r)=>{o("replay-path-end",a,r)}),d.value.on("replay-speed-change",a=>{o("replay-speed-change",a)})},le=(a,r)=>{if(d.value||O(),d.value){v.value=!0;const p={...r,drawOptions:B.value};d.value.setReplayData(a,p),console.log("startReplay调用，自动播放:",r==null?void 0:r.autoPlay),(r==null?void 0:r.autoPlay)===!0&&d.value.play()}},re=a=>{v.value=a,!a&&d.value&&(d.value.stop(),E())},st=()=>_(l.value)?null:j(l.value),ce=()=>{console.log("play方法被调用"),console.log("回放控制器是否存在:",!!d.value),d.value||(console.log("回放控制器不存在，尝试初始化"),O()),d.value?(console.log("调用回放控制器的play方法"),d.value.play()):console.error("回放控制器初始化失败，无法播放")},he=()=>{var a;(a=d.value)==null||a.pause()},ue=()=>{var a;(a=d.value)==null||a.stop()},de=a=>{var r;(r=d.value)==null||r.seek(a)},me=a=>{var r;(r=d.value)==null||r.setSpeed(a)},it=()=>{var a;return((a=d.value)==null?void 0:a.getState())||"idle"},lt=()=>{var a;return((a=d.value)==null?void 0:a.getCurrentTime())||0},z=()=>{var a;return((a=d.value)==null?void 0:a.getTotalDuration())||0},rt=()=>{var a;return((a=d.value)==null?void 0:a.getProgress())||0},pe=a=>{const r=Math.floor(a/1e3),p=Math.floor(r/60),T=r%60;return`${p}:${T.toString().padStart(2,"0")}`},ge=()=>{P.value&&(l.value=R(S.value,C.value),E(),V(),o("signature-clear"))},ye=()=>{!Q.value||!P.value||(y.value--,l.value=M(m.value[y.value]),E(),o("signature-undo",l.value))},fe=()=>{!K.value||!P.value||(y.value++,l.value=M(m.value[y.value]),E(),o("signature-redo",l.value))},ve=a=>{const r=c.value;return H(r,l.value,a)},we=()=>_(l.value),Te=async a=>{if(!P.value)return;const r=c.value;await U(r,a),l.value=R(S.value,C.value),l.value.isEmpty=!1,V()},ct=()=>M(l.value),ht=a=>{P.value&&(l.value=M(a),E(),V())},ke=(a,r)=>{const p=a||S.value,T=r||C.value,k=ve({format:"png"});i.nextTick(()=>{const b=c.value;b.width=p,b.height=T,we()||Te(k),ie()})},ut=()=>{const a=c.value;a.width=S.value,a.height=C.value,l.value=R(S.value,C.value),m.value=[M(l.value)],y.value=0,E()};return i.watch([()=>t.width,()=>t.height],()=>{i.nextTick(()=>{c.value&&ke()})}),i.watch(()=>t.replayMode,a=>{a!==void 0&&re(a)}),i.watch(()=>t.replayData,a=>{if(console.log("watch监听到回放数据变化:",a),console.log("当前回放模式:",t.replayMode),console.log("回放控制器是否存在:",!!d.value),a&&t.replayMode)if(d.value||(console.log("回放控制器未初始化，先初始化"),O()),d.value){console.log("开始设置回放数据到控制器");const r={...t.replayOptions,drawOptions:B.value};d.value.setReplayData(a,r),console.log("回放数据已更新:",a)}else console.error("回放控制器初始化失败");else a||console.log("回放数据为空，跳过设置"),t.replayMode||console.log("不在回放模式，跳过设置")},{immediate:!0}),i.onMounted(()=>{i.nextTick(()=>{ut(),O(),t.replayMode&&t.replayData&&le(t.replayData,t.replayOptions)})}),i.onUnmounted(()=>{d.value&&(d.value.destroy(),d.value=null)}),e({clear:ge,undo:ye,redo:fe,save:ve,isEmpty:we,fromDataURL:Te,getSignatureData:ct,setSignatureData:ht,resize:ke,startReplay:le,getReplayData:st,setReplayMode:re,play:ce,pause:he,stop:ue,seek:de,setSpeed:me,getState:it,getCurrentTime:lt,getTotalDuration:z,getProgress:rt}),(a,r)=>(i.openBlock(),i.createElementBlock("div",{class:"electronic-signature",style:i.normalizeStyle(je.value)},[i.createElementVNode("canvas",{ref_key:"canvasRef",ref:c,width:S.value,height:C.value,style:i.normalizeStyle(Je.value),onMousedown:tt,onMousemove:at,onMouseup:ne,onMouseleave:ne,onTouchstart:ot,onTouchmove:nt,onTouchend:se,onTouchcancel:se},null,44,Se),Qe.value?(i.openBlock(),i.createElementBlock("div",{key:0,class:"signature-placeholder",style:i.normalizeStyle(Ge.value)},i.toDisplayString(a.placeholder),5)):i.createCommentVNode("",!0),a.showToolbar?(i.openBlock(),i.createElementBlock("div",Pe,[i.createElementVNode("button",{onClick:ge,disabled:!P.value},"清除",8,De),i.createElementVNode("button",{onClick:ye,disabled:!P.value||!Q.value},"撤销",8,Me),i.createElementVNode("button",{onClick:fe,disabled:!P.value||!K.value},"重做",8,Ee)])):i.createCommentVNode("",!0),Ke.value?(i.openBlock(),i.createElementBlock("div",We,[i.createElementVNode("div",_e,[i.createElementVNode("button",{onClick:r[0]||(r[0]=p=>f.value==="playing"?he():ce()),disabled:f.value==="idle",class:"replay-btn play-pause-btn"},[f.value==="playing"?(i.openBlock(),i.createElementBlock("span",Ie,"⏸️")):(i.openBlock(),i.createElementBlock("span",Ne,"▶️"))],8,Re),i.createElementVNode("button",{onClick:r[1]||(r[1]=p=>ue()),disabled:f.value==="idle",class:"replay-btn stop-btn"}," ⏹️ ",8,Ve)]),i.createElementVNode("div",Oe,[i.createElementVNode("input",{type:"range",min:"0",max:z(),value:W.value,onInput:r[2]||(r[2]=p=>de(Number(p.target.value))),class:"progress-slider",disabled:f.value==="idle"},null,40,$e),i.createElementVNode("div",Be,[i.createElementVNode("span",null,i.toDisplayString(pe(W.value)),1),r[4]||(r[4]=i.createElementVNode("span",null,"/",-1)),i.createElementVNode("span",null,i.toDisplayString(pe(z())),1)])]),i.createElementVNode("div",ze,[r[6]||(r[6]=i.createElementVNode("label",null,"速度:",-1)),i.createElementVNode("select",{onChange:r[3]||(r[3]=p=>me(Number(p.target.value))),class:"speed-select"},r[5]||(r[5]=[i.createElementVNode("option",{value:"0.5"},"0.5x",-1),i.createElementVNode("option",{value:"1",selected:""},"1x",-1),i.createElementVNode("option",{value:"1.5"},"1.5x",-1),i.createElementVNode("option",{value:"2"},"2x",-1)]),32)])])):i.createCommentVNode("",!0)],4))}}),pt="",$=((s,e)=>{const n=s.__vccOpts||s;for(const[t,o]of e)n[t]=o;return n})(Ae,[["__scopeId","data-v-537b6f9f"]]);function J(){return window.devicePixelRatio||1}function qe(s){const e=s.getContext("2d"),n=J(),t=s.clientWidth,o=s.clientHeight;return s.width=t*n,s.height=o*n,e.scale(n,n),s.style.width=t+"px",s.style.height=o+"px",e}function G(s){if(s.paths.length===0)return{minX:0,minY:0,maxX:0,maxY:0,width:0,height:0};let e=1/0,n=1/0,t=-1/0,o=-1/0;return s.paths.forEach(c=>{c.points.forEach(u=>{e=Math.min(e,u.x),n=Math.min(n,u.y),t=Math.max(t,u.x),o=Math.max(o,u.y)})}),{minX:e,minY:n,maxX:t,maxY:o,width:t-e,height:o-n}}function Xe(s,e,n=10){const t=G(e);if(t.width===0||t.height===0){const l=document.createElement("canvas");return l.width=1,l.height=1,l}const o=document.createElement("canvas"),c=o.getContext("2d"),u=t.width+n*2,h=t.height+n*2;return o.width=u,o.height=h,c.drawImage(s,t.minX-n,t.minY-n,u,h,0,0,u,h),o}function Ye(s,e,n,t=!0){const o=document.createElement("canvas"),c=o.getContext("2d");let u=e,h=n;if(t){const l=s.width/s.height,m=e/n;l>m?h=e/l:u=n*l}return o.width=u,o.height=h,c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",c.drawImage(s,0,0,u,h),o}function Fe(s,e,n={}){const{fontSize:t=12,fontFamily:o="Arial",color:c="#999",opacity:u=.5,position:h="bottom-right"}=n,l=document.createElement("canvas"),m=l.getContext("2d");l.width=s.width,l.height=s.height,m.drawImage(s,0,0),m.font=`${t}px ${o}`,m.fillStyle=c,m.globalAlpha=u;const d=m.measureText(e).width,v=t;let f,w;switch(h){case"top-left":f=10,w=v+10;break;case"top-right":f=s.width-d-10,w=v+10;break;case"bottom-left":f=10,w=s.height-10;break;case"bottom-right":f=s.width-d-10,w=s.height-10;break;case"center":f=(s.width-d)/2,w=(s.height+v)/2;break;default:f=s.width-d-10,w=s.height-10}return m.fillText(e,f,w),m.globalAlpha=1,l}function He(s){const e=document.createElement("canvas"),n=e.getContext("2d");e.width=s.width,e.height=s.height,n.drawImage(s,0,0);const t=n.getImageData(0,0,s.width,s.height),o=t.data;for(let c=0;c<o.length;c+=4){const u=o[c]*.299+o[c+1]*.587+o[c+2]*.114;o[c]=u,o[c+1]=u,o[c+2]=u}return n.putImageData(t,0,0),e}const Ue={install:s=>{s.component("ElectronicSignature",$)},ElectronicSignature:$},Le="1.0.0";g.ElectronicSignature=$,g.SignatureReplayController=L,g.addWatermark=Fe,g.calculateStrokeWidth=X,g.cloneSignatureData=M,g.convertToGrayscale=He,g.createEmptySignatureData=R,g.createReplayData=j,g.cropSignature=Xe,g.default=Ue,g.drawSmoothPath=Y,g.exportSignature=H,g.getAngle=A,g.getControlPoint=q,g.getDevicePixelRatio=J,g.getDistance=D,g.getSignatureBounds=G,g.isSignatureEmpty=_,g.loadImageToCanvas=U,g.resizeSignature=Ye,g.setupHighDPICanvas=qe,g.signatureToSVG=F,g.version=Le,Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});

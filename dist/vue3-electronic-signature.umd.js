(function(g,r){typeof exports=="object"&&typeof module<"u"?r(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],r):(g=typeof globalThis<"u"?globalThis:g||self,r(g.Vue3ElectronicSignature={},g.Vue))})(this,function(g,r){"use strict";var vt=Object.defineProperty;var kt=(g,r,D)=>r in g?vt(g,r,{enumerable:!0,configurable:!0,writable:!0,value:D}):g[r]=D;var x=(g,r,D)=>(kt(g,typeof r!="symbol"?r+"":r,D),D);function D(a,e){return Math.sqrt(Math.pow(e.x-a.x,2)+Math.pow(e.y-a.y,2))}function q(a,e){return Math.atan2(e.y-a.y,e.x-a.x)}function z(a,e,o,n){const i=e||a,c=o||a,u=.2,h=q(i,c)*(n?1:-1),l=D(i,c)*u;return{x:a.x+Math.cos(h)*l,y:a.y+Math.sin(h)*l,time:a.time}}function F(a,e,o){if(!o.pressure.enabled)return o.strokeWidth;const n=D(a,e),i=e.time-a.time,c=i>0?n/i:0,u=Math.max(.1,Math.min(1,1-c*.01)),{min:h,max:l}=o.pressure;return h+(l-h)*u}function Pe(a,e,o){if(e.length<2)return;if(a.strokeStyle=o.strokeColor,a.lineCap="round",a.lineJoin="round",!o.smoothing||e.length<3){a.beginPath(),a.lineWidth=o.strokeWidth,a.moveTo(e[0].x,e[0].y);for(let i=1;i<e.length;i++)a.lineTo(e[i].x,e[i].y);a.stroke();return}a.beginPath(),a.moveTo(e[0].x,e[0].y);for(let i=1;i<e.length-1;i++){const c=e[i],u=e[i+1];o.pressure.enabled?a.lineWidth=F(e[i-1],c,o):a.lineWidth=o.strokeWidth;const h=z(c,e[i-1],u);a.quadraticCurveTo(h.x,h.y,c.x,c.y)}const n=e[e.length-1];a.lineTo(n.x,n.y),a.stroke()}function Y(a){const{canvasSize:e,paths:o}=a;let n=`<svg width="${e.width}" height="${e.height}" xmlns="http://www.w3.org/2000/svg">`;return o.forEach(i=>{if(i.points.length<2)return;let c=`M ${i.points[0].x} ${i.points[0].y}`;for(let u=1;u<i.points.length;u++)c+=` L ${i.points[u].x} ${i.points[u].y}`;n+=`<path d="${c}" stroke="${i.strokeColor}" stroke-width="${i.strokeWidth}" fill="none" stroke-linecap="round" stroke-linejoin="round"/>`}),n+="</svg>",n}function X(a,e,o={format:"png"}){const{format:n,quality:i=.9,size:c,backgroundColor:u}=o;if(n==="svg")return Y(e);const h=document.createElement("canvas"),l=h.getContext("2d");if(c){h.width=c.width,h.height=c.height;const p=c.width/a.width,y=c.height/a.height;l.scale(p,y)}else h.width=a.width,h.height=a.height;switch(u&&u!=="transparent"&&(l.fillStyle=u,l.fillRect(0,0,h.width,h.height)),l.drawImage(a,0,0),n){case"jpeg":return h.toDataURL("image/jpeg",i);case"base64":return h.toDataURL("image/png").split(",")[1];case"png":default:return h.toDataURL("image/png")}}function L(a,e){return new Promise((o,n)=>{const i=new Image;i.onload=()=>{const c=a.getContext("2d");c.clearRect(0,0,a.width,a.height),c.drawImage(i,0,0,a.width,a.height),o()},i.onerror=n,i.src=e})}function I(a){return a.paths.length===0||a.paths.every(e=>e.points.length===0)}function N(a,e){return{paths:[],canvasSize:{width:a,height:e},timestamp:Date.now(),isEmpty:!0}}function M(a){return JSON.parse(JSON.stringify(a))}class H{constructor(e){x(this,"canvas");x(this,"ctx");x(this,"replayData",null);x(this,"state","idle");x(this,"currentTime",0);x(this,"speed",1);x(this,"animationId",null);x(this,"startTimestamp",0);x(this,"pausedTime",0);x(this,"options",{});x(this,"eventCallbacks",new Map);this.canvas=e,this.ctx=e.getContext("2d")}setReplayData(e,o={}){console.log("设置回放数据:",e),console.log("回放选项:",o),this.replayData=e,this.options={...o},this.speed=o.speed||e.speed||1,this.currentTime=o.startTime||0,this.state="idle",console.log("回放数据设置完成，路径数量:",e.paths.length),console.log("总时长:",e.totalDuration)}play(){if(console.log("播放方法调用，回放数据:",this.replayData),console.log("当前状态:",this.state),!this.replayData){console.error("没有回放数据，无法播放");return}if(this.replayData.totalDuration<=0){console.error("回放数据总时长为0，无法播放");return}if(this.replayData.paths.length===0){console.error("回放数据没有路径，无法播放");return}if(this.state==="playing"){console.log("已在播放中，忽略");return}this.state==="paused"?(console.log("从暂停状态恢复播放"),this.state="playing",this.startTimestamp=performance.now()-this.pausedTime,this.emit("replay-resume")):(console.log("开始新的播放"),this.state="playing",this.startTimestamp=performance.now(),this.pausedTime=0,this.currentTime=this.options.startTime||0,this.clearCanvas(),this.emit("replay-start")),this.animate()}pause(){this.state==="playing"&&(this.state="paused",this.pausedTime=performance.now()-this.startTimestamp,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.emit("replay-pause"))}stop(){this.state="stopped",this.currentTime=0,this.pausedTime=0,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.clearCanvas(),this.emit("replay-stop")}seek(e){if(!this.replayData)return;const o=this.options.endTime||this.replayData.totalDuration;this.currentTime=Math.max(0,Math.min(e,o)),this.state==="playing"?this.startTimestamp=performance.now()-this.currentTime/this.speed:this.pausedTime=this.currentTime/this.speed,this.renderFrame(this.currentTime)}setSpeed(e){const o=this.state==="playing";o&&this.pause(),this.speed=Math.max(.1,Math.min(5,e)),this.emit("replay-speed-change",this.speed),o&&this.play()}getState(){return this.state}getCurrentTime(){return this.currentTime}getTotalDuration(){var e;return((e=this.replayData)==null?void 0:e.totalDuration)||0}getProgress(){const e=this.getTotalDuration();return e>0?this.currentTime/e:0}animate(){if(this.state!=="playing"||!this.replayData)return;const e=performance.now();this.currentTime=(e-this.startTimestamp)*this.speed;const o=this.options.endTime||this.replayData.totalDuration;if(this.currentTime>=o){this.currentTime=o,this.state="completed",this.renderFrame(this.currentTime),this.emit("replay-complete"),this.options.loop&&setTimeout(()=>{this.currentTime=this.options.startTime||0,this.play()},500);return}this.renderFrame(this.currentTime),this.emit("replay-progress",this.getProgress(),this.currentTime),this.animationId=requestAnimationFrame(()=>this.animate())}renderFrame(e){if(!this.replayData)return;this.clearCanvas();let o=!1;for(let n=0;n<this.replayData.paths.length;n++){const i=this.replayData.paths[n],c=i.startTime||0,u=i.endTime||c+(i.duration||0);if(e<c)break;if(e>=u){this.drawCompletePath(i),!o&&Math.abs(e-u)<32&&this.emit("replay-path-end",n,i);continue}o=!0;const h=Math.max(0,Math.min(1,(e-c)/Math.max(u-c,1)));h>0&&Math.abs(e-c)<32&&this.emit("replay-path-start",n,i),this.drawPartialPath(i,h);break}}drawCompletePath(e){if(e.points.length<2)return;const o=this.options.drawOptions||{strokeColor:e.strokeColor,strokeWidth:e.strokeWidth,smoothing:!0,pressure:{enabled:!1,min:1,max:4}};this.drawPathWithSmoothAlgorithm(e.points,{...o,strokeColor:e.strokeColor,strokeWidth:e.strokeWidth})}drawPartialPath(e,o){if(e.points.length<2)return;const n=e.startTime||0,i=e.duration||0,c=n+i*o,u=this.getPointsUpToTime(e.points,n,c);if(u.length<2)return;const h=this.options.drawOptions||{strokeColor:e.strokeColor,strokeWidth:e.strokeWidth,smoothing:!0,pressure:{enabled:!1,min:1,max:4}};this.drawPathWithSmoothAlgorithm(u,{...h,strokeColor:e.strokeColor,strokeWidth:e.strokeWidth})}getPointsUpToTime(e,o,n){const i=[];for(let c=0;c<e.length;c++){const u=e[c],h=o+(u.relativeTime||c*50);if(h<=n)i.push(u);else{if(c>0){const l=e[c-1],p=o+(l.relativeTime||(c-1)*50);if(p<=n){const y=(n-p)/(h-p),m={x:l.x+(u.x-l.x)*y,y:l.y+(u.y-l.y)*y,time:n,pressure:l.pressure?l.pressure+(u.pressure||l.pressure-l.pressure)*y:u.pressure};i.push(m)}}break}}return i}drawPathWithSmoothAlgorithm(e,o){if(e.length<2)return;if(this.ctx.strokeStyle=o.strokeColor,this.ctx.lineCap="round",this.ctx.lineJoin="round",!o.smoothing||e.length<3){this.ctx.beginPath(),this.ctx.lineWidth=o.strokeWidth,this.ctx.moveTo(e[0].x,e[0].y);for(let i=1;i<e.length;i++)this.ctx.lineTo(e[i].x,e[i].y);this.ctx.stroke();return}this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y);for(let i=1;i<e.length-1;i++){const c=e[i],u=e[i+1];this.ctx.lineWidth=o.strokeWidth;const h=this.getControlPoint(c,e[i-1],u);this.ctx.quadraticCurveTo(h.x,h.y,c.x,c.y)}const n=e[e.length-1];this.ctx.lineTo(n.x,n.y),this.ctx.stroke()}getControlPoint(e,o,n){const c={length:Math.sqrt(Math.pow(n.x-o.x,2)+Math.pow(n.y-o.y,2)),angle:Math.atan2(n.y-o.y,n.x-o.x)},u=c.angle+Math.PI,h=c.length*.2;return{x:e.x+Math.cos(u)*h,y:e.y+Math.sin(u)*h,time:e.time||0}}clearCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}on(e,o){this.eventCallbacks.has(e)||this.eventCallbacks.set(e,[]),this.eventCallbacks.get(e).push(o)}off(e,o){if(this.eventCallbacks.has(e))if(o){const n=this.eventCallbacks.get(e),i=n.indexOf(o);i>-1&&n.splice(i,1)}else this.eventCallbacks.delete(e)}emit(e,...o){const n=this.eventCallbacks.get(e);n&&n.forEach(i=>i(...o))}destroy(){this.stop(),this.eventCallbacks.clear(),this.replayData=null}}function U(a){const e=a.paths.map(l=>{const p=l.points.map((m,w)=>{var C;let v;if(m.time&&l.points[0].time)v=m.time-l.points[0].time;else if(w===0)v=0;else{const _=l.points[w-1],b=Math.sqrt(Math.pow(m.x-_.x,2)+Math.pow(m.y-_.y,2))/100*1e3;v=(((C=p[w-1])==null?void 0:C.relativeTime)||0)+Math.max(b,16)}return{...m,relativeTime:v}}),y=p.length>0?p[p.length-1].relativeTime:0;return{...l,points:p,duration:y}}),o=[];for(let l=0;l<e.length;l++){const p=e[l];let y;if(l===0)y=0;else{const v=o[l-1],C=De(a.paths[l-1].points,a.paths[l].points);y=v.endTime+C}const m=y+p.duration,w={...p,startTime:y,endTime:m};console.log(`路径 ${l}: 开始时间=${y}, 结束时间=${m}, 持续时间=${p.duration}`),o.push(w)}const n=o.length>0?o[o.length-1].endTime:0;console.log("回放数据生成完成:"),console.log("- 路径数量:",o.length),console.log("- 总时长:",n),console.log("- 路径详情:",o.map(l=>({startTime:l.startTime,endTime:l.endTime,duration:l.duration,pointCount:l.points.length})));const i=o.reduce((l,p)=>l+We(p.points),0),c=n>0?i/(n/1e3):0,u=o.slice(1).map((l,p)=>{const y=o[p];return l.startTime-y.endTime}),h=u.length>0?u.reduce((l,p)=>l+p,0)/u.length:0;return{paths:o,totalDuration:n,speed:1,metadata:{deviceType:Me(a),averageSpeed:c,totalDistance:i,averagePauseTime:h}}}function De(a,e){if(a.length===0||e.length===0)return 200;const o=a[a.length-1],n=e[0];if(o.time&&n.time)return Math.max(n.time-o.time,50);const i=Math.sqrt(Math.pow(n.x-o.x,2)+Math.pow(n.y-o.y,2));return Math.min(Math.max(i*2,100),1e3)}function Me(a){const e=a.paths.reduce((c,u)=>c+u.points.length,0),o=a.paths.length;if(e===0)return"touch";const n=e/o;return n>20?"touch":n<10?"mouse":a.paths.some(c=>c.points.some(u=>u.pressure!==void 0))?"pen":"touch"}function We(a){let e=0;for(let o=1;o<a.length;o++){const n=a[o].x-a[o-1].x,i=a[o].y-a[o-1].y;e+=Math.sqrt(n*n+i*i)}return e}const B={pen:{name:"钢笔",description:"细线条，高精度，适合正式签名",strokeWidth:1.5,smoothing:!0,pressure:{enabled:!1,min:1,max:2},lineCap:"round",lineJoin:"round",recommendedColor:"#000080"},brush:{name:"毛笔",description:"压感变化，粗细不均，艺术感强",strokeWidth:4,smoothing:!0,pressure:{enabled:!0,min:2,max:8},lineCap:"round",lineJoin:"round",recommendedColor:"#2c3e50"},marker:{name:"马克笔",description:"粗线条，均匀宽度，醒目清晰",strokeWidth:5,smoothing:!0,pressure:{enabled:!1,min:4,max:6},lineCap:"round",lineJoin:"round",recommendedColor:"#e74c3c"},pencil:{name:"铅笔",description:"中等粗细，略有纹理，自然感强",strokeWidth:2,smoothing:!1,pressure:{enabled:!0,min:1.5,max:3},lineCap:"round",lineJoin:"round",recommendedColor:"#7f8c8d"},ballpoint:{name:"圆珠笔",description:"细线条，轻微变化，日常书写",strokeWidth:1,smoothing:!0,pressure:{enabled:!0,min:.8,max:1.5},lineCap:"round",lineJoin:"round",recommendedColor:"#3498db"}};function j(a){return B[a]}function Ee(){return Object.entries(B).map(([a,e])=>({key:a,config:e}))}function G(a,e){const o=j(a);return{strokeWidth:o.strokeWidth,smoothing:o.smoothing,pressure:o.pressure,lineCap:o.lineCap,lineJoin:o.lineJoin,strokeColor:e||o.recommendedColor||"#000000"}}const _e=["width","height"],Re={key:1,class:"signature-toolbar"},Ie=["disabled"],Ne=["disabled"],Ve=["disabled"],Oe={key:2,class:"replay-controls"},$e={class:"replay-buttons"},Be=["disabled"],Je={key:0},Ae={key:1},qe=["disabled"],ze={class:"replay-progress"},Fe=["max","value","disabled"],Ye={class:"time-display"},Xe={class:"replay-speed"},Le=r.defineComponent({__name:"ElectronicSignature",props:{showToolbar:{type:Boolean,default:!1},width:{default:"100%"},height:{default:300},penStyle:{default:"pen"},strokeColor:{default:"#000000"},strokeWidth:{default:2},backgroundColor:{default:"transparent"},disabled:{type:Boolean,default:!1},placeholder:{default:"请在此处签名"},smoothing:{type:Boolean,default:!0},pressureSensitive:{type:Boolean,default:!1},minStrokeWidth:{default:1},maxStrokeWidth:{default:4},borderStyle:{default:"1px solid #ddd"},borderRadius:{default:"4px"},replayMode:{type:Boolean},replayData:{},replayOptions:{}},emits:["signature-start","signature-drawing","signature-end","signature-clear","signature-undo","signature-redo","replay-start","replay-progress","replay-pause","replay-resume","replay-stop","replay-complete","replay-path-start","replay-path-end","replay-speed-change"],setup(a,{expose:e,emit:o}){const n=a,i=o,c=r.ref(),u=r.ref(!1),h=r.ref(null),l=r.ref(N(0,0)),p=r.ref([]),y=r.ref(-1),m=r.ref(null),w=r.ref(!1),v=r.ref("idle"),C=r.ref(0),_=r.ref(0),S=r.computed(()=>typeof n.width=="number"?n.width:800),b=r.computed(()=>typeof n.height=="number"?n.height:300),et=r.computed(()=>({position:"relative",display:"inline-block",width:typeof n.width=="string"?n.width:`${n.width}px`,height:typeof n.height=="string"?n.height:`${n.height}px`})),tt=r.computed(()=>({border:n.borderStyle,borderRadius:n.borderRadius,backgroundColor:n.backgroundColor,cursor:n.disabled?"not-allowed":"crosshair",display:"block",width:"100%",height:"100%"})),nt=r.computed(()=>({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"#999",fontSize:"14px",pointerEvents:"none",userSelect:"none"})),ot=r.computed(()=>w.value?!1:n.placeholder&&I(l.value)),Z=r.computed(()=>y.value>0),ee=r.computed(()=>y.value<p.value.length-1),te=r.computed(()=>w.value&&m.value),P=r.computed(()=>!te.value&&!n.disabled),at=r.computed(()=>{var t;return te.value&&((t=n.replayOptions)==null?void 0:t.showControls)!==!1}),R=r.computed(()=>{if(n.penStyle){const t=G(n.penStyle,n.strokeColor);return{strokeColor:t.strokeColor,strokeWidth:n.strokeWidth||t.strokeWidth,smoothing:n.smoothing!==void 0?n.smoothing:t.smoothing,pressure:{enabled:n.pressureSensitive!==void 0?n.pressureSensitive:t.pressure.enabled,min:n.minStrokeWidth||t.pressure.min,max:n.maxStrokeWidth||t.pressure.max},lineCap:t.lineCap,lineJoin:t.lineJoin}}return{strokeColor:n.strokeColor||"#000000",strokeWidth:n.strokeWidth||2,smoothing:n.smoothing!==void 0?n.smoothing:!0,pressure:{enabled:n.pressureSensitive||!1,min:n.minStrokeWidth||1,max:n.maxStrokeWidth||4},lineCap:"round",lineJoin:"round"}}),ne=()=>{var t;return((t=c.value)==null?void 0:t.getContext("2d"))||null},V=(t,s)=>{const d=c.value,f=d.getBoundingClientRect(),k=d.width/f.width,T=d.height/f.height;return{x:(t-f.left)*k,y:(s-f.top)*T,time:Date.now()}},oe=t=>{if(!P.value)return;u.value=!0;const s=performance.now(),d={...t,time:s};h.value={points:[d],strokeColor:n.strokeColor,strokeWidth:n.strokeWidth,startTime:s,endTime:s,duration:0},i("signature-start")},it=()=>{if(!h.value||h.value.points.length<2)return;const t=ne();if(!t)return;const s=h.value.points,d=s.length;if(t.strokeStyle=h.value.strokeColor,t.lineWidth=h.value.strokeWidth,t.lineCap=R.value.lineCap||"round",t.lineJoin=R.value.lineJoin||"round",d===2)t.beginPath(),t.moveTo(s[0].x,s[0].y),t.lineTo(s[1].x,s[1].y),t.stroke();else if(d>=3){const f=s[d-3],k=s[d-2],T=s[d-1];if(t.beginPath(),n.smoothing){t.moveTo(f.x,f.y);const E=ae(k,f,T);t.quadraticCurveTo(E.x,E.y,k.x,k.y)}else t.moveTo(k.x,k.y),t.lineTo(T.x,T.y);t.stroke()}},ae=(t,s,d)=>{const k={length:Math.sqrt(Math.pow(d.x-s.x,2)+Math.pow(d.y-s.y,2)),angle:Math.atan2(d.y-s.y,d.x-s.x)},T=k.angle+Math.PI,E=k.length*.2;return{x:t.x+Math.cos(T)*E,y:t.y+Math.sin(T)*E,time:t.time||0}},st=(t,s)=>{if(s.points.length<2)return;t.strokeStyle=s.strokeColor,t.lineWidth=s.strokeWidth,t.lineCap=R.value.lineCap||"round",t.lineJoin=R.value.lineJoin||"round";const d=s.points;if(d.length===2){t.beginPath(),t.moveTo(d[0].x,d[0].y),t.lineTo(d[1].x,d[1].y),t.stroke();return}if(!n.smoothing){t.beginPath(),t.moveTo(d[0].x,d[0].y);for(let f=1;f<d.length;f++)t.lineTo(d[f].x,d[f].y);t.stroke();return}t.beginPath(),t.moveTo(d[0].x,d[0].y),d.length>=3&&t.lineTo(d[1].x,d[1].y);for(let f=1;f<d.length-1;f++){const k=d[f-1],T=d[f],E=d[f+1],Se=ae(T,k,E);t.quadraticCurveTo(Se.x,Se.y,T.x,T.y)}if(d.length>=3){const f=d[d.length-1],k=d[d.length-2];t.quadraticCurveTo(k.x,k.y,f.x,f.y)}t.stroke()},ie=t=>{if(!u.value||!h.value||!P.value)return;const s=performance.now(),d={...t,time:s};h.value.points.push(d),h.value.startTime&&(h.value.endTime=s,h.value.duration=s-h.value.startTime),it(),ce(),i("signature-drawing",l.value)},se=()=>{if(!(!u.value||!h.value)){if(u.value=!1,h.value.points.length>0){const t=h.value.points[h.value.points.length-1];t.time&&h.value.startTime&&(h.value.endTime=t.time,h.value.duration=t.time-h.value.startTime)}l.value.paths.push(h.value),l.value.isEmpty=!1,l.value.timestamp=Date.now(),O(),W(),h.value=null,i("signature-end",l.value)}},rt=t=>{t.preventDefault();const s=V(t.clientX,t.clientY);oe(s)},lt=t=>{if(t.preventDefault(),!u.value)return;const s=V(t.clientX,t.clientY);ie(s)},re=t=>{t.preventDefault(),se()},ct=t=>{if(t.preventDefault(),t.touches.length!==1)return;const s=t.touches[0],d=V(s.clientX,s.clientY);oe(d)},ht=t=>{if(t.preventDefault(),t.touches.length!==1||!u.value)return;const s=t.touches[0],d=V(s.clientX,s.clientY);ie(d)},le=t=>{t.preventDefault(),se()},ce=()=>{l.value.canvasSize={width:S.value,height:b.value},l.value.isEmpty=I(l.value)},O=()=>{p.value=p.value.slice(0,y.value+1),p.value.push(M(l.value)),y.value=p.value.length-1;const t=50;p.value.length>t&&(p.value=p.value.slice(-t),y.value=p.value.length-1)},W=()=>{const t=ne();t&&(t.clearRect(0,0,S.value,b.value),n.backgroundColor&&n.backgroundColor!=="transparent"&&(t.fillStyle=n.backgroundColor,t.fillRect(0,0,S.value,b.value)),l.value.paths.forEach(s=>{s.points.length>0&&st(t,s)}))},$=()=>{if(console.log("初始化回放控制器"),console.log("canvas引用是否存在:",!!c.value),!c.value){console.error("canvas引用不存在，无法初始化回放控制器");return}m.value&&(console.log("销毁现有回放控制器"),m.value.destroy()),console.log("创建新的回放控制器"),m.value=new H(c.value),console.log("回放控制器创建成功:",!!m.value),m.value.on("replay-start",()=>{v.value="playing",i("replay-start")}),m.value.on("replay-progress",(t,s)=>{C.value=t,_.value=s,i("replay-progress",t,s)}),m.value.on("replay-pause",()=>{v.value="paused",i("replay-pause")}),m.value.on("replay-resume",()=>{v.value="playing",i("replay-resume")}),m.value.on("replay-stop",()=>{v.value="stopped",i("replay-stop")}),m.value.on("replay-complete",()=>{v.value="completed",i("replay-complete")}),m.value.on("replay-path-start",(t,s)=>{i("replay-path-start",t,s)}),m.value.on("replay-path-end",(t,s)=>{i("replay-path-end",t,s)}),m.value.on("replay-speed-change",t=>{i("replay-speed-change",t)})},he=(t,s)=>{if(m.value||$(),m.value){w.value=!0;const d={...s,drawOptions:R.value};m.value.setReplayData(t,d),console.log("startReplay调用，自动播放:",s==null?void 0:s.autoPlay),(s==null?void 0:s.autoPlay)===!0&&m.value.play()}},ue=t=>{w.value=t,!t&&m.value&&(m.value.stop(),W())},ut=()=>I(l.value)?null:U(l.value),de=()=>{console.log("play方法被调用"),console.log("回放控制器是否存在:",!!m.value),m.value||(console.log("回放控制器不存在，尝试初始化"),$()),m.value?(console.log("调用回放控制器的play方法"),m.value.play()):console.error("回放控制器初始化失败，无法播放")},me=()=>{var t;(t=m.value)==null||t.pause()},pe=()=>{var t;(t=m.value)==null||t.stop()},ge=t=>{var s;(s=m.value)==null||s.seek(t)},ye=t=>{var s;(s=m.value)==null||s.setSpeed(t)},dt=()=>{var t;return((t=m.value)==null?void 0:t.getState())||"idle"},mt=()=>{var t;return((t=m.value)==null?void 0:t.getCurrentTime())||0},A=()=>{var t;return((t=m.value)==null?void 0:t.getTotalDuration())||0},pt=()=>{var t;return((t=m.value)==null?void 0:t.getProgress())||0},fe=t=>{const s=Math.floor(t/1e3),d=Math.floor(s/60),f=s%60;return`${d}:${f.toString().padStart(2,"0")}`},ve=()=>{P.value&&(l.value=N(S.value,b.value),W(),O(),i("signature-clear"))},ke=()=>{!Z.value||!P.value||(y.value--,l.value=M(p.value[y.value]),W(),i("signature-undo",l.value))},Te=()=>{!ee.value||!P.value||(y.value++,l.value=M(p.value[y.value]),W(),i("signature-redo",l.value))},we=t=>{const s=c.value;return X(s,l.value,t)},Ce=()=>I(l.value),xe=async t=>{if(!P.value)return;const s=c.value;await L(s,t),l.value=N(S.value,b.value),l.value.isEmpty=!1,O()},gt=()=>M(l.value),yt=t=>{P.value&&(l.value=M(t),W(),O())},be=(t,s)=>{const d=t||S.value,f=s||b.value,k=we({format:"png"});r.nextTick(()=>{const T=c.value;T.width=d,T.height=f,Ce()||xe(k),ce()})},ft=()=>{const t=c.value;t.width=S.value,t.height=b.value,l.value=N(S.value,b.value),p.value=[M(l.value)],y.value=0,W()};return r.watch([()=>n.width,()=>n.height],()=>{r.nextTick(()=>{c.value&&be()})}),r.watch(()=>n.replayMode,t=>{t!==void 0&&ue(t)}),r.watch(()=>n.replayData,t=>{if(console.log("watch监听到回放数据变化:",t),console.log("当前回放模式:",n.replayMode),console.log("回放控制器是否存在:",!!m.value),t&&n.replayMode)if(m.value||(console.log("回放控制器未初始化，先初始化"),$()),m.value){console.log("开始设置回放数据到控制器");const s={...n.replayOptions,drawOptions:R.value};m.value.setReplayData(t,s),console.log("回放数据已更新:",t)}else console.error("回放控制器初始化失败");else t||console.log("回放数据为空，跳过设置"),n.replayMode||console.log("不在回放模式，跳过设置")},{immediate:!0}),r.onMounted(()=>{r.nextTick(()=>{ft(),$(),n.replayMode&&n.replayData&&he(n.replayData,n.replayOptions)})}),r.onUnmounted(()=>{m.value&&(m.value.destroy(),m.value=null)}),e({clear:ve,undo:ke,redo:Te,save:we,isEmpty:Ce,fromDataURL:xe,getSignatureData:gt,setSignatureData:yt,resize:be,startReplay:he,getReplayData:ut,setReplayMode:ue,play:de,pause:me,stop:pe,seek:ge,setSpeed:ye,getState:dt,getCurrentTime:mt,getTotalDuration:A,getProgress:pt}),(t,s)=>(r.openBlock(),r.createElementBlock("div",{class:"electronic-signature",style:r.normalizeStyle(et.value)},[r.createElementVNode("canvas",{ref_key:"canvasRef",ref:c,width:S.value,height:b.value,style:r.normalizeStyle(tt.value),onMousedown:rt,onMousemove:lt,onMouseup:re,onMouseleave:re,onTouchstart:ct,onTouchmove:ht,onTouchend:le,onTouchcancel:le},null,44,_e),ot.value?(r.openBlock(),r.createElementBlock("div",{key:0,class:"signature-placeholder",style:r.normalizeStyle(nt.value)},r.toDisplayString(t.placeholder),5)):r.createCommentVNode("",!0),t.showToolbar?(r.openBlock(),r.createElementBlock("div",Re,[r.createElementVNode("button",{onClick:ve,disabled:!P.value},"清除",8,Ie),r.createElementVNode("button",{onClick:ke,disabled:!P.value||!Z.value},"撤销",8,Ne),r.createElementVNode("button",{onClick:Te,disabled:!P.value||!ee.value},"重做",8,Ve)])):r.createCommentVNode("",!0),at.value?(r.openBlock(),r.createElementBlock("div",Oe,[r.createElementVNode("div",$e,[r.createElementVNode("button",{onClick:s[0]||(s[0]=d=>v.value==="playing"?me():de()),disabled:v.value==="idle",class:"replay-btn play-pause-btn"},[v.value==="playing"?(r.openBlock(),r.createElementBlock("span",Je,"⏸️")):(r.openBlock(),r.createElementBlock("span",Ae,"▶️"))],8,Be),r.createElementVNode("button",{onClick:s[1]||(s[1]=d=>pe()),disabled:v.value==="idle",class:"replay-btn stop-btn"}," ⏹️ ",8,qe)]),r.createElementVNode("div",ze,[r.createElementVNode("input",{type:"range",min:"0",max:A(),value:_.value,onInput:s[2]||(s[2]=d=>ge(Number(d.target.value))),class:"progress-slider",disabled:v.value==="idle"},null,40,Fe),r.createElementVNode("div",Ye,[r.createElementVNode("span",null,r.toDisplayString(fe(_.value)),1),s[4]||(s[4]=r.createElementVNode("span",null,"/",-1)),r.createElementVNode("span",null,r.toDisplayString(fe(A())),1)])]),r.createElementVNode("div",Xe,[s[6]||(s[6]=r.createElementVNode("label",null,"速度:",-1)),r.createElementVNode("select",{onChange:s[3]||(s[3]=d=>ye(Number(d.target.value))),class:"speed-select"},s[5]||(s[5]=[r.createElementVNode("option",{value:"0.5"},"0.5x",-1),r.createElementVNode("option",{value:"1",selected:""},"1x",-1),r.createElementVNode("option",{value:"1.5"},"1.5x",-1),r.createElementVNode("option",{value:"2"},"2x",-1)]),32)])])):r.createCommentVNode("",!0)],4))}}),Tt="",J=((a,e)=>{const o=a.__vccOpts||a;for(const[n,i]of e)o[n]=i;return o})(Le,[["__scopeId","data-v-8c5b2327"]]);function Q(){return window.devicePixelRatio||1}function He(a){const e=a.getContext("2d"),o=Q(),n=a.clientWidth,i=a.clientHeight;return a.width=n*o,a.height=i*o,e.scale(o,o),a.style.width=n+"px",a.style.height=i+"px",e}function K(a){if(a.paths.length===0)return{minX:0,minY:0,maxX:0,maxY:0,width:0,height:0};let e=1/0,o=1/0,n=-1/0,i=-1/0;return a.paths.forEach(c=>{c.points.forEach(u=>{e=Math.min(e,u.x),o=Math.min(o,u.y),n=Math.max(n,u.x),i=Math.max(i,u.y)})}),{minX:e,minY:o,maxX:n,maxY:i,width:n-e,height:i-o}}function Ue(a,e,o=10){const n=K(e);if(n.width===0||n.height===0){const l=document.createElement("canvas");return l.width=1,l.height=1,l}const i=document.createElement("canvas"),c=i.getContext("2d"),u=n.width+o*2,h=n.height+o*2;return i.width=u,i.height=h,c.drawImage(a,n.minX-o,n.minY-o,u,h,0,0,u,h),i}function je(a,e,o,n=!0){const i=document.createElement("canvas"),c=i.getContext("2d");let u=e,h=o;if(n){const l=a.width/a.height,p=e/o;l>p?h=e/l:u=o*l}return i.width=u,i.height=h,c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",c.drawImage(a,0,0,u,h),i}function Ge(a,e,o={}){const{fontSize:n=12,fontFamily:i="Arial",color:c="#999",opacity:u=.5,position:h="bottom-right"}=o,l=document.createElement("canvas"),p=l.getContext("2d");l.width=a.width,l.height=a.height,p.drawImage(a,0,0),p.font=`${n}px ${i}`,p.fillStyle=c,p.globalAlpha=u;const m=p.measureText(e).width,w=n;let v,C;switch(h){case"top-left":v=10,C=w+10;break;case"top-right":v=a.width-m-10,C=w+10;break;case"bottom-left":v=10,C=a.height-10;break;case"bottom-right":v=a.width-m-10,C=a.height-10;break;case"center":v=(a.width-m)/2,C=(a.height+w)/2;break;default:v=a.width-m-10,C=a.height-10}return p.fillText(e,v,C),p.globalAlpha=1,l}function Qe(a){const e=document.createElement("canvas"),o=e.getContext("2d");e.width=a.width,e.height=a.height,o.drawImage(a,0,0);const n=o.getImageData(0,0,a.width,a.height),i=n.data;for(let c=0;c<i.length;c+=4){const u=i[c]*.299+i[c+1]*.587+i[c+2]*.114;i[c]=u,i[c+1]=u,i[c+2]=u}return o.putImageData(n,0,0),e}const Ke={install:a=>{a.component("ElectronicSignature",J)},ElectronicSignature:J},Ze="1.0.0";g.ElectronicSignature=J,g.PEN_STYLE_CONFIGS=B,g.SignatureReplayController=H,g.addWatermark=Ge,g.calculateStrokeWidth=F,g.cloneSignatureData=M,g.convertToGrayscale=Qe,g.createDrawOptionsFromPenStyle=G,g.createEmptySignatureData=N,g.createReplayData=U,g.cropSignature=Ue,g.default=Ke,g.drawSmoothPath=Pe,g.exportSignature=X,g.getAllPenStyles=Ee,g.getAngle=q,g.getControlPoint=z,g.getDevicePixelRatio=Q,g.getDistance=D,g.getPenStyleConfig=j,g.getSignatureBounds=K,g.isSignatureEmpty=I,g.loadImageToCanvas=L,g.resizeSignature=je,g.setupHighDPICanvas=He,g.signatureToSVG=Y,g.version=Ze,Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
